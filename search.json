[{"title":"LiteHubä¹‹è·¨åŸŸè®¿é—®CORS","url":"/undefined/LiteHub_CORS/","content":"\n\n\nåŸç†åŸºæœ¬æ¦‚å¿µåœ¨æµè§ˆå™¨å®‰å…¨æ¨¡å‹ä¸­ï¼ŒåŒæºç­–ç•¥æ˜¯æœ€é‡è¦çš„å®‰å…¨åŸºçŸ³ã€‚ä¸€ä¸ªâ€œåŸŸâ€æ˜¯ç”±3ä¸ªè¦ç´ ç»„æˆçš„ï¼š\n\nåè®®ï¼ˆå¦‚ï¼šhttp æˆ– httpsï¼‰\nä¸»æœºï¼ˆHostï¼Œå¦‚ www.example.com æˆ– 127.0.0.1ï¼‰\nç«¯å£ï¼ˆPortï¼Œå¦‚ 80 æˆ– 8080ï¼‰\n\nåªè¦è¿™ä¸‰ä¸ªå®Œå…¨ä¸€è‡´ï¼Œå°±æ˜¯åŒæºçš„ã€‚ä¾‹å¦‚ï¼š\n\nhttp://example.com:80 å’Œ http://example.com:8080 æ˜¯ä¸åŒæº\nhttp://example.com å’Œ https://example.com æ˜¯ä¸åŒæº\n\nä¸‹é¢æ˜¯å®˜ç½‘è§£é‡Šè·¨åŸŸçš„å›¾è§£ï¼š\nä¸¤ç§è¯·æ±‚ï¼šæµè§ˆå™¨å°† CORS è¯·æ±‚åˆ†æˆä¸¤ç±»ï¼šç®€å•è¯·æ±‚ï¼ˆsimple requestï¼‰å’Œéç®€å•è¯·æ±‚ï¼ˆnot-so-simple requestï¼‰ã€‚\nç®€å•è¯·æ±‚ æŒ‰ç…§ W3C çš„ CORS è§„èŒƒï¼Œåªæœ‰å®Œå…¨æ»¡è¶³ã€Œå®‰å…¨è¦æ±‚ã€çš„è·¨åŸŸè¯·æ±‚ï¼Œæµè§ˆå™¨æ‰ä¼šæŠŠå®ƒç›´æ¥å½“æˆç®€å•è¯·æ±‚ï¼Œç›´æ¥å‘é€ç»™æœåŠ¡ç«¯ï¼Œä¸éœ€è¦å…ˆå‘ OPTIONSã€‚ å¿…é¡»åŒæ—¶æ»¡è¶³ä»¥ä¸‹æ¡ä»¶\n\nè¯·æ±‚æ–¹æ³•å¿…é¡»æ˜¯ï¼ˆGET/HEAD/POSTï¼‰ä¸‰è€…ä¹‹ä¸€\nè¯·æ±‚å¤´ä¸èƒ½è¶…å‡ºä»¥ä¸‹å‡ ä¸ªå­—æ®µï¼ˆAcceptã€Accept-Languageã€Content-Languageã€Content-Typeï¼‰ç­‰\nContent-Typeï¼ˆå¦‚æœå­˜åœ¨çš„è¯ï¼‰ï¼Œå…¶å€¼åªèƒ½æ˜¯application/x-www-form-urlencodedã€multipart/form-dataã€text/plain\n\néç®€å•è¯·æ±‚ï¼ˆé¢„æ£€è¯·æ±‚ï¼‰éç®€å•è¯·æ±‚æ˜¯æŒ‡é‚£äº›å¯¹æœåŠ¡å™¨æœ‰ç‰¹æ®Šè¦æ±‚çš„è¯·æ±‚ï¼Œä¾‹å¦‚ï¼š\n\nä½¿ç”¨PUTæˆ–DELETEæ–¹æ³•\nè®¾ç½®Content-Typeä¸ºapplication&#x2F;jsonå³ä¸æ»¡è¶³ç®€å•è¯·æ±‚çš„æ¡ä»¶çš„éƒ½æ˜¯é¢„æ£€è¯·æ±‚ï¼ˆéç®€å•è¯·æ±‚ï¼‰ã€‚\n\nå¯¹äºè¿™ç±»è¯·æ±‚ï¼Œæµè§ˆå™¨ä¼šåœ¨æ­£å¼é€šä¿¡å‰é¢å¤–å‘é€ä¸€æ¬¡HTTPæŸ¥è¯¢è¯·æ±‚ï¼ˆå³é¢„æ£€è¯·æ±‚ï¼‰ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åšé¢„æ£€ï¼ˆPreflightï¼‰ã€‚è¯¥è¯·æ±‚ä¼šç¡®è®¤ï¼š\n\nå½“å‰ç½‘é¡µåŸŸåæ˜¯å¦åœ¨æœåŠ¡å™¨çš„è®¸å¯åå•ä¸­\nå…è®¸ä½¿ç”¨çš„HTTPæ–¹æ³•å’Œå¤´ä¿¡æ¯å­—æ®µåªæœ‰åœ¨è·å¾—æœåŠ¡å™¨è‚¯å®šç­”å¤åï¼Œæµè§ˆå™¨æ‰ä¼šå‘å‡ºæ­£å¼çš„XMLHttpRequestè¯·æ±‚ï¼Œå¦åˆ™å°†æŠ¥é”™ã€‚\n\nâ€œé¢„æ£€è¯·æ±‚â€ç”¨çš„è¯·æ±‚æ–¹æ³•æ˜¯ OPTIONSï¼Œè¡¨ç¤ºè¿™ä¸ªè¯·æ±‚æ˜¯ç”¨æ¥è¯¢é—®çš„ã€‚å¤´ä¿¡æ¯é‡Œé¢ï¼Œå…³é”®å­—æ˜¯ Originï¼Œè¡¨ç¤ºè¯·æ±‚æ¥è‡ªå“ªä¸ªæºã€‚é™¤äº† Origin å­—æ®µï¼Œâ€œé¢„æ£€è¯·æ±‚â€çš„å¤´ä¿¡æ¯åŒ…æ‹¬ä¸¤ä¸ªç‰¹æ®Šå­—æ®µã€‚â€¢ Access-Control-Request-Methodï¼šå¿…é¡»å­—æ®µï¼Œåˆ—å‡ºæµè§ˆå™¨çš„ CORS è¯·æ±‚ä¼šç”¨åˆ°å“ªäº› HTTP æ–¹æ³•ï¼›â€¢ Access-Control-Request-Headersï¼šè¿™ä¸ªå­—æ®µæ˜¯ä¸€ä¸ªé€—å· , åˆ†éš”çš„å­—ç¬¦ä¸²ï¼ŒæŒ‡å®šæµè§ˆå™¨ CORS è¯·æ±‚ä¼šé¢å¤–å‘é€çš„å¤´ä¿¡æ¯å­—æ®µï¼Œä¸Šé¢ç¤ºä¾‹æ˜¯ X-Custom-Headerã€‚\nä»£ç å®ç° CORSï¼ˆCross-Origin Resource Sharingï¼Œè·¨åŸŸèµ„æºå…±äº«ï¼‰é€šè¿‡åœ¨å“åº”å¤´é‡ŒåŠ ä¸Šä¸€ç»„ç‰¹æ®Šå­—æ®µæ¥å‘Šè¯‰æµè§ˆå™¨ï¼Œè¿™ä¸ªèµ„æºå…è®¸è¢«æŸäº›æºè®¿é—®ã€‚\næœåŠ¡å™¨ç«¯Corsçš„å…³é”®é…ç½®struct CorsConfig &#123;    std::vector&lt;std::string&gt; allowedOrigins;//å…è®¸å“ªäº›åŸŸåå¯ä»¥è®¿é—®    std::vector&lt;std::string&gt; allowedMethods; //å…è®¸å“ªäº›æ–¹æ³•å¯ä»¥è·¨åŸŸè°ƒç”¨    std::vector&lt;std::string&gt; allowedHeaders; //å…è®¸å‰ç«¯è¯·æ±‚é‡Œå¸¦å“ªäº›è¯·æ±‚å¤´    bool allowCredentials = false; //ä¸å…è®¸æºå¸¦Cookie/Authorization header/TLS client cert è¿™ç±»å‡­è¯ä¿¡æ¯    int maxAge = 3600;             //æµè§ˆå™¨ç¼“å­˜é¢„æ£€è¯·æ±‚çš„æœ€å¤§æ—¶é•¿, 1 å°æ—¶å†…åŒæ ·çš„è·¨åŸŸè¯·æ±‚åªä¼šå‘é€ä¸€æ¬¡ OPTIONSï¼Œä¹‹åç›´æ¥ç”¨ç¼“å­˜çš„ç»“æœ        static CorsConfig defaultConfig()     &#123;        CorsConfig config;        config.allowedOrigins = &#123;&quot;*&quot;&#125;; //è¿™é‡Œå…è®¸çš„æ˜¯æ‰€æœ‰åŸŸå        config.allowedMethods = &#123;&quot;GET&quot;, &quot;POST&quot;, &quot;PUT&quot;, &quot;DELETE&quot;, &quot;OPTIONS&quot;&#125;; //åœ¨é¢„æ£€è¯·æ±‚ï¼ˆOPTIONSï¼‰çš„å“åº”é‡Œå‘Šè¯‰æµè§ˆå™¨ï¼šåç«¯æ¥å—å“ªäº›æ–¹æ³•        config.allowedHeaders = &#123;&quot;Content-Type&quot;, &quot;Authorization&quot;&#125;; //å…è®¸å‰ç«¯å¸¦Content-Typeï¼ˆæ¯”å¦‚ application/jsonï¼‰å’ŒAuthorizationï¼ˆæºå¸¦JWT Tokenç­‰ï¼‰        return config;    &#125;&#125;;\næœåŠ¡ç«¯è§£æé¢„æ£€è¯·æ±‚å¤„ç†å®¢æˆ·ç«¯å‘æ¥çš„è¯·æ±‚çš„æµç¨‹å¦‚ä¸‹ï¼š\n\nåˆ¤æ–­æ˜¯å¦æ˜¯é¢„æ£€è¯·æ±‚ï¼Œå¦‚æœæ˜¯ï¼Œè¿›å…¥ä¸‹ä¸€æ­¥ï¼›å¦åˆ™ä¸åšå¤„ç†ï¼ˆæ­£å¸¸çš„è¯·æ±‚ï¼Œç»§ç»­åç»­çš„å¤„ç†æµç¨‹ï¼Œå“åº”ï¼‰\næ£€æŸ¥å½“å‰è¯·æ±‚çš„æºæ˜¯å¦è¢«å…è®¸ï¼Œå¦‚æœå…è®¸å½“å‰è¯·æ±‚æºåˆ™åœ¨å“åº”å¤´ä¸­æ·»åŠ è¯¥æºå­—æ®µï¼ŒçŠ¶æ€ç ä¸º204 No content,å“åº”ä½“ä¸ºç©ºï¼Œè¿›å…¥ä¸‹ä¸€æ­¥\nç›´æ¥æŠ›å‡ºç‰¹æ®Šçš„å“åº”å¯¹è±¡ï¼ˆä¸­æ–­åç»­çš„å¤„ç†æµç¨‹ï¼‰\n\næ€»ç»“ï¼šå¦‚æœæ˜¯é¢„æ£€è¯·æ±‚ï¼Œè®¾ç½®Corsçš„ç›¸å…³å­—æ®µï¼Œç›´æ¥è¿”å›ï¼›å¦åˆ™å°±è¿›å…¥æ­£å¸¸çš„å¤„ç†æµç¨‹ã€‚\n/** *  @brief è¯·æ±‚å‰é’©å­ï¼Œæ‰€æœ‰è¯·æ±‚è¿›æ¥æ—¶éƒ½ä¼šå…ˆæ‰§è¡Œ * å¦‚æœæ˜¯è·¨åŸŸçš„ OPTIONS é¢„æ£€è¯·æ±‚ï¼Œç›´æ¥æ„é€ å“åº”å¹¶æŠ›å‡ºï¼Œè·³è¿‡åç»­ä¸­é—´ä»¶/è·¯ç”±é€»è¾‘ã€‚ */void CorsMiddleware::before(HttpRequest&amp; request) &#123;    LOG_DEBUG &lt;&lt; &quot;CorsMiddleware::before - Processing request&quot;;        // å¦‚æœæ˜¯æµè§ˆå™¨å‘èµ·çš„é¢„æ£€è¯·æ±‚ï¼ˆCORS Preflightï¼‰    if (request.method() == HttpRequest::Method::kOptions)     &#123;        LOG_INFO &lt;&lt; &quot;Processing CORS preflight request&quot;;        HttpResponse response;  // åˆ›å»ºé¢„æ£€å“åº”        handlePreflightRequest(request, response);        // ç›´æ¥ä¸­æ–­åç»­å¤„ç†æµç¨‹ï¼ŒæŠ›å‡ºç‰¹æ®Šçš„å“åº”å¯¹è±¡        throw response;    &#125;&#125;/** * @brief å¤„ç† CORS é¢„æ£€è¯·æ±‚ï¼ˆOPTIONSï¼‰ * ä¼šæ ¡éªŒ Originï¼Œå¹¶è¿”å›å…è®¸çš„è·¨åŸŸå¤´ */void CorsMiddleware::handlePreflightRequest(const HttpRequest&amp; request,                                           HttpResponse&amp; response) &#123;        // ä»è¯·æ±‚å¤´è·å– Origin    const std::string&amp; origin = request.getHeader(&quot;Origin&quot;);        // æ ¡éªŒæ˜¯å¦å…è®¸è·¨åŸŸ    if (!isOriginAllowed(origin))     &#123;        LOG_WARN &lt;&lt; &quot;Origin not allowed: &quot; &lt;&lt; origin;        response.setStatusCode(HttpResponse::k403Forbidden);        return;    &#125;    // æ·»åŠ å…è®¸çš„è·¨åŸŸå¤´,å¯¹é¢„æ£€è¯·æ±‚è¿”å› 204 No Contentï¼›    //å³å“åº”ä½“ä¸ºç©ºï¼Œå¯¹åº”è¿”å›çš„æ˜¯optionså­—æ®µçš„é¢„æ£€è¯·æ±‚çš„å“åº”    addCorsHeaders(response, origin);    response.setStatusCode(HttpResponse::k204NoContent);    LOG_INFO &lt;&lt; &quot;Preflight request processed successfully&quot;;&#125;/** * @brief æ£€æŸ¥ç»™å®š Origin æ˜¯å¦åœ¨å…è®¸åˆ—è¡¨é‡Œ * @param origin æ¥è‡ªæµè§ˆå™¨è¯·æ±‚å¤´çš„ Origin * @return true å¦‚æœå…è®¸è·¨åŸŸï¼Œå¦åˆ™ false */bool CorsMiddleware::isOriginAllowed(const std::string&amp; origin) const &#123;    return config_.allowedOrigins.empty() ||            std::find(config_.allowedOrigins.begin(),                     config_.allowedOrigins.end(), &quot;*&quot;) != config_.allowedOrigins.end() ||           std::find(config_.allowedOrigins.begin(),                     config_.allowedOrigins.end(), origin) != config_.allowedOrigins.end(); &#125;/** * @brief ç»™å“åº”æ·»åŠ æ ‡å‡†çš„ CORS å¤´ä¿¡æ¯ * @param response å½“å‰å“åº”å¯¹è±¡ * @param origin æœ¬æ¬¡è¯·æ±‚å…è®¸çš„ Origin */void CorsMiddleware::addCorsHeaders(HttpResponse&amp; response,                                   const std::string&amp; origin) &#123;    try     &#123;           // è®¾ç½®å…è®¸çš„ Origin        response.addHeader(&quot;Access-Control-Allow-Origin&quot;, origin);                // æ˜¯å¦å…è®¸æºå¸¦ cookie        if (config_.allowCredentials)         &#123;            response.addHeader(&quot;Access-Control-Allow-Credentials&quot;, &quot;true&quot;);        &#125;                // è®¾ç½®å…è®¸çš„æ–¹æ³•åˆ—è¡¨,ä»¥ï¼Œåˆ†å‰²        if (!config_.allowedMethods.empty())         &#123;            response.addHeader(&quot;Access-Control-Allow-Methods&quot;,                              join(config_.allowedMethods, &quot;, &quot;));        &#125;                // è®¾ç½®å…è®¸çš„è‡ªå®šä¹‰è¯·æ±‚å¤´åˆ—è¡¨        if (!config_.allowedHeaders.empty())         &#123;            response.addHeader(&quot;Access-Control-Allow-Headers&quot;,                              join(config_.allowedHeaders, &quot;, &quot;));        &#125;        // è®¾ç½®é¢„æ£€ç»“æœçš„ç¼“å­˜æ—¶é—´ï¼ˆå•ä½ï¼šç§’ï¼‰        response.addHeader(&quot;Access-Control-Max-Age&quot;,                           std::to_string(config_.maxAge));                LOG_DEBUG &lt;&lt; &quot;CORS headers added successfully&quot;;    &#125;     catch (const std::exception&amp; e)     &#123;        LOG_ERROR &lt;&lt; &quot;Error adding CORS headers: &quot; &lt;&lt; e.what();    &#125;&#125;/** * @brief å·¥å…·å‡½æ•°ï¼šæŠŠå­—ç¬¦ä¸²æ•°ç»„ç”¨æŒ‡å®šåˆ†éš”ç¬¦æ‹¼æ¥èµ·æ¥ * @param strings å­—ç¬¦ä¸²åˆ—è¡¨ * @param delimiter åˆ†éš”ç¬¦ï¼Œå¦‚ &quot;, &quot; * @return æ‹¼æ¥åçš„å­—ç¬¦ä¸² */std::string CorsMiddleware::join(const std::vector&lt;std::string&gt;&amp; strings, const std::string&amp; delimiter) &#123;    std::ostringstream result;    for (size_t i = 0; i &lt; strings.size(); ++i)     &#123;        if (i &gt; 0) result &lt;&lt; delimiter;        result &lt;&lt; strings[i];    &#125;    return result.str();&#125;\n\næœåŠ¡ç«¯å¡«å……å“åº”è¿™é‡Œçš„å“åº”æŒ‡çš„æ˜¯æ­£å¸¸å¤„ç†å®¢æˆ·ç«¯å‘æ¥çš„è¯·æ±‚åï¼Œåœ¨æœ€ç»ˆçš„å“åº”å¤´ä¸­æ·»åŠ CORSçš„ç›¸å…³ä¿¡æ¯\n/** * @brief è¯·æ±‚åé’©å­ï¼Œæ­£å¸¸è¯·æ±‚å¤„ç†å®Œæ¯•åæ‰§è¡Œã€‚ * ä¸ç®¡æ˜¯å¦è·¨åŸŸï¼Œéƒ½ä¼šåœ¨æœ€ç»ˆå“åº”å¤´é‡ŒåŠ ä¸Š CORS ç›¸å…³å¤´ä¿¡æ¯ã€‚ */void CorsMiddleware::after(HttpResponse&amp; response) &#123;    LOG_DEBUG &lt;&lt; &quot;CorsMiddleware::after - Processing response&quot;;        // ç›´æ¥æ·»åŠ CORSå¤´ï¼Œç®€åŒ–å¤„ç†é€»è¾‘    if (!config_.allowedOrigins.empty())     &#123;        // å¦‚æœå…è®¸æ‰€æœ‰æº        if (std::find(config_.allowedOrigins.begin(), config_.allowedOrigins.end(), &quot;*&quot;)             != config_.allowedOrigins.end())         &#123;            addCorsHeaders(response, &quot;*&quot;);        &#125;         else         &#123;            // ç®€å•å¤„ç†ï¼šåªå–ç¬¬ä¸€ä¸ªå…è®¸çš„æ¥æºï¼ˆå¯ä»¥æŒ‰éœ€æ”¹æˆåŒ¹é…å®é™…è¯·æ±‚æ¥æºï¼‰            addCorsHeaders(response, config_.allowedOrigins[0]);        &#125;    &#125;&#125;\næŠ“åŒ…åˆ†æä¸Šå›¾å±•ç¤ºäº†è¯·æ±‚ä¸å“åº”çš„æŠ“åŒ…åˆ†ææ•°æ®ï¼šå½“å®¢æˆ·ç«¯å‘æœåŠ¡å™¨è¯·æ±‚åŠ è½½ç™»å½•é¡µé¢æ—¶ï¼ŒæœåŠ¡å™¨ä¸ä»…ä¼šåœ¨å“åº”ä½“ä¸­è¿”å›HTMLæ–‡ä»¶ï¼Œè¿˜ä¼šåœ¨å“åº”å¤´ä¸­é™„å¸¦CORSé…ç½®ä¿¡æ¯ä¾›æµè§ˆå™¨è§£æã€‚CORS è¯¦è§£ï¼Œç»ˆäºä¸ç”¨æ‹…å¿ƒè·¨åŸŸé—®é¢˜äº†\n","categories":["LiteHub"],"tags":["ç½‘ç»œ","åç«¯"]},{"title":"LiteHubä¹‹ç¯å¢ƒé…ç½®","url":"/undefined/LiteHub_env_conf/","content":"\n\n\nä»“åº“åœ°å€æ¼”ç¤ºåœ°å€\nç¦ç”¨è‡ªåŠ¨æ›´æ–°sudo systemctl stop apt-daily.timersudo systemctl stop apt-daily-upgrade.timersudo systemctl disable apt-daily.timersudo systemctl disable apt-daily-upgrade.timer\nå®‰è£…boostsudo apt-get install libbz2-devsudo apt-get install libicu-dev//ä¸‹è½½åœ°å€https://sourceforge.net/projects/boost/files/boost/1.69.0/tar -xvf å‹ç¼©åŒ…./bootstrap.sh./b2sudo ./b2 --prefix=/usr/local/boost install//æ·»åŠ ç¯å¢ƒå˜é‡vim /etc/environmentCPLUS_INCLUDE_PATH=/usr/local/boost/includeLIBRARY_PATH=/usr/local/boost/lib\nLinuxï¼šç¼–è¯‘å®‰è£…boost 1.69åº“\nå®‰è£…muduoåº“sudo apt install g++ cmake make libboost-dev//ä¸‹è½½å¹¶è§£å‹æ–‡ä»¶./build.sh./build.sh installcd ../build/cd release-install-cpp11cd include/mv muduo/ /usr/include/cd ../libmv * /usr/local/lib/\nmuduoç½‘ç»œåº“ä¸‹è½½å®‰è£…æ•™ç¨‹\nå®‰è£…mysqlsudo wget https://downloads.mysql.com/archives/get/p/23/file/mysql-server_5.7.29-1ubuntu18.04_amd64.deb-bundle.tarsudo tar -xvf mysql-server_5.7.29-1ubuntu18.04_amd64.deb-bundle.tar//æ›´æ–°ä¾èµ–æºsudo apt-get update//å®‰è£…ä¾èµ–åŒ…sudo apt-get install ./libmysql*sudo apt-get install libtinfo5sudo apt-get install ./mysql-community-client_5.7.29-1ubuntu18.04_amd64.debsudo apt-get install ./mysql-client_5.7.29-1ubuntu18.04_amd64.debsudo apt-get install ./mysql-community-server_5.7.29-1ubuntu18.04_amd64.deb sudo apt-get install ./mysql-server_5.7.29-1ubuntu18.04_amd64.deb//è¿æ¥æ•°æ®åº“mysql -u root -p//å¼€å¯è¿œç¨‹è®¿é—®use mysql;select User,Host from user;GRANT ALL PRIVILEGES ON *.* TO &#x27;root&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;root&#x27; WITH GRANT OPTION;flush privileges;vim /etc/mysql/mysql.conf.d/mysqld.cnf å°†Bindaddres ä»127.0.0.1 æ”¹ä¸º0.0.0.0systemctl restart mysql\nUbuntu22éƒ¨ç½²MySQL5.7è¯¦ç»†æ•™ç¨‹\nUbuntu22éƒ¨ç½²MySQL5.7è¯¦ç»†æ•™ç¨‹\nå…¶ä»–é…ç½®//å®‰è£…nlohmann/jsonsudo apt upgradesudo apt install nlohmann-json3-dev//c++ mysql åº“sudo apt install libmysqlcppconn-dev//å®‰è£…opensslå¼€å‘åº“sudo apt install libssl-dev//å®‰è£…ffmpegåº“sudo apt-get install ffmpegffmpeg -version//å®‰è£…gzipsudo apt-get install gzipgzip --versionsudo apt install zlibsudo apt install zlib1g-dev\nåˆ›å»ºè¡¨æ“ä½œ//åˆ›å»ºwebæ•°æ®åº“create database webdb;use webdb;//åˆ›å»ºç”¨æˆ·è¡¨create table users (id int(11) not null auto_increment,username varchar(255) not null,password varchar(255) not null,primary key(id));//åˆ›å»ºæ–‡ä»¶ä¿¡æ¯è¡¨CREATE TABLE fileinfo (    id INT AUTO_INCREMENT PRIMARY KEY,    filename VARCHAR(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,    username VARCHAR(100) NOT NULL,    uploadtime DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,    duration FLOAT DEFAULT NULL,    isvideo   TINYINT(1) NOT NULL DEFAULT 0) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;;//åˆ›å»ºè¯„è®ºè¡¨CREATE TABLE comments (  id INT AUTO_INCREMENT PRIMARY KEY,  video_name VARCHAR(255) NOT NULL,  user_id INT NOT NULL,  parent_id INT DEFAULT 0,  content TEXT NOT NULL,  created_at DATETIME DEFAULT CURRENT_TIMESTAMP) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;CREATE TABLE video_likes (    user_id INT(11) NOT NULL,    video_name VARCHAR(255)  NOT NULL,    PRIMARY KEY (user_id, video_name))CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;CREATE TABLE video_stats (    video_name VARCHAR(255)  NOT NULL,    view_count INT(11) DEFAULT 0,    like_count INT(11) DEFAULT 0,    PRIMARY KEY (video_name)) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;//æˆ–è€…ç›´æ¥è®¾ç½®æ•´ä¸ªæ•°æ®åº“ä½¿ç”¨è¿™ä¸ªå­—ç¬¦é›†ALTER DATABASE mydatabase CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;\nå…±åˆ›å»ºå¦‚ä¸‹å‡ ä¸ªè¡¨\n","categories":["LiteHub"],"tags":["åç«¯"]},{"title":"LiteHubä¹‹æ–‡ä»¶ä¸‹è½½ä¸è§†é¢‘æ’­æ”¾","url":"/undefined/LiteHub_filedownload&&videoplay/","content":"\n\n\n\n\næ–‡ä»¶ä¸‹è½½å‰ç«¯è¯·æ±‚ç®­å¤´å‡½æ•°//è¿™ä¸ªç®­å¤´å‡½æ•°å¯ä»¥å½¢è±¡ç†è§£ä¸ºï¼Œxæµå…¥ï¼ˆ=&gt;ï¼‰x*x,//è‡ªç„¶è€Œç„¶=&gt;å‰é¢çš„å°±æ˜¯ä¼ å…¥å‚æ•°,=&gt;è¡¨ç¤ºå‡½æ•°ä½“x =&gt; x * x//ç›¸å½“äºfunction (x) &#123;    return x * x;&#125;//å¦‚æœå‚æ•°ä¸æ˜¯ä¸€ä¸ªï¼Œå°±éœ€è¦ç”¨æ‹¬å·()æ‹¬èµ·æ¥ï¼š(x, y) =&gt; x * x + y * y\n\næœ¬é¡¹ç›®çš„è¯·æ±‚ä¸‹è½½å‰ç«¯ä»£ç ä¸ºï¼š\n function downloadFile(resourceId, filename, progressBar, statusText) &#123;        fetch(&#x27;/resource/download&#x27;, &#123;            method: &#x27;POST&#x27;,            headers: &#123; &#x27;Content-Type&#x27;: &#x27;application/json&#x27; &#125;,            body: JSON.stringify(&#123; resourceId &#125;) //é€šè¿‡postæ–¹å¼å°†è¦ä¸‹è½½çš„æ–‡ä»¶è·¯å¾„å‘é€ç»™åç«¯        &#125;)            .then(response =&gt; &#123;            if (!response.ok) &#123;                throw new Error(&#x27;ä¸‹è½½å¤±è´¥&#x27;);            &#125;            const contentLength = response.headers.get(&#x27;Content-Length&#x27;);            const total = contentLength ? parseInt(contentLength, 10) : 0;//è¿”å›å†…å®¹é•¿åº¦            const reader = response.body.getReader(); //è¿™ä¸ªå¯ä»¥é€å—æä¾›body            const chunks = [];            let received = 0;            const pump = () =&gt; reader.read()              .then((&#123; done, value &#125;) =&gt; &#123;                if (done) &#123;//å¦‚æœè¯»å–å®Œæˆï¼Œæ•´ä¸ªæ–‡ä»¶å·²ä¸‹è½½                const blob = new Blob(chunks);//å°†æ‰€æœ‰å°æ®µchunksè½¬æ¢æˆä¸€ä¸ªå®Œæˆçš„blob(binary large object)                const url = window.URL.createObjectURL(blob);//æµè§ˆå™¨åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„URLåœ°å€æ¥è·å–è¿™ä¸ªæ•°æ®                //å¦‚blob:http://localhost/17dfc4b1-df34-4a93-a6a7-6df9f1e85e0c                const a = document.createElement(&#x27;a&#x27;);                a.href = url;                a.download = filename;                document.body.appendChild(a);                a.click();//æ¨¡æ‹Ÿç‚¹å‡»æµè§ˆå™¨çš„ä¸‹è½½è¡Œä¸º                document.body.removeChild(a);                window.URL.revokeObjectURL(url);//é¿å…å†…å­˜æ³„éœ²                progressBar.style.width = &#x27;100%&#x27;;                statusText.textContent = &#x27;ä¸‹è½½å®Œæˆ&#x27;;                return;                &#125;                chunks.push(value);                received += value.length;                //æ›´æ–°ä¸‹è½½è¿›åº¦                if (total &gt; 0) &#123;                const percent = Math.floor((received / total) * 100);                progressBar.style.width = percent + &#x27;%&#x27;;                progressBar.textContent = percent + &#x27;%&#x27;;                statusText.textContent = `ä¸‹è½½ä¸­ $&#123;percent&#125;%`;                &#125; else &#123;                statusText.textContent = `ä¸‹è½½ä¸­ï¼ˆæœªçŸ¥å¤§å°ï¼‰`;                &#125;                //é€’å½’è°ƒç”¨ pumpï¼ˆç»§ç»­è¯»å–ä¸‹ä¸€æ®µï¼‰                return pump();            &#125;);            return pump();            &#125;)            .catch(error =&gt; &#123;            console.error(&#x27;ä¸‹è½½å‡ºé”™ï¼š&#x27;, error);            progressBar.style.backgroundColor = &#x27;red&#x27;;            statusText.textContent = &#x27;ä¸‹è½½å¤±è´¥&#x27;;            &#125;);        &#125;//ç±»æ¯”// åç«¯ï¼šç”¨æ°´é¾™å¤´ä¸€ç‚¹ç‚¹æŠŠæ°´æµå‡ºæ¥// å‰ç«¯ï¼šæ¥æ°´å¹¶çŒåˆ°ç“¶å­é‡Œï¼ˆBlobï¼‰// createObjectURLï¼šç»™è¿™ç“¶æ°´è´´ä¸ªæ ‡ç­¾ï¼ˆblob URLï¼‰// ç‚¹å‡»ä¸‹è½½ï¼šæŠŠç“¶å­äº¤ç»™ä½ ä¸‹è½½// revokeObjectURLï¼šæŠŠæ ‡ç­¾æ’•æ‰ï¼Œæ¸…ç†å†…å­˜\nå¯¹äºpumpå‡½æ•°çš„ç†è§£ï¼Œç»“åˆç®­å¤´å‡½æ•°å’Œpromise\n\nreader.read() â—‹ è¿”å›ä¸€ä¸ª Promise&lt;{ done: boolean, value: Uint8Array }&gt;ã€‚ â—‹ done: true è¡¨ç¤ºè¯»å–å®Œäº†ï¼› â—‹ value æ˜¯å½“å‰è¯»å–çš„ä¸€æ®µæ•°æ®ï¼ˆUint8Array æ ¼å¼ï¼‰ã€‚\nç®­å¤´å‡½æ•° () &#x3D;&gt; reader.read().then(â€¦)â—‹  è¿™æ˜¯ä¸€ä¸ªè¿”å› Promise çš„å‡½æ•°ã€‚â—‹ done: true è¡¨ç¤ºè¯»å–å®Œäº†ï¼›â—‹ value æ˜¯å½“å‰è¯»å–çš„ä¸€æ®µæ•°æ®ï¼ˆUint8Array æ ¼å¼ï¼‰ã€‚\nç®­å¤´å‡½æ•° () &#x3D;&gt; reader.read().then(({ done, value }) &#x3D;&gt; { return dump()} â–  ()&#x3D;&gt;reader.read(),æ— å‚æ•°ä¼ å…¥ï¼Œæ‰§è¡Œreader.read()ï¼Œè¿”å›reader.read()æ‰§è¡Œçš„ç»“æœ{done,value}ã€‚ â–  .then({ done, value })é€šè¿‡ä¸Šä¸€æ­¥æ¥æ”¶è¿™ä¸¤ä¸ªæ•°æ®ï¼Œç„¶åé€šè¿‡è¿™ä¸¤ä¸ªæ‰§è¡Œç›¸åº”å†…å®¹ï¼› â–  å¦‚æœdoneä¸ºfalseï¼Œè¡¨ç¤ºè¿˜æ²¡æ‰§è¡Œå®Œæˆï¼Œchunks.push(value)ï¼šæŠŠè¿™ä¸€æ®µåŠ å…¥ç¼“å­˜  ï¼Œæ›´æ–°è¿›åº¦æ¡ï¼Œ é€’å½’è°ƒç”¨è‡ªèº«ï¼Œç»§ç»­ä¸‹ä¸€æ®µè¯»å–  ï¼ˆreturn pump()ï¼‰ã€‚\n\nåç«¯å“åº” FileUtil file(filePath); if (!file.isValid()) //åˆ¤æ–­è¯·æ±‚çš„æ–‡ä»¶æ˜¯å¦æœ‰æ•ˆ&#123;    LOG_WARN &lt;&lt; filePath &lt;&lt; &quot;not exist.&quot;;    resp-&gt;setStatusLine(req.getVersion(), http::HttpResponse::k404NotFound, &quot;Not Found&quot;);    resp-&gt;setContentType(&quot;text/plain&quot;);    std::string resp_info=&quot;File not found&quot;;    resp-&gt;setContentLength(resp_info.size());    resp-&gt;setBody(resp_info);&#125;//è®¾ç½®ç›¸åº”å¤´resp-&gt;setStatusLine(req.getVersion(), http::HttpResponse::k200Ok, &quot;OK&quot;);resp-&gt;setCloseConnection(false);resp-&gt;setContentType(&quot;application/octet-stream&quot;);std::string filename = std::filesystem::path(filePath).filename().string();LOG_INFO&lt;&lt;&quot;filename:&quot;&lt;&lt;filename;resp-&gt;addHeader(&quot;Content-Disposition&quot;, &quot;attachment; filename=\\&quot;&quot; + filename + &quot;\\&quot;&quot;);//è®¾ç½®å“åº”æ ¼å¼ä¸ºæ–‡ä»¶ç±»å‹ï¼Œå¹¶æ·»åŠ æ–‡ä»¶çš„è·¯å¾„resp-&gt;setContentLength(file.size());resp-&gt;setisFileResponse(filePath);\nè®¾è®¡äº®ç‚¹åœ¨HttpResponse.hå¤´æ–‡ä»¶ä¸­\npublic:    bool isFileResponse() const &#123;return isFileResponse_;&#125;    std::string getFilePath() &#123;return filePath_;&#125;    void setisFileResponse(const std::string&amp; path)    &#123;         isFileResponse_ = true;         filePath_ = path;    &#125;private:bool                               isFileResponse_; //åˆ¤æ–­æ˜¯å¦æ˜¯æ–‡ä»¶ï¼Œå¦‚æœæ˜¯ï¼Œé‡‡ç”¨æµå¼å‘é€std::string                        filePath_;\nåœ¨httpserverçš„è¯·æ±‚å‡½æ•°ä¸­åˆ¤æ–­ï¼Œå¦‚æœæ˜¯æ–‡ä»¶ç±»å‹ï¼Œå°±è°ƒç”¨tcpconnectionå…ˆå°†å“åº”å¤´å‘é€å‡ºå»ï¼Œç„¶åå°†æ¶ˆæ¯ä½“åˆ†å°å—å‘é€ï¼Œè¿™é‡Œè®¾ç½®çš„æ˜¯8kbï¼›å¦‚æœä¸æ˜¯æ–‡ä»¶ç±»å‹ï¼Œç›´æ¥å°†æ•´ä¸ªå“åº”å‘é€å‡ºå»åœ¨HttpServer::onRequestå‡½æ•°ä¸­\n// ç»™responseè®¾ç½®ä¸€ä¸ªæˆå‘˜ï¼Œåˆ¤æ–­æ˜¯å¦è¯·æ±‚çš„æ˜¯æ–‡ä»¶ï¼Œå¦‚æœæ˜¯æ–‡ä»¶è®¾ç½®ä¸ºtrueï¼Œå¹¶ä¸”å­˜åœ¨æ–‡ä»¶ä½ç½®åœ¨è¿™é‡Œsendå‡ºå»ã€‚if (!response.isFileResponse())&#123;\t    //ä¸æ˜¯æ–‡ä»¶ç±»å‹    muduo::net::Buffer buf;    response.appendToBuffer(&amp;buf);        conn-&gt;send(&amp;buf);&#125;else&#123;     // 1. æ„é€ å“åº”å¤´    muduo::net::Buffer headerBuf;    response.appendToBuffer(&amp;headerBuf);  // åªæ·»åŠ çŠ¶æ€è¡Œå’Œå¤´éƒ¨ï¼Œä¸åŒ…å« body    conn-&gt;send(&amp;headerBuf);  // å…ˆå‘ header    // 2. å‘é€æ–‡ä»¶å†…å®¹ï¼ˆåˆ†å—ï¼‰    const std::string filePath = response.getFilePath();    std::ifstream file(filePath, std::ios::binary);// ä»¥äºŒè¿›åˆ¶æ¨¡å¼æ‰“å¼€æ–‡ä»¶    if (file) &#123;        const size_t bufferSize = 8192; \t\t\t// 8KB ç¼“å†²åŒº        char buffer[bufferSize];                  // æ ˆä¸Šåˆ†é…ç¼“å†²åŒº        while (file) &#123;                            // å¾ªç¯ç›´åˆ°æ–‡ä»¶è¯»å–ç»“æŸæˆ–å‡ºé”™            file.read(buffer, bufferSize);        // è¯»å–æœ€å¤š bufferSize å­—èŠ‚åˆ° buffer            std::streamsize bytesRead = file.gcount(); // å®é™…è¯»å–çš„å­—èŠ‚æ•°            if (bytesRead &gt; 0) &#123;                conn-&gt;send(muduo::StringPiece(buffer, bytesRead));// å‘é€æ•°æ®å—            &#125;        &#125;    &#125; else &#123;        // æ–‡ä»¶æ‰“ä¸å¼€ï¼Œè¡¥å¿é”™è¯¯æç¤º        muduo::net::Buffer errBuf;        errBuf.append(&quot;HTTP/1.1 500 Internal Server Error\\r\\n\\r\\nFile open failed&quot;);        conn-&gt;send(&amp;errBuf);    &#125;&#125;\nä¹‹æ‰€ä»¥æ˜¯åœ¨httpserverä¸Šåˆ†å—å‘é€æ•°æ®æµï¼Œæ˜¯ä¸ºäº†ä¿è¯ä»£ç è¾ƒå¥½çš„å±‚æ¬¡æ€§ï¼Œhttpserverè´Ÿè´£ç®¡ç†å¤šä¸ªtcpè¿æ¥ï¼ŒåŒ…æ‹¬å‘é€æ¶ˆæ¯å’Œæ¥æ”¶æ¶ˆæ¯ç­‰ã€‚\nè§†é¢‘æ’­æ”¾  // ä»è¯·æ±‚ä¸­è·å– Range å¤´ï¼Œä¾‹å¦‚ &quot;bytes=1000-2000&quot;    std::string rangeHeader = req.getHeader(&quot;Range&quot;);    LOG_INFO &lt;&lt; &quot;Range Header: &quot; &lt;&lt; rangeHeader;    // é»˜è®¤èµ·å§‹å­—èŠ‚ start=0ï¼Œç»“æŸå­—èŠ‚ end=æ–‡ä»¶å¤§å°-1ï¼Œè¡¨ç¤ºå®Œæ•´æ–‡ä»¶    std::streamsize start = 0, end = fileSize - 1;    // æ ‡è®°æ˜¯å¦æ˜¯åˆ†å—å“åº”    bool isPartial = false;    if (!rangeHeader.empty()) &#123;        // å¦‚æœå®¢æˆ·ç«¯å¸¦äº† Rangeï¼Œåˆ™æ ‡è®°ä¸ºåˆ†å—ä¼ è¾“        isPartial = true;        long s = 0, e = -1;         // ä½¿ç”¨ sscanf è§£ææ ¼å¼ bytes=&lt;start&gt;-&lt;end&gt;        // æ³¨æ„ï¼šç”¨æˆ·å¯èƒ½åªå†™äº†èµ·å§‹ï¼Œæ²¡æœ‰å†™ç»“æŸï¼Œæ‰€ä»¥è¦åˆ¤æ–­ sscanf è¿”å›å€¼        int n = sscanf(rangeHeader.c_str(), &quot;bytes=%ld-%ld&quot;, &amp;s, &amp;e);        start = s;        if (n == 1 || e == -1) &#123;// å¦‚æœåªè§£æåˆ° 1 ä¸ªæ•°ï¼Œæˆ–è€…ç»“æŸä¸º -1ï¼Œåˆ™è¡¨ç¤ºè¯»åˆ°æ–‡ä»¶æœ«å°¾            end = fileSize - 1;        &#125; else &#123;            // è§£æåˆ°ä¸¤ä¸ªæ•°ï¼Œä¸”ç»“æŸä¸èƒ½è¶…è¿‡æ–‡ä»¶å¤§å°            end = std::min((std::streamsize)e, fileSize - 1);        &#125;         // åˆæ³•æ€§æ£€æŸ¥ï¼šstart å¿…é¡»å°äºç­‰äº end ä¸”å°äºæ–‡ä»¶å¤§å°        if (start &gt; end || start &gt;= fileSize) &#123;            // å¦‚æœä¸åˆæ³•ï¼Œè¿”å› 416 çŠ¶æ€ç ï¼ˆRequested Range Not Satisfiableï¼‰            resp-&gt;setStatusLine(req.getVersion(), http::HttpResponse::k416RequestedRangeNotSatisfiable, &quot;Requested Range Not Satisfiable&quot;);            char rangeValue[64];            // Content-Range å¿…é¡»å¸¦ &quot;*/æ€»å¤§å°&quot;            snprintf(rangeValue, sizeof(rangeValue), &quot;bytes */%ld&quot;, fileSize);            resp-&gt;addHeader(&quot;Content-Range&quot;, rangeValue);            resp-&gt;setCloseConnection(true);            resp-&gt;setContentType(&quot;text/plain&quot;);            resp-&gt;setBody(&quot;Invalid Range&quot;);            return;        &#125;    &#125;    // è®¡ç®—éœ€è¦è¯»å–çš„ chunkSize    std::streamsize chunkSize = end - start + 1;    std::vector&lt;char&gt; buffer(chunkSize);    // å¦‚æœéœ€è¦åˆ†å—ï¼Œæœ€å¥½è¿™é‡Œé™åˆ¶ä¸€ä¸‹ chunkSizeï¼Œé˜²æ­¢å†…å­˜è¿‡å¤§    // å®šä½åˆ°è¦è¯»çš„èµ·å§‹ä½ç½®    file.seekg(start, std::ios::beg);    // ä»æ–‡ä»¶è¯»å‡º chunkSize å¤§å°çš„æ•°æ®åˆ° buffer    file.read(buffer.data(), chunkSize);    // === æ„é€ å“åº” ===    if (isPartial) &#123;        resp-&gt;setStatusLine(req.getVersion(), http::HttpResponse::k206PartialContent, &quot;Partial Content&quot;);        char rangeHeaderValue[128];        snprintf(rangeHeaderValue, sizeof(rangeHeaderValue),                &quot;bytes %ld-%ld/%ld&quot;, start, end, fileSize);        resp-&gt;addHeader(&quot;Content-Range&quot;, rangeHeaderValue);    &#125; else &#123;        resp-&gt;setStatusLine(req.getVersion(), http::HttpResponse::k200Ok, &quot;OK&quot;);    &#125;    resp-&gt;addHeader(&quot;Accept-Ranges&quot;, &quot;bytes&quot;);// æ— è®ºæ˜¯å¦åˆ†å—ï¼Œéƒ½è¦å‘ŠçŸ¥æ”¯æŒåˆ†å—    resp-&gt;setContentType(&quot;video/mp4&quot;);         // è®¾ç½®å†…å®¹ç±»å‹ä¸º mp4 è§†é¢‘    resp-&gt;setContentLength(buffer.size());     // è®¾ç½® Content-Length    resp-&gt;setBody(std::string(buffer.begin(), buffer.end()));  // æŠŠè¯»å–çš„æ–‡ä»¶å—è®¾ç½®åˆ°å“åº”ä½“&#125;\nåç«¯æ¶‰åŠå¯¹è¯·æ±‚ä½“ä¸­çš„rangeå­—æ®µè¿›è¡Œè§£æï¼Œåˆ¤æ–­rangeå­—æ®µçš„åˆæ³•æ€§ï¼Œéšåæ ¹æ®rangeå­—æ®µè¯·æ±‚å†…å®¹å†³å®šæ˜¯è¿”å›éƒ¨åˆ†å†…å®¹è¿˜æ˜¯å…¨éƒ¨å†…å®¹ã€‚è¯·æ±‚æ‰€æœ‰å†…å®¹ï¼šä¾æ¬¡æ‹–åŠ¨æ’­æ”¾è¿›åº¦æ¡ï¼Œrangeå­—æ®µå‘ç”Ÿæ”¹å˜ï¼Œæ ¼å¼ä¸ºâ€“å­—æ®µï¼Œè¿™é‡Œæ˜¯è¯·æ±‚ä»æŸä¸€æ—¶åˆ»åˆ°è§†é¢‘ç»“æŸã€‚è¯·æ±‚éƒ¨åˆ†å†…å®¹ï¼šè¿™é‡Œè¯·æ±‚çš„æ˜¯ä»å­—èŠ‚6000-18000å¤§å°çš„æ•°æ®ï¼Œè¿”å›çš„å“åº”ä¸ºè¿™é‡Œçš„å“åº”å¤´å­—æ®µä¸º206 partial content,è¡¨ç¤ºå“åº”è¿”å›çš„åªæ˜¯è§†é¢‘çš„ä¸€éƒ¨åˆ†æ•°æ®ã€‚\n\nrangeçš„åˆæ³•æ€§æ ¡éªŒè¿™é‡Œæˆ‘æ‰‹åŠ¨æŒ‡å®šrangeçš„èŒƒå›´ä¸º6000-18000000000000ï¼Œå®é™…æ˜¯è¶…å‡ºäº†è¯·æ±‚è§†é¢‘çš„æœ€å¤§èŒƒå›´ï¼Œçœ‹çœ‹æœ€åè¿”å›çš„ä»€ä¹ˆã€‚ä½¿ç”¨curlï¼ˆè¿™é‡Œå› ä¸ºæ˜¯æµ‹è¯•ï¼Œæ‰€ä»¥å»æ‰äº†æƒé™çš„åˆ¤å®šï¼Œå®é™…ä¸Šè¿è¡Œçš„æ—¶å€™ä½¿ç”¨curlæ˜¯ä¸å¯è¡Œçš„ï¼‰å¯ä»¥çœ‹åˆ°è¿™é‡Œè¿”å›çš„æ˜¯æ–‡ä»¶çš„æœ€å¤§å¤§å°ã€‚\n","categories":["LiteHub"],"tags":["ç½‘ç»œ","åç«¯"]},{"title":"LiteHubä¹‹æ•°æ®åº“è¿æ¥æ± ","url":"/undefined/LiteHub_databasepool/","content":"\n\n\nç†è®ºéƒ¨åˆ†ä¸ä½¿ç”¨æ•°æ®åº“è¿æ¥æ± æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹æ™®é€šçš„Mysqlçš„è¿æ¥è¿‡ç¨‹ï¼Œä¸‹å›¾æ˜¯æˆ‘æŠ“åŒ…åˆ†æçš„åœ¨ç«¯å£3306çš„æ•°æ®åŒ…ï¼šåœ¨æ‰§è¡ŒMysqlå‘½ä»¤ä¹‹å‰ï¼Œéœ€è¦å…ˆç»è¿‡Tcpçš„ä¸‰æ¬¡æ¡æ‰‹ã€Mysqlçš„è®¤è¯æœåŠ¡ï¼ŒTLSåŠ å¯†æœåŠ¡ç­‰æ“ä½œï¼›ä¸‹å›¾æ¥è‡ªæ•°æ®åº“è¿æ¥æ± å­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰ï¼šåŸç†ä»‹ç»+å¸¸ç”¨è¿æ¥æ± ä»‹ç»ç»è¿‡ä¸Šè¿°åˆ†æï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œå¦‚æœä¸ä½¿ç”¨æ•°æ®åº“è¿æ¥æ± ï¼Œæ‰§è¡Œå•æ¡Mysqlå‘½ä»¤ä¼šå¤šäº†éå¸¸å¤šæˆ‘ä»¬ä¸å…³å¿ƒçš„ç½‘ç»œäº¤äº’ã€‚å¦‚æœæ‰§è¡Œçš„MysqlæŸ¥è¯¢å‘½ä»¤æ¯”è¾ƒå¤šï¼Œå°±ä¼šä¸¥é‡å½±å“æ€§èƒ½ã€‚\n\nä¸ä½¿ç”¨æ•°æ®åº“è¿æ¥æ± ï¼šä¼˜ç‚¹ï¼š å®ç°ç®€å•ç¼ºç‚¹ï¼š ç½‘ç»œIOè¾ƒå¤šæ•°æ®åº“çš„è´Ÿè½½è¾ƒé«˜å“åº”æ—¶é—´è¾ƒé•¿åŠQPSè¾ƒä½åº”ç”¨é¢‘ç¹çš„åˆ›å»ºè¿æ¥å’Œå…³é—­è¿æ¥ï¼Œå¯¼è‡´ä¸´æ—¶å¯¹è±¡è¾ƒå¤šåœ¨å…³é—­è¿æ¥åï¼Œä¼šå‡ºç°å¤§é‡TIME_WAIT çš„TCPçŠ¶æ€ï¼ˆåœ¨2ä¸ªMSLä¹‹åå…³é—­ï¼‰\n\nä½¿ç”¨æ•°æ®åº“è¿æ¥æ± \nåˆå§‹è¿æ¥å»ºç«‹å½“åº”ç”¨ç¨‹åºç¬¬ä¸€æ¬¡è®¿é—®æ•°æ®åº“æ—¶ï¼Œéœ€è¦å®Œæˆä»¥ä¸‹æ­¥éª¤ï¼š\n\nç³»ç»Ÿä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ•°æ®åº“è¿æ¥\nè¿™ä¸ªè¿æ¥éœ€è¦ç»è¿‡èº«ä»½éªŒè¯(ç”¨æˆ·å&#x2F;å¯†ç éªŒè¯)\nå»ºç«‹TCP&#x2F;IPç½‘ç»œè¿æ¥\nåˆå§‹åŒ–ä¼šè¯å‚æ•°å’Œè®¾ç½®\n\nè¿æ¥å¤ç”¨æœºåˆ¶åœ¨åç»­è®¿é—®ä¸­ï¼š\n\nç³»ç»Ÿä¼šä»è¿æ¥æ± ä¸­è·å–å…ˆå‰å»ºç«‹çš„å¯ç”¨è¿æ¥\nç›´æ¥ä½¿ç”¨è¯¥è¿æ¥æ‰§è¡ŒSQLè¯­å¥(å¦‚SELECT, INSERT, UPDATEç­‰)\næ‰§è¡Œè¿‡ç¨‹ä¸­æ— éœ€é‡æ–°è¿›è¡Œèº«ä»½éªŒè¯å’Œè¿æ¥å»ºç«‹\nå…¸å‹çš„å¤ç”¨åœºæ™¯åŒ…æ‹¬ï¼š\nç”¨æˆ·å¤šæ¬¡æŸ¥è¯¢åŒä¸€æ•°æ®è¡¨\nå¤„ç†äº‹åŠ¡ä¸­çš„å¤šä¸ªSQLæ“ä½œ\næ‰§è¡Œæ‰¹é‡æ•°æ®å¤„ç†ä»»åŠ¡\n\n\n\nè¿æ¥å›æ”¶è¿‡ç¨‹\næ¯æ¬¡æŸ¥è¯¢å®Œæˆåï¼š\n\nç³»ç»Ÿä¼šå°†è¿æ¥æ ‡è®°ä¸ºâ€ç©ºé—²â€çŠ¶æ€\nè¿æ¥ä¼šè¢«å½’è¿˜åˆ°è¿æ¥æ± ä¸­\nè¿æ¥ä¿æŒå¼€å¯çŠ¶æ€ï¼Œç­‰å¾…ä¸‹æ¬¡è¯·æ±‚\nå¦‚æœè¿æ¥ç©ºé—²æ—¶é—´è¶…è¿‡é…ç½®çš„é˜ˆå€¼(å¦‚30åˆ†é’Ÿ)ï¼Œå¯èƒ½ä¼šè¢«è‡ªåŠ¨å…³é—­\n\nè¿™ç§æœºåˆ¶æ˜¾è‘—æé«˜äº†æ€§èƒ½ï¼Œå‡å°‘äº†é¢‘ç¹åˆ›å»ºå’Œé”€æ¯è¿æ¥çš„å¼€é”€ã€‚\nå¸¸è§çš„å‡ ç§èµ„æºæ± åœ¨å®é™…åº”ç”¨ä¸­ï¼Œç”±äºåˆ›å»ºå’Œé”€æ¯ç³»ç»Ÿèµ„æºï¼ˆå¦‚è¿æ¥ã€å†…å­˜å—ã€çº¿ç¨‹ç­‰ï¼‰çš„æˆæœ¬å¾€å¾€è¿œé«˜äºä½¿ç”¨èµ„æºçš„æˆæœ¬ï¼Œå› æ­¤é€šå¸¸ä¼šå¼•å…¥èµ„æºæ± çš„æ¦‚å¿µæ¥æé«˜ç³»ç»Ÿæ€§èƒ½ã€‚è¿™ç§æŠ€æœ¯é€šè¿‡é¢„å…ˆåˆ›å»ºå¹¶ç»´æŠ¤ä¸€ç»„å¯é‡ç”¨èµ„æºï¼Œé¿å…äº†é¢‘ç¹çš„èµ„æºåˆå§‹åŒ–å’Œé”€æ¯æ“ä½œï¼Œä»è€Œæ˜¾è‘—æå‡ç³»ç»Ÿæ•ˆç‡ã€‚\nå¸¸è§çš„èµ„æºæ± åŒ…æ‹¬ä»¥ä¸‹å‡ ç§ç±»å‹ï¼š\n\nå†…å­˜æ± ï¼š\n\nåœ¨C++ç¨‹åºå¼€å‘ä¸­ï¼Œmallocé€šè¿‡brk()ç³»ç»Ÿè°ƒç”¨å‘æ“ä½œç³»ç»Ÿç”³è¯·å†…å­˜æ—¶ï¼Œä¼šä¸€æ¬¡æ€§ç”³è¯·è¾ƒå¤§çš„å†…å­˜å—ï¼ˆåªæ˜¯é€šè¿‡brkæ–¹å¼ç”³è¯·çš„å†…å­˜ä¼šç»´æŠ¤å†…å­˜æ± ï¼Œå°å—å†…å­˜ï¼›é€šè¿‡nmapæ–¹å¼ç”³è¯·çš„å¤§å—å†…å­˜ï¼ˆé»˜è®¤æ˜¯å¤§äº128kï¼‰æ²¡æœ‰å†…å­˜æ± ï¼Œæ˜¯ç›´æ¥å½’è¿˜ç»™æ“ä½œç³»ç»Ÿäº†ï¼‰\nå½“ä½¿ç”¨freeé‡Šæ”¾å†…å­˜æ—¶ï¼Œè¿™äº›å†…å­˜å¹¶ä¸ä¼šç«‹å³å½’è¿˜ç»™æ“ä½œç³»ç»Ÿï¼Œè€Œæ˜¯è¢«ç¼“å­˜åœ¨mallocç»´æŠ¤çš„å†…å­˜æ± ä¸­\nå½“ä¸‹æ¬¡ç¨‹åºå†æ¬¡ç”³è¯·å†…å­˜æ—¶ï¼Œmallocä¼šä¼˜å…ˆä»å†…å­˜æ± ä¸­åˆ†é…å¯ç”¨å†…å­˜å—\nä¾‹å¦‚ï¼šå½“ç¨‹åºé¢‘ç¹è¿›è¡Œå°å†…å­˜å—çš„åˆ†é…å’Œé‡Šæ”¾æ—¶ï¼Œå†…å­˜æ± å¯ä»¥é¿å…é¢‘ç¹çš„ç³»ç»Ÿè°ƒç”¨ï¼Œæé«˜å†…å­˜åˆ†é…æ•ˆç‡\n\n\nçº¿ç¨‹æ± ï¼š\n\nä¼ ç»Ÿçš„çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯æ¶‰åŠæ“ä½œç³»ç»Ÿå±‚é¢çš„èµ„æºåˆ†é…å’Œå›æ”¶ï¼Œå¼€é”€è¾ƒå¤§\nçº¿ç¨‹æ± é€šè¿‡é¢„å…ˆåˆ›å»ºä¸€ç»„çº¿ç¨‹å¹¶ä¿æŒæ´»è·ƒçŠ¶æ€ï¼Œç­‰å¾…ä»»åŠ¡åˆ†é…\nä¸»è¦ä¼˜åŠ¿åŒ…æ‹¬ï¼š\nçº¿ç¨‹å¤ç”¨ï¼šé¿å…é¢‘ç¹åˆ›å»ºé”€æ¯çº¿ç¨‹çš„å¼€é”€\nä»»åŠ¡è§£è€¦ï¼šå°†ä»»åŠ¡æäº¤ä¸æ‰§è¡Œåˆ†ç¦»ï¼Œæé«˜ç³»ç»Ÿçµæ´»æ€§\nèµ„æºç®¡ç†ï¼šå¯ä»¥é™åˆ¶å¹¶å‘çº¿ç¨‹æ•°é‡ï¼Œé˜²æ­¢ç³»ç»Ÿè¿‡è½½\n\n\nåº”ç”¨åœºæ™¯ï¼šWebæœåŠ¡å™¨å¤„ç†è¯·æ±‚ã€æ‰¹é‡æ•°æ®å¤„ç†ç­‰éœ€è¦é«˜å¹¶å‘çš„åœºæ™¯\n\n\næ•°æ®åº“è¿æ¥æ± ï¼š\n\nå»ºç«‹æ•°æ®åº“è¿æ¥æ¶‰åŠç½‘ç»œé€šä¿¡ã€èº«ä»½éªŒè¯ç­‰è€—æ—¶æ“ä½œ\nè¿æ¥æ± ç»´æŠ¤ä¸€ç»„å·²å»ºç«‹çš„æ•°æ®åº“è¿æ¥ï¼Œåº”ç”¨ç¨‹åºä½¿ç”¨æ—¶ç›´æ¥ä»æ± ä¸­è·å–\nä½¿ç”¨å®Œæ¯•åè¿æ¥å½’è¿˜æ± ä¸­è€Œéå…³é—­ï¼Œä¾›å…¶ä»–è¯·æ±‚å¤ç”¨\nå…¸å‹é…ç½®å‚æ•°åŒ…æ‹¬ï¼šæœ€å°è¿æ¥æ•°ã€æœ€å¤§è¿æ¥æ•°ã€è¿æ¥è¶…æ—¶æ—¶é—´ç­‰\nä¼˜åŠ¿ï¼šæ˜¾è‘—é™ä½è¿æ¥å»ºç«‹å¼€é”€ï¼Œæé«˜æ•°æ®åº“è®¿é—®æ•ˆç‡\n\n\n\nè¿™äº›èµ„æºæ± æŠ€æœ¯åœ¨ç°ä»£è½¯ä»¶ç³»ç»Ÿä¸­è¢«å¹¿æ³›åº”ç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨é«˜å¹¶å‘ã€é«˜æ€§èƒ½è¦æ±‚çš„åœºæ™¯ä¸‹ï¼Œåˆç†é…ç½®èµ„æºæ± å¯ä»¥å¤§å¹…æå‡ç³»ç»Ÿæ•´ä½“æ€§èƒ½ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œç”±äºåˆ›å»ºå’Œé”€æ¯ç³»ç»Ÿèµ„æºï¼ˆå¦‚è¿æ¥ã€å†…å­˜å—ã€çº¿ç¨‹ç­‰ï¼‰çš„æˆæœ¬å¾€å¾€è¿œé«˜äºä½¿ç”¨èµ„æºçš„æˆæœ¬ï¼Œå› æ­¤é€šå¸¸ä¼šå¼•å…¥èµ„æºæ± çš„æ¦‚å¿µæ¥æé«˜ç³»ç»Ÿæ€§èƒ½ã€‚è¿™ç§æŠ€æœ¯é€šè¿‡é¢„å…ˆåˆ›å»ºå¹¶ç»´æŠ¤ä¸€ç»„å¯é‡ç”¨èµ„æºï¼Œé¿å…äº†é¢‘ç¹çš„èµ„æºåˆå§‹åŒ–å’Œé”€æ¯æ“ä½œï¼Œä»è€Œæ˜¾è‘—æå‡ç³»ç»Ÿæ•ˆç‡ã€‚\nä»£ç å®ç°æœ¬é¡¹ç›®æ•°æ®åº“è¿æ¥æ± å®ç°äº†ä¸‰ä¸ªæ ¸å¿ƒç±»ï¼š\n\nDbConnectionï¼šç®¡ç†å•ä¸ªæ•°æ®åº“è¿æ¥\nDbConnectionPoolï¼šç®¡ç†æ•°æ®åº“è¿æ¥æ± \nMysqlUtilï¼šæä¾›ä¾¿æ·çš„æ•°æ®åº“æ“ä½œæ¥å£\n\nä»¥ä¸‹å°±åˆ†åˆ«æ¥äº†è§£ä¸€ä¸‹è¿™å‡ ä¸ªç±»çš„å®ç°ã€‚\nDbConnectionç±»å®ç°æˆå‘˜å˜é‡ï¼š\n\nstd::shared_ptr&lt;sql::Connection&gt; conn_ æ•°æ®åº“è¿æ¥\nstd::string    host_   æ•°æ®åº“ä¸»æœºåœ°å€ï¼Œå¦‚tcp:&#x2F;&#x2F;127.0.0.1:3306\nstd::string    user_    ç”¨æˆ·å\nstd::string  password_  å¯†ç \nstd::string database_  ä½¿ç”¨æ•°æ®åº“\nstd::mutex  mutex_    äº’æ–¥é”\n\næˆå‘˜æ–¹æ³•ï¼š\n\nDbConnection()æ„é€ å‡½æ•°, åˆ›å»ºå¹¶åˆå§‹åŒ–æ•°æ®åº“è¿æ¥ï¼Œè®¾ç½®è¿æ¥å±æ€§ï¼ˆè¿™é‡Œæ˜¯è®¾ç½®çš„å•è¯­å¥æ‰§è¡Œï¼Œé˜²æ­¢SQLçš„æ³¨å…¥ï¼‰\n~DbConnection()ææ„å‡½æ•°ï¼Œè‡ªåŠ¨æ¸…ç†è¿æ¥èµ„æºï¼Œè°ƒç”¨cleanup()å‡½æ•°\nping()å‡½æ•°ï¼Œä½¿ç”¨ç®€å•çš„SELECT 1è¯­å¥æ£€æµ‹ä¸æ•°æ®åº“çš„é€šä¿¡æ˜¯å¦æ­£å¸¸\nisValid()å‡½æ•°ï¼Œä¸pingå‡½æ•°ç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äºä¸åœ¨æ„æŸ¥è¯¢ç»“æœï¼Œé‡åˆ°å¼‚å¸¸è¿”å›false\nreconnect() å‡½æ•°ï¼Œå°è¯•é‡æ–°å»ºç«‹æ•°æ®åº“è¿æ¥\ncleanup()å‡½æ•°ï¼Œæ¸…ç†è¿æ¥çŠ¶æ€ï¼Œéœ€è¦ç¡®ä¿æ‰€æœ‰äº‹åŠ¡ä»¥åŠå®Œæˆï¼Œå¹¶ä¸”æ¶ˆè´¹å®Œæ‰€æœ‰æŸ¥è¯¢ç»“æœ\nbindParams(),ç»‘å®šå‚æ•°\nexecuteQuery()å‡½æ•°ï¼Œæ‰§è¡Œsqlè¯­å¥çš„æŸ¥è¯¢ï¼Œå¹¶è¿”å›æŸ¥è¯¢ç»“æœ\nexecuteUpdate()å‡½æ•°ï¼Œæ‰§è¡Œsqlè¯­å¥çš„æ›´æ–°æ“ä½œ\n\nåœ¨ä¸Šè¿°å‡½æ•°ä¸­æ¯”è¾ƒé‡è¦çš„å°±æ˜¯executeQuery()å’ŒexecuteUpdate()å‡½æ•°ï¼Œä»¥ä¸‹æ˜¯å…¶ä»£ç å®šä¹‰ä¸æ³¨é‡Š\nexecuteQuery()å‡½æ•°\ntemplate&lt;typename... Args&gt; //å¯å˜å‚æ•°æ¨¡æ¿ï¼Œæ¥å—ä»»æ„æ•°é‡ã€ä»»æ„ç±»å‹çš„å‚æ•°sql::ResultSet* executeQuery(const std::string&amp; sql, Args&amp;&amp;... args)&#123;    std::lock_guard&lt;std::mutex&gt; lock(mutex_);  // ç¡®ä¿çº¿ç¨‹å®‰å…¨    try     &#123;        // ç›´æ¥åˆ›å»ºæ–°çš„é¢„å¤„ç†è¯­å¥ï¼Œä¸ä½¿ç”¨ç¼“å­˜        std::unique_ptr&lt;sql::PreparedStatement&gt; stmt(            conn_-&gt;prepareStatement(sql)        );        bindParams(stmt.get(), 1, std::forward&lt;Args&gt;(args)...); // ç»‘å®šå‚æ•°,std::forward ç¡®ä¿å®Œç¾è½¬å‘        return stmt-&gt;executeQuery(); //æ‰§è¡Œåè¿”å› sql::ResultSet*    &#125;     catch (const sql::SQLException&amp; e)     &#123;        LOG_ERROR &lt;&lt; &quot;Query failed: &quot; &lt;&lt; e.what() &lt;&lt; &quot;, SQL: &quot; &lt;&lt; sql;        throw DbException(e.what());    &#125;&#125;\nè¿™ä¸ªæ˜¯æ‰§è¡ŒSqlæŸ¥è¯¢çš„æ“ä½œï¼Œåœ¨ä¸Šå±‚ï¼Œé€šè¿‡ä»£ç \nstd::string sql = &quot;SELECT id FROM users WHERE username = ? AND password = ?&quot;;sql::ResultSet* res = mysqlUtil_.executeQuery(sql, username, password);\nä¼ å…¥äº†sqlè¯­å¥ï¼šâ€SELECT id FROM users WHERE username &#x3D; ? AND password &#x3D; ?â€ä»¥åŠä¸¤ä¸ªå‚æ•°ï¼šusername&#x3D;â€user1â€œå’Œpassword&#x3D;â€123456â€œï¼›é€šè¿‡å‚æ•°ç»‘å®šåï¼Œå®Œæ•´çš„sqlè¯­å¥å°±æ˜¯â€œSELECT id FROM users WHERE username &#x3D; user1 AND password &#x3D;123456â€éšåæ‰§è¡ŒMysqlçš„è¯­å¥æŸ¥è¯¢ï¼Œè¿”å›æŸ¥è¯¢åˆ°çš„ç»“æœã€‚\nexecuteUpdateå‡½æ•°\ntemplate&lt;typename... Args&gt;    int executeUpdate(const std::string&amp; sql, Args&amp;&amp;... args)    &#123;        std::lock_guard&lt;std::mutex&gt; lock(mutex_);        try         &#123;            // ç›´æ¥åˆ›å»ºæ–°çš„é¢„å¤„ç†è¯­å¥ï¼Œä¸ä½¿ç”¨ç¼“å­˜            std::unique_ptr&lt;sql::PreparedStatement&gt; stmt(                conn_-&gt;prepareStatement(sql)            );            bindParams(stmt.get(), 1, std::forward&lt;Args&gt;(args)...);            return stmt-&gt;executeUpdate();        &#125;         catch (const sql::SQLException&amp; e)         &#123;            LOG_ERROR &lt;&lt; &quot;Update failed: &quot; &lt;&lt; e.what() &lt;&lt; &quot;, SQL: &quot; &lt;&lt; sql;            throw DbException(e.what());        &#125;    &#125;\nç¤ºä¾‹è¯­å¥ï¼š\nconst std::string sql = &quot;INSERT INTO video_stats (video_name, view_count, like_count) VALUES (?, 0, 0) ON DUPLICATE KEY UPDATE video_name=video_name&quot;;int affected = mysqlUtil_.executeUpdate(sql, video_name);\n\n\nSQLæ³¨å…¥çš„ç†è§£ï¼šå½“ç”¨æˆ·ç™»å½•ç½‘ç«™æ—¶ï¼Œé€šå¸¸ä¼šè¾“å…¥ç”¨æˆ·åå’Œå¯†ç ã€‚ä»¥ä¸‹æ˜¯ä¸€æ®µæ­£å¸¸çš„ SQL æŸ¥è¯¢ä»£ç ï¼š\nSELECT * FROM users WHERE username = &#x27;user1&#x27; AND password = &#x27;password1&#x27;;\nå¦‚æœæ”»å‡»è€…è¾“å…¥ï¼š\nç”¨æˆ·åï¼š admin&#x27; --å¯†ç ï¼š anything\n\nSQLæŸ¥è¯¢å˜æˆï¼š\nSELECT * FROM users WHERE username = &#x27;admin&#x27; --&#x27; AND password = &#x27;anything&#x27;;\nå…¶ä¸­ â€“ æ˜¯ SQL çš„æ³¨é‡Šç¬¦å·ï¼Œå¿½ç•¥äº†å¯†ç æ¡ä»¶ï¼Œç›´æ¥ç»•è¿‡äº†èº«ä»½éªŒè¯ã€‚æ›´å¤šå¯ä»¥å‚è€ƒSQL æ³¨å…¥\nDbConnectionPoolç±»å®ç°æˆå‘˜å˜é‡ï¼š\n\nstd::string     host_; è¿æ¥æ•°æ®åº“çš„ä¸»æœºå\nstd::string     user_; ç”¨æˆ·å\nstd::string     password_; å¯†ç \nstd::string    database_; æŒ‡å®šä½¿ç”¨çš„æ•°æ®åº“\nstd::queue&lt;std::shared_ptr&lt;DbConnection&gt;&gt; connections_; æ•°æ®åº“è¿æ¥æ± \nstd::mutex    mutex_; äº’æ–¥é”\nstd::condition_variable   cv_; æ¡ä»¶å˜é‡\nbool       initialized_ = false;   åˆå§‹åŒ–æ ‡è¯†,ç¡®ä¿ä»…åˆå§‹åŒ–ä¸€æ¬¡\nstd::thread    checkThread_; &#x2F;&#x2F; æ·»åŠ æ£€æŸ¥çº¿ç¨‹ï¼Œæ£€æµ‹æ•°æ®åº“è¿æ¥æ± çš„è¿æ¥å¥åº·çŠ¶å†µ\n\næˆå‘˜æ–¹æ³•ï¼šä½¿ç”¨å•ä¾‹æ¨¡å¼ï¼Œ\n\ninit()å‡½æ•°ï¼Œåˆå§‹åŒ–çº¿ç¨‹æ± ï¼Œåˆ›å»º poolSize ä¸ª DbConnection å¯¹è±¡ï¼Œæ”¾å…¥é˜Ÿåˆ—\nDbConnectionPool()æ„é€ å‡½æ•°ï¼Œåˆ›å»ºå¹¶åˆ†ç¦»åå°çº¿ç¨‹ï¼Œå®šæœŸæ£€æŸ¥è¿æ¥å¯ç”¨æ€§\n~DbConnectionPool()ææ„å‡½æ•°ï¼Œæ¸…ç©ºè¿æ¥é˜Ÿåˆ—ï¼Œé‡Šæ”¾æ‰€æœ‰è¿æ¥èµ„æº\ngetConnection() å‡½æ•°ï¼Œä»è¿æ¥æ± è·å–ä¸€ä¸ªå¯ç”¨è¿æ¥\ncreateConnection() å‡½æ•°ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„æ•°æ®åº“è¿æ¥\ncheckConnections() ï¼Œåå°çº¿ç¨‹ï¼Œå®šæœŸæ£€æŸ¥æ‰€æœ‰è¿æ¥æ˜¯å¦å¯ç”¨ã€‚\n\nè¿™é‡Œæ¯”è¾ƒé‡è¦çš„å°±æ˜¯getConnection() å‡½æ•°ï¼Œæˆ‘è´´å‡ºæ¥ä»£ç \nstd::shared_ptr&lt;DbConnection&gt; DbConnectionPool::getConnection() &#123;    std::shared_ptr&lt;DbConnection&gt; conn;    &#123;        std::unique_lock&lt;std::mutex&gt; lock(mutex_);        // å¦‚æœè¿æ¥æ± ä¸ºç©ºï¼Œåˆ™é˜»å¡ç­‰å¾…å…¶ä»–çº¿ç¨‹é‡Šæ”¾è¿æ¥        while (connections_.empty())         &#123;            if (!initialized_)             &#123;                throw DbException(&quot;Connection pool not initialized&quot;);            &#125;            LOG_INFO &lt;&lt; &quot;Waiting for available connection...&quot;;            cv_.wait(lock);  // ç­‰å¾…æ¡ä»¶å˜é‡é€šçŸ¥        &#125;        // ä»é˜Ÿåˆ—ä¸­å–ä¸€ä¸ªè¿æ¥        conn = connections_.front();        connections_.pop();    &#125; // é‡Šæ”¾é”        try     &#123;        // åœ¨é”å¤–æ£€æŸ¥è¿æ¥        if (!conn-&gt;ping())         &#123;            LOG_WARN &lt;&lt; &quot;Connection lost, attempting to reconnect...&quot;;            conn-&gt;reconnect();        &#125;                // ä½¿ç”¨è‡ªå®šä¹‰ deleterï¼š        // å½“å¤–éƒ¨ shared_ptr è¢«é‡Šæ”¾æ—¶ï¼ŒæŠŠè¿æ¥æ”¾å›è¿æ¥æ± å¹¶é€šçŸ¥ç­‰å¾…çº¿ç¨‹        return std::shared_ptr&lt;DbConnection&gt;(conn.get(),             [this, conn](DbConnection*) &#123;                std::lock_guard&lt;std::mutex&gt; lock(mutex_);                connections_.push(conn);                cv_.notify_one();            &#125;);    &#125;     catch (const std::exception&amp; e)     &#123;           // å¦‚æœé‡è¿å¤±è´¥ï¼Œåˆ™æŠŠè¿æ¥æ”¾å›é˜Ÿåˆ—å¹¶é€šçŸ¥ç­‰å¾…çº¿ç¨‹        LOG_ERROR &lt;&lt; &quot;Failed to get connection: &quot; &lt;&lt; e.what();        &#123;            std::lock_guard&lt;std::mutex&gt; lock(mutex_);            connections_.push(conn);            cv_.notify_one();        &#125;        throw;    &#125;&#125;\nå‡½æ•°çš„æ ¸å¿ƒé€»è¾‘ä¸ºï¼š\n\nå¦‚æœè¿æ¥æ± ä¸ºç©ºï¼Œåˆ™é˜»å¡ç­‰å¾…ï¼ˆä½¿ç”¨æ¡ä»¶å˜é‡ï¼‰\nè¿æ¥æ± å§‹ç»ˆè¿”å› std::shared_ptr&lt;DbConnection&gt;\né€šè¿‡è‡ªå®šä¹‰çš„deleteråœ¨ç”¨æˆ·ä½¿ç”¨å®Œæ•°æ®åº“æŸæ¡è¿æ¥åè‡ªåŠ¨å½’è¿˜ç»™æ± ä½¿ç”¨lambdaè¡¨è¾¾å¼ï¼Œå½“connä½¿ç”¨å®Œæˆåï¼Œå°†å…¶å½’è¿˜åˆ°connections_æ± ä¸­å»ã€‚\n\n// ä½¿ç”¨è‡ªå®šä¹‰ deleterï¼š // å½“å¤–éƒ¨ shared_ptr è¢«é‡Šæ”¾æ—¶ï¼ŒæŠŠè¿æ¥æ”¾å›è¿æ¥æ± å¹¶é€šçŸ¥ç­‰å¾…çº¿ç¨‹ return std::shared_ptr&lt;DbConnection&gt;(conn.get(),      [this, conn](DbConnection*) &#123;         std::lock_guard&lt;std::mutex&gt; lock(mutex_);         connections_.push(conn);         cv_.notify_one();     &#125;);\n\nMysqlUtilç±»å®ç°static void init(const std::string&amp; host, const std::string&amp; user,                const std::string&amp; password, const std::string&amp; database,                size_t poolSize = 10)&#123;   //è°ƒç”¨äº† DbConnectionPool çš„å•ä¾‹æ¨¡å¼ï¼Œä¿è¯å…¨å±€å”¯ä¸€    http::db::DbConnectionPool::getInstance().init(        host, user, password, database, poolSize);&#125;template&lt;typename... Args&gt;sql::ResultSet* executeQuery(const std::string&amp; sql, Args&amp;&amp;... args)&#123;   //å¯¹å¤–æä¾› æ‰§è¡ŒæŸ¥è¯¢ï¼ˆSELECTï¼‰ çš„æ¥å£    //ä½¿ç”¨è€…ä¸éœ€è¦æ˜¾å¼åˆ›å»º DbConnectionï¼Œä¹Ÿä¸ç”¨å…³å¿ƒ getConnection å’Œå½’è¿˜è¿æ¥çš„é€»è¾‘    auto conn = http::db::DbConnectionPool::getInstance().getConnection();    return conn-&gt;executeQuery(sql, std::forward&lt;Args&gt;(args)...);&#125;template&lt;typename... Args&gt;int executeUpdate(const std::string&amp; sql, Args&amp;&amp;... args)&#123;       //å¯¹å¤–æä¾› æ‰§è¡Œæ›´æ–°ï¼ˆINSERT / UPDATE / DELETEï¼‰ çš„æ¥å£    auto conn = http::db::DbConnectionPool::getInstance().getConnection();    return conn-&gt;executeUpdate(sql, std::forward&lt;Args&gt;(args)...);&#125;\nMysqlUtilç±»çš„å®ç°æ¯”è¾ƒç®€å•ï¼Œæä¾›äº†å¯¹æ•°æ®åº“çš„ç®€å•æ¥å£ï¼Œéšè—äº†åº•å±‚è¿æ¥æ± çš„å¤æ‚æ€§ã€‚ä¸»è¦æ˜¯æä¾›äº†ä¸‰ä¸ªæ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯æ•°æ®åº“è¿æ¥æ± çš„åˆå§‹åŒ–ã€ä»è¿æ¥æ± ä¸­è·å–è¿æ¥ä»¥æ‰§è¡ŒæŸ¥è¯¢æ“ä½œå’Œæ›´æ–°ï¼ˆå¢åˆ æ”¹ï¼‰æ“ä½œã€‚MysqlUtilä½œä¸ºä¸€ä¸ªä¾¿æ·çš„å·¥å…·ç±»ï¼Œç®€åŒ–äº†è°ƒç”¨æ¥å£ï¼Œè®©ä¸šåŠ¡å±‚å¯ä»¥æ›´è½»æ¾çš„ä½¿ç”¨è¿æ¥æ± è¿›è¡Œå¢åˆ æ”¹æŸ¥çš„å·¥ä½œã€‚\nä»¥ä¸Šå°±æ˜¯æˆ‘å¯¹æ•°æ®åº“è¿æ¥æ± çš„ä¸€äº›ç†è§£ï¼Œå¦‚æœ‰ä¸å½“ä¹‹å¤„ï¼Œæ•¬è¯·æŒ‡å‡ºã€‚\n","categories":["LiteHub"],"tags":["ç½‘ç»œ","åç«¯","æ•°æ®åº“"]},{"title":"LiteHubä¹‹gzipå‹ç¼©ç®—æ³•","url":"/undefined/LiteHub_gzip/","content":"\n\nç†è®ºéƒ¨åˆ†\ngzipæ˜¯ä¸€ç§æ— æŸå‹ç¼©ç®—æ³•ï¼Œå…¶åŸºç¡€ä¸ºDeflateï¼ŒDeflateæ˜¯LZ77ä¸å“ˆå¼—æ›¼ç¼–ç çš„ä¸€ä¸ªç»„åˆä½“ã€‚å®ƒçš„åŸºæœ¬åŸç†æ˜¯ï¼šå¯¹äºè¦å‹ç¼©çš„æ–‡ä»¶ï¼Œé¦–å…ˆä½¿ç”¨LZ77ç®—æ³•çš„ä¸€ä¸ªå˜ç§è¿›è¡Œå‹ç¼©ï¼Œå¯¹å¾—åˆ°çš„ç»“æœå†ä½¿ç”¨å“ˆå¤«æ›¼ç¼–ç ï¼ˆæ ¹æ®æƒ…å†µï¼Œä½¿ç”¨é™æ€å“ˆå¼—æ›¼ç¼–ç æˆ–åŠ¨æ€å“ˆå¤«æ›¼ç¼–ç ï¼‰çš„æ–¹æ³•è¿›è¡Œå‹ç¼©ã€‚\n\nLZ777ç®—æ³•å‡ ä¸ªæœ¯è¯­\n\nç­‰å¾…ç¼–ç åŒº\næœç´¢ç¼“å†²åŒºï¼ˆå·²ç»ç¼–ç çš„åŒºåŸŸï¼‰\næ»‘åŠ¨çª—å£ï¼ˆæŒ‡å®šå¤§å°ï¼ŒåŒ…æ‹¬â€œæœç´¢ç¼“å†²åŒºâ€å’Œâ€œå¾…ç¼–ç åŒºâ€ï¼‰\n\nå…·ä½“çš„ç¼–ç è¿‡ç¨‹ï¼šæ¥ä¸‹æ¥ï¼Œä»‹ç»å…·ä½“çš„ç¼–ç è¿‡ç¨‹ï¼šã€€ã€€ä¸ºäº†ç¼–ç å¾…ç¼–ç åŒºï¼Œ ç¼–ç å™¨åœ¨æ»‘åŠ¨çª—å£çš„æœç´¢ç¼“å†²åŒºæŸ¥æ‰¾ç›´åˆ°æ‰¾åˆ°åŒ¹é…çš„å­—ç¬¦ä¸²ã€‚åŒ¹é…å­—ç¬¦ä¸²çš„å¼€å§‹å­—ç¬¦ä¸²ä¸å¾…ç¼–ç ç¼“å†²åŒºçš„è·ç¦»ç§°ä¸ºâ€œåç§»å€¼â€ï¼ŒåŒ¹é…å­—ç¬¦ä¸²çš„é•¿åº¦ç§°ä¸ºâ€œåŒ¹é…é•¿åº¦â€ã€‚ã€€ã€€ç¼–ç å™¨åœ¨ç¼–ç æ—¶ï¼Œä¼šä¸€ç›´åœ¨æœç´¢åŒºä¸­æœç´¢ï¼Œç›´åˆ°æ‰¾åˆ°æœ€å¤§åŒ¹é…å­—ç¬¦ä¸²ï¼Œå¹¶è¾“å‡º(o, l )ï¼Œå…¶ä¸­oæ˜¯åç§»å€¼ï¼Œ læ˜¯åŒ¹é…é•¿åº¦ã€‚ç„¶åçª—å£æ»‘åŠ¨lï¼Œç»§ç»­å¼€å§‹ç¼–ç ã€‚ã€€ã€€å¦‚æœæ²¡æœ‰æ‰¾åˆ°åŒ¹é…å­—ç¬¦ä¸²ï¼Œåˆ™è¾“å‡º(0, 0, c)ï¼Œcä¸ºå¾…ç¼–ç åŒºä¸‹ä¸€ä¸ªç­‰å¾…ç¼–ç çš„å­—ç¬¦ï¼Œçª—å£æ»‘åŠ¨â€œ1â€ã€‚\nå‚è€ƒæ–‡ç« ï¼šLZ77å‹ç¼©ç®—æ³•ç¼–ç åŸç†è¯¦è§£(ç»“åˆå›¾ç‰‡å’Œç®€å•ä»£ç )\nä¸‹é¢æˆ‘ä»¬ä»¥å­—ç¬¦ä¸²â€œabababcâ€ä¸ºä¾‹ï¼Œæ¥äº†è§£å…¶ç¼–ç è¿‡ç¨‹ï¼š\nå‡è®¾æ»‘åŠ¨çª—å£çš„å¤§å°è¶³å¤Ÿå¤§(LZ777è®¾ç½®çš„æ»‘åŠ¨çª—å£æ˜¯32k)ï¼Œå¯ä»¥è¦†ç›–æ•´ä¸ªå­—ç¬¦ä¸²ã€‚\nç¬¬ä¸€æ­¥ï¼š\t&emsp;å¾…ç¼–ç åŒºï¼šabababc\t&emsp;æœç´¢ç¼“å†²åŒºï¼šï¼ˆåˆå§‹ä¸ºç©ºï¼‰\t&emsp;æ“ä½œï¼šæœç´¢ç¼“å†²åŒºä¸ºç©ºï¼Œæ— æ³•æ‰¾åˆ°åŒ¹é…å­—ç¬¦ä¸²ã€‚\t&emsp;è¾“å‡ºï¼š(0, 0, a)ï¼ˆè¡¨ç¤ºæ²¡æœ‰æ‰¾åˆ°åŒ¹é…ï¼Œè¾“å‡ºå­—ç¬¦aï¼‰\t&emsp;çª—å£æ»‘åŠ¨ï¼šçª—å£å‘å³æ»‘åŠ¨1ä¸ªå­—ç¬¦ã€‚\t&emsp;ç»“æœï¼šaå·²ç»è¢«ç¼–ç ï¼Œå‰©ä¸‹bababcã€‚ç¬¬äºŒæ­¥ï¼š\t&emsp;å¾…ç¼–ç åŒºï¼šbababc\t&emsp;æœç´¢ç¼“å†²åŒºï¼šaï¼ˆå·²ç»ç¼–ç çš„éƒ¨åˆ†ï¼‰\t&emsp;æ“ä½œï¼šåœ¨æœç´¢ç¼“å†²åŒºä¸­æŸ¥æ‰¾bçš„åŒ¹é…ã€‚æœç´¢ç¼“å†²åŒºä¸­æ²¡æœ‰bã€‚\t&emsp;è¾“å‡ºï¼š(0, 0, b)ï¼ˆè¡¨ç¤ºæ²¡æœ‰æ‰¾åˆ°åŒ¹é…ï¼Œè¾“å‡ºå­—ç¬¦bï¼‰\t&emsp;çª—å£æ»‘åŠ¨ï¼šçª—å£å‘å³æ»‘åŠ¨1ä¸ªå­—ç¬¦ã€‚\t&emsp;ç»“æœï¼šabå·²ç»è¢«ç¼–ç ï¼Œå‰©ä¸‹ababcã€‚ç¬¬ä¸‰æ­¥ï¼š\t&emsp;å¾…ç¼–ç åŒºï¼šababc\t&emsp;æœç´¢ç¼“å†²åŒºï¼šabï¼ˆå·²ç»ç¼–ç çš„éƒ¨åˆ†ï¼‰\t&emsp;æ“ä½œï¼šåœ¨æœç´¢ç¼“å†²åŒºä¸­æŸ¥æ‰¾abçš„åŒ¹é…ã€‚æœç´¢ç¼“å†²åŒºä¸­å­˜åœ¨abï¼ŒåŒ¹é…é•¿åº¦ä¸º2ã€‚\t&emsp;è¾“å‡ºï¼š(2, 2)ï¼ˆè¡¨ç¤ºåŒ¹é…é•¿åº¦ä¸º2ï¼Œåç§»å€¼ä¸º2ï¼‰\t&emsp;çª—å£æ»‘åŠ¨ï¼šçª—å£å‘å³æ»‘åŠ¨2ä¸ªå­—ç¬¦ã€‚\t&emsp;ç»“æœï¼šababå·²ç»è¢«ç¼–ç ï¼Œå‰©ä¸‹abcã€‚ç¬¬å››æ­¥ï¼š\t&emsp;å¾…ç¼–ç åŒºï¼šabc\t&emsp;æœç´¢ç¼“å†²åŒºï¼šababï¼ˆå·²ç»ç¼–ç çš„éƒ¨åˆ†ï¼‰\t&emsp;æ“ä½œï¼šåœ¨æœç´¢ç¼“å†²åŒºä¸­æŸ¥æ‰¾abçš„åŒ¹é…ã€‚æœç´¢ç¼“å†²åŒºä¸­å­˜åœ¨abï¼ŒåŒ¹é…é•¿åº¦ä¸º2ã€‚\t&emsp;è¾“å‡ºï¼š(4, 2)ï¼ˆè¡¨ç¤ºåŒ¹é…é•¿åº¦ä¸º2ï¼Œåç§»å€¼ä¸º4ï¼‰\t&emsp;çª—å£æ»‘åŠ¨ï¼šçª—å£å‘å³æ»‘åŠ¨2ä¸ªå­—ç¬¦ã€‚\t&emsp;ç»“æœï¼šabababå·²ç»è¢«ç¼–ç ï¼Œå‰©ä¸‹cã€‚ç¬¬äº”æ­¥ï¼š\t&emsp;å¾…ç¼–ç åŒºï¼šc\t&emsp;æœç´¢ç¼“å†²åŒºï¼šabababï¼ˆå·²ç»ç¼–ç çš„éƒ¨åˆ†ï¼‰\t&emsp;æ“ä½œï¼šåœ¨æœç´¢ç¼“å†²åŒºä¸­æŸ¥æ‰¾cçš„åŒ¹é…ã€‚æœç´¢ç¼“å†²åŒºä¸­æ²¡æœ‰cã€‚\t&emsp;è¾“å‡ºï¼š(0, 0, c)ï¼ˆè¡¨ç¤ºæ²¡æœ‰æ‰¾åˆ°åŒ¹é…ï¼Œè¾“å‡ºå­—ç¬¦cï¼‰\t&emsp;çª—å£æ»‘åŠ¨ï¼šçª—å£å‘å³æ»‘åŠ¨1ä¸ªå­—ç¬¦ã€‚\t&emsp;ç»“æœï¼šæ•´ä¸ªå­—ç¬¦ä¸²å·²ç»ç¼–ç å®Œæˆã€‚\næœ€ç»ˆç¼–ç ç»“æœ&emsp;ç»è¿‡ä¸Šè¿°æ­¥éª¤ï¼Œå­—ç¬¦ä¸²abababcçš„LZ77ç¼–ç ç»“æœä¸ºï¼š\n(0, 0, a) (0, 0, b) (2, 2) (4,2) (0, 0, c)\nä½¿ç”¨LZ77å‹ç¼©ç®—æ³•ç¼–ç åŸç†è¯¦è§£(ç»“åˆå›¾ç‰‡å’Œç®€å•ä»£ç )ç»™å®šçš„ä»£ç çš„ç¼–ç ç»“æœæ˜¯è¯´æ˜ä¸Šè¿°ç¼–ç è¿‡ç¨‹åˆ†ææ­£ç¡®ï¼ï¼ï¼\nä¸Šé¢çš„å¦‚(0, 0, a)è¿™ä¸ªå…¶å®æ ¹æœ¬ä¸ç”¨å†™åç§»å’ŒåŒ¹é…é•¿åº¦ï¼Œä¿ç•™ä¸ºåŸå­—ç¬¦â€˜aâ€™ï¼Œå çš„ç¼–ç é•¿åº¦è¿˜æ›´çŸ­ä¸€äº›ã€‚\n(0, 0, a) (0, 0, b) (2, 2) (4,2) (0, 0, c)\nå˜ä¸º\nab(2, 2) (4,2)c\néœå¤«æ›¼ç¼–ç ç®—æ³•éœå¤«æ›¼ç¼–ç æ˜¯ä¸€ç§åŸºäºå­—ç¬¦é¢‘ç‡çš„å˜é•¿ç¼–ç æ–¹æ³•ï¼Œé€šè¿‡æ„å»ºéœå¤«æ›¼æ ‘æ¥ä¸ºæ¯ä¸ªå­—ç¬¦åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„äºŒè¿›åˆ¶ç¼–ç ã€‚éœå¤«æ›¼æ ‘çš„æ„å»ºè¿‡ç¨‹ä¾èµ–äºå­—ç¬¦çš„é¢‘ç‡ï¼Œé¢‘ç‡è¶Šé«˜çš„å­—ç¬¦é€šå¸¸ä¼šè¢«åˆ†é…è¾ƒçŸ­çš„ç¼–ç ã€‚é¦–å…ˆæˆ‘ä»¬ç»Ÿè®¡â€abababcâ€œä¸­æ¯ä¸€ä¸ªå­—ç¬¦å‡ºç°çš„é¢‘ç‡ï¼Œå¦‚ä¸‹æ‰€ç¤º\n\n\n\na\nb\nc\n\n\n\n3\n3\n1\n\n\næ ¹æ®éœå¤«æ›¼ç¼–ç çš„è§„åˆ™ï¼Œæˆ‘ä»¬éœ€è¦æŒ‰ç…§å­—ç¬¦é¢‘ç‡ä»ä½åˆ°é«˜æ„å»ºéœå¤«æ›¼æ ‘ã€‚ä»¥ä¸‹æ˜¯æ„å»ºè¿‡ç¨‹ï¼š\n\nå°†å­—ç¬¦ä¸²å‡ºç°çš„é¢‘ç‡è§†ä¸ºä¼˜å…ˆçº§ï¼Œæ”¾å…¥ä¸€ä¸ªæœ€å°ä¼˜å…ˆé˜Ÿåˆ—ä¸­ï¼š\n\n\n\nç„¶åå¼¹å‡ºä¸¤ä¸ªä¼˜å…ˆçº§æœ€ä½çš„å­—ç¬¦ä½œä¸ºå­èŠ‚ç‚¹, æ„é€ å‡ºç¬¬ä¸€ä¸ªäºŒå‰æ ‘; çˆ¶èŠ‚ç‚¹çš„ä¼˜å…ˆçº§è§†ä¸ºä¸¤ä¸ªå­—èŠ‚ä¼˜å…ˆçº§ä¹‹å’Œ, ç„¶åæŠŠçˆ¶èŠ‚ç‚¹æ’å…¥é˜Ÿåˆ—ä¸­:\né‡å¤è¿™ä¸ªæ“ä½œ, æœ€åæˆ‘ä»¬ä¼šå¾—åˆ°ä¸€é¢—äºŒå‰æ ‘. è¿™ä¾¿æ˜¯ Huffmanç¼–ç  æ ‘.\n\n4.  æˆ‘ä»¬æŠŠè¿™æ£µæ ‘çš„å·¦æ”¯ç¼–ç ä¸º 0, å³æ”¯ç¼–ç ä¸º 1, é‚£ä¹ˆä»æ ¹èŠ‚ç‚¹å‘ä¸‹éå†åˆ°å¶å­èŠ‚ç‚¹, å³å¯å¾—å‡ºç›¸åº”å­—ç¬¦çš„ Huffman ç¼–ç . å› æ­¤æˆ‘ä»¬å¾—åˆ°ä¸Šé¢ä¾‹å­çš„ Huffman ç¼–ç è¡¨ä¸º:\na:1b:01c:00\nç°åœ¨å¯¹å­—ç¬¦ä¸²ä¸­å‡ºç°çš„é¢‘ç‡éƒ½åšäº†ä¸€ä¸ªç»Ÿè®¡ï¼Œåªéœ€è¦è§£å†³åç§»é‡å’ŒåŒ¹é…é•¿åº¦çš„ç¼–ç å°±å¯ä»¥äº†ã€‚\n DEFLATE ç®—æ³•å¯¹åç§»è·ç¦»å’ŒåŒ¹é…é•¿åº¦å·²ç»åšäº†ä¸€ä¸ªç»Ÿè®¡ï¼Œè§ä¸‹è¡¨ï¼š åç§»è·ç¦»ï¼š å®ƒæœ‰ 0 è‡³ 29 ä¸€å…± 30 ä¸ªç¼–ç . è·ç¦»ç¼–ç çš„å«ä¹‰å¦‚ä¸‹è¡¨æ‰€ç¤º: \n\ncodeè¡¨ç¤ºåŸºæœ¬çš„ç¼–ç è¡¨ç¤ºï¼Œæ¯”å¦‚ç¼–ç 9å¯¹åº”çš„åŸºå‡†è·ç¦»æ˜¯25\nextraè¡¨ç¤ºè·ç¦»åŸºå‡†è·ç¦»åç§»äº†å¤šå°‘ï¼Œç¼–ç 9å¯¹åº”çš„extraä¸º3ä½ï¼Œæœ€å¤§ä¸º111ï¼ˆ7ï¼‰ï¼Œå³25+7ï¼Œæœ€å¤§å¯ä»¥è¡¨ç¤º32ã€‚\ndistanceï¼Œå¯ä»¥è¡¨ç¤ºçš„è·ç¦»èŒƒå›´æ€»ç»“ï¼šcode+extraå¯ä»¥çµæ´»è¡¨ç¤ºdistanceçš„ä»»ä½•æ•°å­—\n\n åŒ¹é…é•¿åº¦ï¼šå¯¹äºé•¿åº¦, å®ƒä¸æ™®é€šå­—ç¬¦å…±ç”¨åŒä¸€ç¼–ç ç©ºé—´. è¿™ä¸ªç¼–ç ç©ºé—´ä¸€å…±æœ‰ 286 ä¸ªç¼–ç , èŒƒå›´æ˜¯ä» 0 è‡³ 285. å…¶ä¸­ 0 è‡³ 255 ä¸ºæ™®é€šå­—ç¬¦ç¼–ç , 256 è¡¨ç¤ºå‹ç¼©å—çš„ç»“æŸ; è€Œ 257 è‡³ 285 åˆ™è¡¨ç¤ºé•¿åº¦. é•¿åº¦ç¼–ç çš„å«ä¹‰å¦‚ä¸‹è¡¨æ‰€ç¤º:\nä¸è·ç¦»ç¼–ç ç±»ä¼¼, æ¯ä¸ªç¼–ç éƒ½è¡¨ç¤ºä¸€ä¸ªæˆ–å¤šä¸ªé•¿åº¦, è¡¨ç¤ºå¤šä¸ªé•¿åº¦æ—¶åé¢ä¼šæœ‰ extra ä½æŒ‡ç¤ºå…·ä½“çš„é•¿åº¦. é•¿åº¦ç¼–ç èƒ½è¡¨ç¤ºçš„é•¿åº¦èŒƒå›´ä¸º 3 è‡³ 258.æ³¨æ„ï¼šæ‰€ä»¥åœ¨ DEFLATE ä¸­ï¼Œé•¿åº¦ 12 çš„é‡å¤ä¸ä¼šç”¨åŒ¹é…é¡¹è¡¨ç¤ºï¼ˆç›´æ¥æŠŠè¿™ 12 ä¸ªå­—èŠ‚åŸæ ·è¾“å‡ºï¼ˆå³ç”¨å­—é¢å€¼ç¼–ç ï¼‰é€šå¸¸æ¯”å¼•ç”¨åŒ¹é…ï¼ˆè¿˜è¦é¢å¤–ç¼–ç é•¿åº¦å’Œè·ç¦»ï¼‰æ›´çŸ­ï¼ï¼‰ï¼›åªæœ‰é•¿åº¦ â‰¥ 3 æ—¶æ‰ä¼šç”¨åŒ¹é…é¡¹ (length, distance) æ¥å¼•ç”¨é‡å¤å—ã€‚è§£å‹æ—¶, å½“è¯»åˆ°ç¼–ç å°äºç­‰äº 255, åˆ™è®¤ä¸ºè¿™æ˜¯ä¸ªæ™®é€šå­—ç¬¦, åŸæ ·è¾“å‡ºå³å¯; è‹¥åœ¨ 257 è‡³ 285 ä¹‹é—´, åˆ™è¯´æ˜é‡åˆ°äº†ä¸€ä¸ªé‡å¤æ ‡è®°, è¿™æ„å‘³ç€å½“å‰ç¼–ç è¡¨ç¤ºçš„æ˜¯é•¿åº¦, ä¸”ä¸‹ä¸€ä¸ªç¼–ç è¡¨ç¤ºçš„æ˜¯è·ç¦». è§£ç å¾—åˆ°é•¿åº¦å’Œè·ç¦», å†åœ¨è§£å‹ç¼“å†²åŒºä¸­æ‰¾åˆ°ç›¸åº”çš„éƒ¨åˆ†è¾“å‡ºå³å¯; è‹¥ä¸º 256, åˆ™è¯´æ˜å‹ç¼©å—ç»“æŸäº†.\nä»LZ777ç¼–ç åˆ°éœå¤«æ›¼ç¼–ç ä¸Šä¸€æ­¥çš„LZ777ç¼–ç ç»“æœä¸ºï¼š\nab(2, 2) (4,2)c\nå­—ç¬¦ä¸²ç»Ÿè®¡é¢‘ç‡ä¸ºï¼š\na:1b:01c:00\nå­—ç¬¦ç¼–ç ä¸ºï¼š\n101(2, 2) (4,2)00\nç„¶åå¯¹åç§»è·ç¦»å’ŒåŒ¹é…é•¿åº¦è¿›è¡Œç¼–ç ä½†æ˜¯è¿™é‡Œå‘ç°åŒ¹é…å­—ç¬¦é•¿åº¦æ˜¯ä»3å¼€å§‹çš„ï¼Œé‚£ä¹ˆè¿™ä¸ª2æ€ä¹ˆç¼–ç å‘¢ï¼ŸåŸæ¥è¿™é‡Œçš„deflateç®—æ³•æ˜¯ä½¿ç”¨äº†æ”¹è¿›å‹çš„LZ777ç®—æ³•å‚è€ƒæ–‡ç« ï¼šGzip æ ¼å¼å’Œ DEFLATE å‹ç¼©ç®—æ³•\næ”¹è¿›å‹çš„LZ777ç®—æ³•\nLZ77å‹ç¼©ç®—æ³•å°†æ‰€æœ‰æ•°æ®éƒ½å¤„ç†æˆä¸ºä¸€ä¸ªä¸‰å…ƒç»„ä¸²ï¼Œæ¯ä¸ªä¸‰å…ƒç»„è‡³å°‘éœ€è¦3ä¸ªå­—èŠ‚è¡¨ç¤ºï¼Œå¦‚æœåœ¨åŠ¨æ€å­—å…¸ä¸­æœªæ‰¾åˆ°åŒ¹é…å­—ç¬¦ä¸²ï¼Œä¼šå°†1ä¸ªå­—èŠ‚è¾“å‡ºä¸º3ä¸ªå­—èŠ‚ï¼Œè¿™å°±å¯¼è‡´äº†å­—èŠ‚æµªè´¹ã€‚å› æ­¤åœ¨DEFLATEç®—æ³•ä¸­å¯¹å…¶ä½¿ç”¨çš„LZ77ç®—æ³•è¿›è¡Œäº†ä»¥ä¸‹æ”¹è¿›ï¼š\nå¯¹åŒ¹é…å­—ç¬¦ä¸²é•¿åº¦å°äº3çš„å­—ç¬¦ä¸²ä¸å‹ç¼©ã€‚å› ä¸ºé•¿åº¦å°äº3çš„å­—ç¬¦ä¸²ï¼Œä½¿ç”¨ä¸‰å…ƒç»„è¡¨ç¤ºï¼Œå¯¹åŸå§‹æ•°æ®ä¸èƒ½èµ·åˆ°å‹ç¼©çš„ä½œç”¨ã€‚å¯¹å­—ç¬¦ä¸²çš„åŒ¹é…é•¿åº¦è¿›è¡Œäº†é™åˆ¶ï¼ŒèŒƒå›´ä¸ºï¼ˆ-128~127ï¼‰ï¼Œç”¨8bitè¡¨ç¤ºï¼Œæ»‘åŠ¨çª—å£å¤§å°ä¸º32KBï¼Œç”¨15bitè¡¨ç¤ºï¼Œå°†å‹ç¼©æ•°æ®æ„é€ ä¸ºæ ‡è¯†+æ•°æ®çš„å½¢å¼ï¼Œå…·ä½“å¦‚è¡¨3æ‰€ç¤ºã€‚è¯¥å­˜å‚¨æ–¹å¼ï¼Œé™ä½äº†å‹ç¼©æ•°æ®çš„å­˜å‚¨ç©ºé—´ã€‚ç”±äºåªæŸ¥æ‰¾åŒ¹é…é•¿åº¦å¤§äº3çš„å­—ç¬¦ä¸²ï¼Œä¸ºæé«˜ç®—æ³•é€Ÿåº¦ï¼Œåœ¨æŸ¥æ‰¾åŒ¹é…å­—ç¬¦ä¸²æ—¶ï¼Œä½¿ç”¨äº†å“ˆå¸Œé“¾ç»“æ„æœç´¢ç®—æ³•ï¼Œå…¶ä¸­å“ˆå¸Œç®—æ³•å°†3å­—èŠ‚å‹ç¼©åˆ°2å­—èŠ‚ï¼Œè™½ç„¶å“ˆå¸Œé“¾ç»“æ„å­˜åœ¨æœç´¢åˆ°é”™è¯¯ç»“æœçš„å¯èƒ½ï¼Œä½†è¿˜æ˜¯å¤§å¹…æé«˜äº†æœç´¢é€Ÿåº¦ã€‚\n\næ‰€ä»¥æœ€ç»ˆçš„ç¼–ç ç»“æœä¸ºï¼š\na:1b:01c:00\nè¿™é‡Œçš„å­—ç¬¦ä¸²â€œabababcâ€ï¼Œè¿ç»­åŒ¹é…éƒ½æ²¡æœ‰è¶…è¿‡ä¸‰ä¸ªå­—ç¬¦ï¼Œç›´æ¥æŒ‰ç…§è¿™ä¸ªå­—ç¬¦ä¸²å¸¸é‡è¿›è¡Œç¼–ç å³å¯\n10110110100\n\nä»£ç å®ç°å‹ç¼©å¯¹è±¡åœ¨å¼€å§‹ç¼–å†™ä»£ç å‰ï¼Œæˆ‘ä»¬éœ€è¦å¼„æ¸…æ¥šï¼Œéœ€è¦å‹ç¼©çš„å¯¹è±¡æ˜¯ä»€ä¹ˆï¼Ÿ\n\nè§†é¢‘ã€éŸ³é¢‘ã€å›¾ç‰‡ç­‰æ–‡ä»¶æœ¬èº«å°±æ˜¯å‹ç¼©æ ¼å¼mp4ã€jpgã€pngã€aviã€mp3 è¿™äº›æ ¼ å·²ç»è¿‡å¤æ‚å‹ç¼©ç®—æ³•å¤„ç†ï¼ˆå¦‚ H.264ã€H.265ã€JPEGã€LZ77 ç­‰ï¼‰ã€‚ğŸ‘‰ æ‰€ä»¥å†æ¬¡ä½¿ç”¨ GZIP å‹ç¼©ä¸ä¼šæœ‰å¤ªå¤§æ•ˆæœï¼Œåè€Œå¯èƒ½ç•¥å¾®å¢åŠ ä½“ç§¯ã€‚\nGZIP å¯¹äºŒè¿›åˆ¶å†…å®¹çš„å‹ç¼©æ•ˆç‡å¾ˆä½GZIP æ˜¯ä¸ºæ–‡æœ¬å†…å®¹è®¾è®¡çš„å‹ç¼©ç®—æ³•ï¼ˆå¦‚ HTMLã€JSONã€JavaScript ç­‰ï¼‰ã€‚å®ƒä¾èµ–æ•°æ®çš„å¯é¢„æµ‹æ€§å’Œé‡å¤æ€§ï¼ˆå¦‚æ–‡æœ¬ä¸­çš„é‡å¤è¯ã€ç©ºæ ¼ç­‰ï¼‰æ¥å‹ç¼©ã€‚è§†é¢‘æ–‡ä»¶çš„æ•°æ®æ¨¡å¼çœ‹èµ·æ¥æ˜¯â€œéšæœºçš„â€ï¼Œå‹ç¼©å™¨æ— æ³•ä»ä¸­æ‰¾åˆ°æœ‰æ•ˆçš„æ¨¡å¼ã€‚\n\ngzipå®ç°GzipMiddleware.hä»£ç ï¼š\n    GzipMiddleware():clientSupportGzip_(true)&#123;&#125;;    void before(HttpRequest&amp; request) override;    void after(HttpResponse&amp; response) override;    void setClientSupportGzip(bool flag)&#123;clientSupportGzip_=flag;&#125;    bool isClinetSupportGzip() const &#123;return clientSupportGzip_;&#125;    double getGzipEnableRate() const &#123;        uint64_t total = totalRequests_.load();        return total == 0 ? 0.0 : (double)gzipAppliedCount_.load() / total;    &#125;    double getAverageCompressionRatio() const &#123;        uint64_t original = originalSizeSum_.load();        return original == 0 ? 0.0 : (double)compressedSizeSum_.load() / original;    &#125;private:    bool compressGzip(const std::string&amp; input, std::string&amp; output);    bool clientSupportGzip_;      // gzipç»Ÿè®¡ä¿¡æ¯    void checkArchive();  // æ£€æŸ¥æ˜¯å¦éœ€è¦å½’æ¡£    void resetStats();    // é‡ç½®ç»Ÿè®¡ä¿¡æ¯    std::atomic&lt;uint64_t&gt; totalRequests_&#123;0&#125;;    std::atomic&lt;uint64_t&gt; gzipAppliedCount_&#123;0&#125;;    std::atomic&lt;uint64_t&gt; originalSizeSum_&#123;0&#125;;    std::atomic&lt;uint64_t&gt; compressedSizeSum_&#123;0&#125;;    // std::function&lt;void(uint64_t, uint64_t, uint64_t, uint64_t)&gt; archiveCallback_;    static constexpr uint64_t MAX_REQUESTS_BEFORE_ARCHIVE = 1e9;    static constexpr uint64_t MAX_ORIGINAL_SIZE_BEFORE_ARCHIVE = 1ULL &lt;&lt; 40; // 1 TB\n\nGzipMiddleware.cppä»£ç ï¼š\nvoid GzipMiddleware::before(HttpRequest&amp; request)&#123;       // ä»å®¢æˆ·ç«¯è¯·æ±‚å¤´ä¸­è·å– Accept-Encoding å­—æ®µ    std::string acceptEncoding=request.getHeader(&quot;Accept-Encoding&quot;);     // åˆ¤æ–­æ˜¯å¦åŒ…å« &quot;gzip&quot; å…³é”®å­—    // å¦‚æœåŒ…å«ï¼Œè¯´æ˜å®¢æˆ·ç«¯æ”¯æŒ gzip å‹ç¼©    // å¦åˆ™ï¼Œä¸æ”¯æŒ gzip å‹ç¼©ï¼Œå¦‚æœä¸æ”¯æŒï¼Œå°±ä¸è¿›è¡Œgzipå‹ç¼©    acceptEncoding.find(&quot;gzip&quot;) != std::string::npos?setClientSupportGzip(true):setClientSupportGzip(false);&#125;//--------------------------------------// GzipMiddleware::after//--------------------------------------void GzipMiddleware::after(HttpResponse&amp; response) &#123;       // ç»Ÿè®¡æ€»è¯·æ±‚æ•°ï¼ˆç”¨äºåç»­å‹ç¼©ç»Ÿè®¡å½’æ¡£ï¼‰    totalRequests_++;    if (!isClinetSupportGzip())     // å¦‚æœå®¢æˆ·ç«¯ä¸æ”¯æŒ gzipï¼Œåˆ™ç›´æ¥è·³è¿‡å‹ç¼©        return;    //åˆ¤æ–­æ˜¯å¦åº”è¯¥å‹ç¼©ï¼Œæ¶ˆæ¯ä½“å¤§äº256å­—èŠ‚å¹¶ä¸”æ¶ˆæ¯ç±»å‹æ˜¯æ–‡æœ¬ã€htmlç­‰ç±»å‹æ‰å¯ä»¥    //å¯¹äºè§†é¢‘ã€å›¾ç‰‡ç­‰å·²ç»ä½¿ç”¨äº†å…¶ä»–å‹ç¼©ç®—æ³•è¿›è¡Œå‹ç¼©äº†çš„ï¼Œå°±ä¸å†ä½¿ç”¨gzipè¿›è¡Œå‹ç¼©äº†    if (!response.isShouldGzipCompress())         return;    // è·å–åŸå§‹å“åº”ä½“å†…å®¹    const std::string&amp; rawBody = response.getBody();    std::string compressed;    // è°ƒç”¨å®é™…å‹ç¼©æ–¹æ³•    if (compressGzip(rawBody, compressed)) &#123;        // LOG_INFO&lt;&lt;&quot;gzipAppliedCount_:&quot;&lt;&lt;gzipAppliedCount_.load()&lt;&lt;&quot;originalSizeSum_&quot;&lt;&lt;originalSizeSum_.load()&lt;&lt;&quot;compressedSizeSum_&quot;&lt;&lt;compressedSizeSum_.load();        gzipAppliedCount_++;        originalSizeSum_ += rawBody.size();        compressedSizeSum_ +=compressed.size();        response.addHeader(&quot;Content-Encoding&quot;, &quot;gzip&quot;);  // æ·»åŠ å“åº”å¤´æ ‡è¯†å‹ç¼©æ ¼å¼ä¸º gzip        response.setContentLength(compressed.size());    // æ›´æ–° Content-Length ä¸ºå‹ç¼©åå¤§å°        response.setBody(compressed);                    // è®¾ç½®å‹ç¼©åçš„å“åº”ä½“    &#125;    // æ£€æŸ¥æ˜¯å¦éœ€è¦å½’æ¡£ç»Ÿè®¡ä¿¡æ¯    checkArchive();&#125;//--------------------------------------// GzipMiddleware::compressGzipå®é™…çš„å‹ç¼©å¤„ç†ç®—æ³•//--------------------------------------bool GzipMiddleware::compressGzip(const std::string&amp; input, std::string&amp; output)&#123;    constexpr int CHUNK = 16384;     z_stream strm&#123;&#125;;    //zlib ç”¨äºå‹ç¼©çš„çŠ¶æ€ç»“æ„ä½“ï¼Œè®°å½•è¾“å…¥ã€è¾“å‡ºç¼“å†²åŒºçŠ¶æ€ç­‰    char out[CHUNK];    //è¾“å‡ºç¼“å†²åŒºï¼Œç”¨æ¥æš‚å­˜å‹ç¼©åçš„æ•°æ®å—    strm.zalloc = Z_NULL;    strm.zfree = Z_NULL;    strm.opaque = Z_NULL;    if (deflateInit2(&amp;strm,             //å‹ç¼©çŠ¶æ€                     Z_BEST_COMPRESSION, //å‹ç¼©ç­‰çº§ï¼ˆ0~9ï¼‰ï¼Œ9 è¡¨ç¤ºæœ€é«˜å‹ç¼©æ¯”ï¼Œç‰ºç‰²æ€§èƒ½                     Z_DEFLATED,         //ä½¿ç”¨ DEFLATE ç®—æ³•                     15 + 16,           //15ä½çª—å£å¤§å°(32KB), +16å¯ç”¨ GZIP æ ¼å¼è¾“å‡ºï¼ˆå¦åˆ™æ˜¯ zlibï¼‰                     8,                 //å†…éƒ¨å‹ç¼©ç¼“å†²åŒºå¤§å°å‚æ•°ï¼Œä¸€èˆ¬ä¸º 8                     Z_DEFAULT_STRATEGY) != Z_OK) //é»˜è®¤å‹ç¼©ç­–ç•¥    &#123;        return false;    &#125;    strm.avail_in = input.size();          // å¾…å‹ç¼©æ•°æ®é•¿åº¦    strm.next_in = (Bytef*)input.data();   // å¾…å‹ç¼©æ•°æ®    do &#123;        strm.avail_out = CHUNK;            //å¾…å‹ç¼©æ•°æ®å­˜å‚¨buffer çš„é•¿åº¦ï¼Œå¦‚æœå¤šæ¬¡å†™ï¼Œä¼šè¦†ç›–ä¹‹å‰çš„å†™çš„æ•°æ®                                            //å½“ç„¶ï¼Œä¹‹å‰çš„æ•°æ®å·²ç»è¢«è¯»èµ°äº†        strm.next_out = reinterpret_cast&lt;Bytef*&gt;(out); //å¾…å‹ç¼©æ•°æ®å­˜å‚¨çš„buffer        deflate(&amp;strm, Z_FINISH);            //å¦‚æœè¾“å…¥å’Œå¾…è¾“å‡ºçš„æ•°æ®éƒ½è¢«å¤„ç†å®Œï¼Œåˆ™è¿”å› Z_STREAM_END        size_t have = CHUNK - strm.avail_out;//æ€»é•¿åº¦-å½“å‰å¯å†™=å·²ç»å†™çš„æ•°æ®é•¿åº¦        output.append(out, have);    &#125; while (strm.avail_out == 0);    deflateEnd(&amp;strm);                       //é‡Šæ”¾deflateInit2ç”³è¯·çš„ç©ºé—´    LOG_INFO&lt;&lt;&quot;åŸå§‹çš„æ•°æ®å¤§å°ä¸º:&quot;&lt;&lt; input.size();    LOG_INFO&lt;&lt;&quot;GZIPå‹ç¼©å®Œæˆ,å‹ç¼©æ¯”ä¾‹ä¸º:&quot;&lt;&lt;(static_cast&lt;double&gt;(output.size()) / input.size());;    return true;&#125;void GzipMiddleware::checkArchive() &#123;    // å¦‚æœå‹ç¼©çš„æ€»è¯·æ±‚æ•°æˆ–åŸå§‹æ•°æ®ç´¯è®¡å¤§å°è¶…è¿‡é˜ˆå€¼    // å°±æ¸…ç†ç»Ÿè®¡æ•°æ®ï¼ˆå¯ç”¨äºåç»­ç›‘æ§ã€æ—¥å¿—ï¼‰    if (totalRequests_ &gt;= MAX_REQUESTS_BEFORE_ARCHIVE ||        originalSizeSum_ &gt;= MAX_ORIGINAL_SIZE_BEFORE_ARCHIVE) &#123;        totalRequests_ = 0;        gzipAppliedCount_ = 0;        originalSizeSum_ = 0;        compressedSizeSum_ = 0;    &#125;&#125;\nå®ç°çš„å‡½æ•°æœ‰ï¼š\n\nbefore()å‡½æ•°ï¼Œåˆ¤æ–­è¯·æ±‚æ˜¯å¦æ”¯æŒgzipå‹ç¼©\nafter()å‡½æ•°ï¼Œç»Ÿè®¡è¯·æ±‚ï¼Œå¦‚æœå®¢æˆ·ç«¯ä¸æ”¯æŒgzipå‹ç¼©å°±è¿”å›ï¼›å¦åˆ™å¯¹å…¶è¿›è¡Œgzipå‹ç¼©å¹¶å¡«å……å“åº”ä½“éƒ¨åˆ†\ncompressGzip()å‡½æ•°ï¼Œå®é™…çš„å‹ç¼©å¤„ç†æ ¸å¿ƒéƒ¨åˆ†\ncheckArchive()å‡½æ•°ï¼Œç”¨äºç»Ÿè®¡å‹ç¼©çš„æƒ…å†µï¼Œå¦‚å¹³å‡å‹ç¼©ç‡ç­‰\n\næœ¬ä»£ç å®ç°gzipçš„æ ¸å¿ƒéƒ¨åˆ†å°±æ˜¯åœ¨compressGzipå‡½æ•°ä¸­è¿›è¡Œäº†å®é™…çš„å‹ç¼©ï¼ŒcompressGzipè°ƒç”¨äº†deflateå‡½æ•°è¿›è¡Œå®é™…çš„å‹ç¼©ã€‚å…³äºdeflateå‡½æ•°çš„ä»‹ç»ï¼Œå¯ä»¥å‚è€ƒæ·±å…¥ç†è§£æ•°æ®å‹ç¼©æµç¨‹åŠ zlib åº“ä¸­ç›¸å…³å‡½æ•°\nè¿è¡Œåˆ†æè¿è¡ŒæœåŠ¡å™¨ï¼ŒæŸ¥çœ‹gzipå‹ç¼©æ˜¯å¦å¯ç”¨æˆåŠŸï¼Œæœ‰ä¸‰ä¸ªåœ°æ–¹å¯ä»¥æŸ¥çœ‹gzipçš„å‹ç¼©å¯ç”¨æ˜¯å¦æˆåŠŸã€‚åˆ†åˆ«æ˜¯æ—¥å¿—ç³»ç»Ÿã€wiresharkæŠ“åŒ…åˆ†æã€LiteHubå‰ç«¯å±•ç¤ºã€‚\næ—¥å¿—æŸ¥çœ‹è¿™ä¸ªå‹ç¼©æ¯”ä¾‹è®¡ç®—æ–¹å¼æ˜¯ï¼šå‹ç¼©åçš„æ•°æ®å¤§å°é™¤ä»¥å‹ç¼©å‰çš„æ•°æ®å¤§å°ã€‚å¯ä»¥çœ‹åˆ°gzipæ˜¯æœ‰æ•ˆå‹ç¼©æˆåŠŸäº†çš„ã€‚\nwiresharkæŠ“åŒ…æŸ¥çœ‹é¦–å…ˆçœ‹å®¢æˆ·ç«¯å‘èµ·çš„æ¯ä¸€æ¬¡è¯·æ±‚éƒ½ä¼šæºå¸¦Accept-Encoding:å­—æ®µï¼Œè¯¥å­—æ®µä¸­æºå¸¦äº† gzip, deflateè¡¨ç¤ºæ”¯æŒgzipå‹ç¼©æ–¹å¼ã€‚\nè¿™ä¸ªæŠ¥æ–‡æ˜¯ä»æœåŠ¡å™¨å‘å›çš„å“åº”æŠ¥æ–‡ï¼Œå®¢æˆ·ç«¯æ”¶åˆ°å‹ç¼©åçš„ä¿¡æ¯åŒ…åè‡ªåŠ¨è§£å‹ï¼Œä»2380å­—èŠ‚è§£å‹åˆ°åŸæ¥çš„9182å­—èŠ‚ï¼Œè¿™ä¹Ÿè¿›ä¸€æ­¥è¯´æ˜äº†è®¾è®¡çš„gzipå‹ç¼©ç®—æ³•æ˜¯æœ‰æ•ˆçš„ã€‚\nåå°ç®¡ç†ç•Œé¢æŸ¥çœ‹æ­¤å¤–ï¼Œåœ¨LiteHubå‰ç«¯ç•Œé¢ï¼Œä¹Ÿæ˜¯å¯ä»¥é€šè¿‡ç®¡ç†å‘˜è´¦æˆ·æŸ¥çœ‹å…·ä½“çš„gzipçš„ä¸€ä¸ªå‹ç¼©ä¿¡æ¯çš„ã€‚å…³äºgzipçš„ç†è§£å°±åˆ†æåˆ°è¿™äº†ï¼Œå¦‚æœæœ‰ä¸æ°å½“ä¹‹å‰ï¼Œè¯·æ‚¨æŒ‡å‡ºã€‚\n","categories":["LiteHub"],"tags":["ç½‘ç»œ","åç«¯","ä¸­é—´ä»¶"]},{"title":"LiteHubä¹‹ä¸­é—´ä»¶é™æµå®ç°","url":"/undefined/LiteHub_middleware_traffic&&control/","content":"\n\n\n\nç›¸å…³åŸç†ä¸ºä»€ä¹ˆè¦é™æµï¼Ÿ\n\nåœ¨å¼€å‘é«˜å¹¶å‘ç³»ç»Ÿæ—¶ï¼Œæœ‰ä¸‰æŠŠåˆ©å™¨ç”¨æ¥ä¿æŠ¤ç³»ç»Ÿï¼šç¼“å­˜ã€é™çº§å’Œé™æµã€‚å…¶ä¸­ï¼Œé™æµåœ¨å¾ˆå¤šåœºæ™¯ä¸­ç”¨æ¥é™åˆ¶å¹¶å‘å’Œè¯·æ±‚é‡ï¼Œæ¯”å¦‚è¯´ç§’æ€æŠ¢è´­ï¼Œä¿æŠ¤è‡ªèº«ç³»ç»Ÿå’Œä¸‹æ¸¸ç³»ç»Ÿä¸è¢«å·¨å‹æµé‡å†²å®ç­‰ã€‚\n\nå¸¸è§çš„é™æµæ–¹æ³•åŒ…æ‹¬è®¡æ•°å™¨ã€æ»‘åŠ¨çª—å£ã€æ¼æ¡¶å’Œä»¤ç‰Œæ¡¶ç®—æ³•ã€‚\nè®¡æ•°å™¨ç®—æ³•ï¼šåœ¨ä¸€æ®µæ—¶é—´é—´éš”å†…ï¼ˆæ—¶é—´çª—&#x2F;æ—¶é—´åŒºé—´ï¼Œå¤„ç†è¯·æ±‚çš„æœ€å¤§æ•°é‡å›ºå®šï¼Œè¶…è¿‡éƒ¨åˆ†ä¸åšå¤„ç†ã€‚ç®€å•ç²—æš´ï¼Œæ¯”å¦‚æŒ‡å®šçº¿ç¨‹æ± å¤§å°ï¼ŒæŒ‡å®šæ•°æ®åº“è¿æ¥æ± å¤§å°ã€nginxè¿æ¥æ•°ç­‰ï¼Œè¿™éƒ½å±äºè®¡æ•°å™¨ç®—æ³•ã€‚\nè®¡æ•°å™¨ç®—æ³•æ˜¯é™æµç®—æ³•é‡Œæœ€ç®€å•ä¹Ÿæ˜¯æœ€å®¹æ˜“å®ç°çš„ä¸€ç§ç®—æ³•ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚æˆ‘ä»¬è§„å®šå¯¹äºæ¥å£Aï¼Œæˆ‘ä»¬1åˆ†é’Ÿçš„è®¿é—®æ¬¡æ•°ä¸èƒ½è¶…è¿‡100ä¸ªã€‚\nè®¡æ•°å™¨é™æµçš„åšæ³•æ˜¯ï¼šæˆ‘ä»¬å¯ä»¥åˆå§‹åŒ–ä¸€ä¸ªè®¡æ•°å™¨counterï¼Œæ¯å½“æ”¶åˆ°è¯·æ±‚æ—¶counteråŠ 1ã€‚è‹¥counterå€¼è¶…è¿‡100ä¸”å½“å‰è¯·æ±‚ä¸é¦–ä¸ªè¯·æ±‚çš„æ—¶é—´é—´éš”å°äº1åˆ†é’Ÿï¼Œåˆ™åˆ¤å®šä¸ºè¯·æ±‚è¿‡å¤šå¹¶æ‹’ç»è®¿é—®ï¼›è‹¥æ—¶é—´é—´éš”è¶…è¿‡1åˆ†é’Ÿä¸”counterä»åœ¨é™æµèŒƒå›´å†…ï¼Œåˆ™é‡ç½®counterã€‚\nä½†æ˜¯è¿™ä¸ªæ–¹æ³•å­˜åœ¨ä¸€ä¸ªæ˜¾è‘—çš„é—®é¢˜ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨0:59çš„æ—¶å€™ä¸€æ¬¡æ€§å‘100ä¸ªè¯·æ±‚ï¼›åˆ°1:00å°±ä¼šå°†è®¡æ•°å™¨æ¸…é›¶ï¼Œç„¶ååœ¨1:01çš„æ—¶å€™å†å‘100ä¸ªè¯·æ±‚ï¼›å¯¹äº0:00-1:00å’Œ1:00-2:00è¿™ä¸¤ä¸ªä¸€åˆ†é’Ÿçš„è¯·æ±‚éƒ½æ˜¯100ä¸ªè¯·æ±‚ï¼Œçœ‹èµ·æ¥æ˜¯æ»¡è¶³ç³»ç»Ÿçš„è¦æ±‚çš„ï¼›ä½†æ˜¯åœ¨0:59-1:01è¿™ä¸è¶³1åˆ†é’Ÿçš„æ—¶é—´æ®µå†…ï¼Œå´å‘èµ·äº†200ä¸ªè¯·æ±‚ï¼Œå¯èƒ½ä¼šå¼•èµ·ç³»ç»Ÿå¥”æºƒã€‚\næ»‘åŠ¨çª—å£ç®—æ³•ï¼š\næ»‘åŠ¨çª—å£ï¼ˆrolling windowï¼‰æ˜¯ä¸€ç§æ—¶é—´åˆ†æ®µæŠ€æœ¯ã€‚åœ¨è®¡æ•°å™¨ç®—æ³•ä¸­ï¼Œå¦‚æœé™åˆ¶1åˆ†é’Ÿå†…çš„è®¿é—®æ¬¡æ•°ï¼Œè¿™ä¸ª1åˆ†é’Ÿå°±æ˜¯ä¸€ä¸ªå›ºå®šæ—¶é—´çª—å£ã€‚è€Œæ»‘åŠ¨çª—å£åˆ™æ˜¯å°†è¿™ä¸ªå›ºå®šçª—å£è¿›ä¸€æ­¥ç»†åˆ†æˆå¤šä¸ªæ›´å°çš„æ—¶é—´å•å…ƒã€‚\n\nä¾‹å¦‚ï¼šå°†1åˆ†é’Ÿçš„å›ºå®šçª—å£åˆ’åˆ†ä¸º6ä¸ª10ç§’çš„å°çª—å£ã€‚æ•´ä¸ªçº¢è‰²çŸ©å½¢æ¡†ä»£è¡¨ä¸€ä¸ªå¤§æ—¶é—´çª—å£ï¼Œçª—å£ä¼šæŒç»­æ»‘åŠ¨ï¼Œæ¯10ç§’å‘å³ç§»åŠ¨ä¸€æ ¼ã€‚å‡è®¾åœ¨ç¬¬ä¸€åˆ†é’Ÿçš„ç¬¬59ç§’æ”¶åˆ°100ä¸ªè¯·æ±‚ï¼ˆè½åœ¨ç°è‰²æ ¼å­ï¼‰ï¼Œç¬¬äºŒåˆ†é’Ÿçš„1:00åˆæ”¶åˆ°100ä¸ªè¯·æ±‚ï¼ˆè½åœ¨æ©˜é»„è‰²æ ¼å­ï¼‰ã€‚æ­¤æ—¶æ»‘åŠ¨çª—å£æ£€æµ‹åˆ°å®Œæ•´1åˆ†é’Ÿï¼ˆçº¢è‰²æ¡†ï¼‰å†…çš„æ€»è¯·æ±‚é‡è¾¾åˆ°200æ¬¡ï¼Œè¶…è¿‡100æ¬¡çš„é™æµé˜ˆå€¼ï¼Œå°±èƒ½åŠæ—¶è§¦å‘é™æµæœºåˆ¶ã€‚æ»‘åŠ¨çª—å£åˆ’åˆ†å¾—è¶Šç²¾ç»†ï¼Œé™æµç»Ÿè®¡çš„å‡†ç¡®æ€§å°±è¶Šé«˜ï¼Œä½†è¿‡äºç²¾ç»†ä¼šå¢åŠ ç³»ç»Ÿè´Ÿæ‹…ã€‚\næ¼æ¡¶ç®—æ³•ï¼š\næ°´ï¼ˆè¯·æ±‚ï¼‰å…ˆè¿›å…¥åˆ°æ¼æ¡¶é‡Œï¼Œæ¼æ¡¶ä»¥ä¸€å®šçš„é€Ÿåº¦å‡ºæ°´ï¼Œå½“æ°´æµå…¥é€Ÿåº¦è¿‡å¤§ä¼šè¶…è¿‡æ¡¶å¯æ¥çº³çš„å®¹é‡æ—¶ç›´æ¥æº¢å‡ºã€‚æ¼æ¡¶ç®—æ³•å¯ä»¥ç²—ç•¥çš„è®¤ä¸ºå°±æ˜¯æ³¨æ°´æ¼æ°´è¿‡ç¨‹ï¼Œå¾€æ¡¶ä¸­ä»¥ä»»æ„é€Ÿç‡æµå…¥æ°´ï¼Œä»¥ä¸€å®šé€Ÿç‡æµå‡ºæ°´ï¼Œå½“æ°´è¶…è¿‡æ¡¶å®¹é‡ï¼ˆcapacityï¼‰åˆ™ä¸¢å¼ƒï¼Œå› ä¸ºæ¡¶å®¹é‡æ˜¯ä¸å˜çš„ï¼Œä¿è¯äº†æ•´ä½“çš„é€Ÿç‡ã€‚æ€»ç»“ï¼šæ¼æ¡¶ç®—æ³•é€šè¿‡ä¸€ä¸ªå›ºå®šå®¹é‡å’Œå›ºå®šæ¼æ°´é€Ÿç‡çš„æ°´æ¡¶æ¨¡å‹ï¼Œå¼ºåˆ¶å°†ä»»æ„è¾“å…¥æµé‡æ•´å½¢ä¸ºæ’å®šé€Ÿç‡è¾“å‡ºï¼Œå¹¶åœ¨æµé‡è¶…è¿‡å®¹é‡æ—¶ä¸¢å¼ƒè¯·æ±‚ï¼Œä»¥æ­¤å®ç°é€Ÿç‡é™åˆ¶ã€æµé‡å¹³æ»‘å’Œç³»ç»Ÿä¿æŠ¤ã€‚\n\nä»¤ç‰Œæ¡¶ç®—æ³•ï¼š\nä»¤ç‰Œæ¡¶æ˜¯ä¸€ä¸ªå­˜æ”¾å›ºå®šå®¹é‡ä»¤ç‰Œçš„æ¡¶ï¼ŒæŒ‰ç…§å›ºå®šé€Ÿç‡å¾€æ¡¶é‡Œæ·»åŠ ä»¤ç‰Œï¼Œå¡«æ»¡äº†å°±ä¸¢å¼ƒä»¤ç‰Œï¼Œè¯·æ±‚æ˜¯å¦è¢«å¤„ç†è¦çœ‹æ¡¶ä¸­ä»¤ç‰Œæ˜¯å¦è¶³å¤Ÿï¼Œå½“ä»¤ç‰Œæ•°å‡ä¸ºé›¶æ—¶åˆ™æ‹’ç»æ–°çš„è¯·æ±‚ã€‚åœ¨æµé‡ä½å³°çš„æ—¶å€™ï¼Œä»¤ç‰Œæ¡¶ä¼šå‡ºç°å †ç§¯ï¼Œå› æ­¤å½“å‡ºç°ç¬æ—¶é«˜å³°çš„æ—¶å€™ï¼Œæœ‰è¶³å¤Ÿå¤šçš„ä»¤ç‰Œå¯ä»¥è·å–ï¼Œä»¤ç‰Œæ¡¶å…è®¸ä¸€å®šç¨‹åº¦çªå‘æµé‡ï¼Œåªè¦æœ‰ä»¤ç‰Œå°±å¯ä»¥å¤„ç†ï¼Œæ”¯æŒä¸€æ¬¡æ‹¿å¤šä¸ªä»¤ç‰Œã€‚ä»¤ç‰Œæ¡¶ä¸­è£…çš„æ˜¯ä»¤ç‰Œã€‚\n\n\nç‰¹ç‚¹ï¼šä¸æ¼æ¡¶ç®—æ³•ç›¸æ¯”ï¼Œä»¤ç‰Œæ¡¶ç®—æ³•å…è®¸çŸ­æ—¶é—´å†…çš„è¯·æ±‚é‡æ¿€å¢ï¼ˆè·å¾—ä»¤ç‰Œåå³å¯è®¿é—®æ¥å£ï¼Œå¯èƒ½å‡ºç°ç¬é—´æ¶ˆè€—æ‰€æœ‰ç´¯ç§¯ä»¤ç‰Œçš„æƒ…å†µï¼‰ï¼Œä½†ä¸ä¼šåƒè®¡æ•°ç®—æ³•é‚£æ ·äº§ç”Ÿè¿‡é«˜å³°å€¼ï¼ˆå› ä¸ºä»¤ç‰Œæ˜¯åŒ€é€Ÿç”Ÿæˆçš„ï¼‰ã€‚å› æ­¤ï¼Œä»¤ç‰Œæ¡¶ç®—æ³•åœ¨å¤„ç†çªå‘æµé‡æ—¶è¡¨ç°æ›´ä¼˜ã€‚éƒ¨åˆ†å†…å®¹å’Œå›¾ç‰‡æ¥æºï¼šå¸¸è§é™æµç®—æ³•ï¼šè®¡æ•°å™¨ã€æ»‘åŠ¨çª—å£ã€æ¼æ¡¶ã€ä»¤ç‰Œæ¡¶é™æµï¼šè®¡æ•°å™¨ã€æ¼æ¡¶ã€ä»¤ç‰Œæ¡¶ ä¸‰å¤§ç®—æ³•çš„åŸç†ä¸å®æˆ˜ï¼ˆå²ä¸Šæœ€å…¨ï¼‰\né™æµå®ç°æœ¬é¡¹ç›®æˆ‘æ˜¯åŸºäºä»¤ç‰Œæ¡¶å®ç°çš„è®¿é—®é™æµï¼Œè¯·çœ‹ä»¥ä¸‹ä»£ç LimitMiddleware.hå¤´æ–‡ä»¶\nclass LimitMiddleware: public Middleware &#123;public:    // æ„é€ å‡½æ•°    // rateï¼šä»¤ç‰Œç”Ÿæˆé€Ÿç‡ï¼ˆä¸ª/ç§’ï¼‰    // capacityï¼šæ¡¶æœ€å¤§å®¹é‡ï¼ˆæœ€å¤šå­˜å¤šå°‘ä¸ªä»¤ç‰Œï¼‰    LimitMiddleware(int rate, int capacity);    // åœ¨è¯·æ±‚å¤„ç†å‰è°ƒç”¨ï¼Œç”¨äºé™æµ    void before(HttpRequest&amp; request) override;    void after(HttpResponse&amp; response) override &#123;&#125;;    double gettokens() const &#123;return tokens_;&#125;private:    // è¡¥å……ä»¤ç‰Œï¼ˆæ ¹æ®æ—¶é—´æ¨ç§»ï¼‰    void refillTokens();private:    int rate_;            // ä»¤ç‰Œç”Ÿæˆé€Ÿç‡ï¼ˆä¸ª/ç§’ï¼‰    int capacity_;        // æ¡¶å®¹é‡ï¼ˆæœ€å¤§ä»¤ç‰Œæ•°ï¼‰    double tokens_;       // å½“å‰å¯ç”¨ä»¤ç‰Œæ•°ï¼ˆå…è®¸å°æ•°ï¼Œæ›´ç²¾ç¡®ï¼‰    std::chrono::steady_clock::time_point lastRefillTime_; // ä¸Šä¸€æ¬¡è¡¥å……æ—¶é—´    std::mutex mutex_;    // ä¿æŠ¤å¤šçº¿ç¨‹è®¿é—®&#125;;\nLimitMiddleware.ccæ–‡ä»¶\nusing namespace std::chrono;// ä»¤ç‰Œæ¡¶é™æµä¸­é—´ä»¶// æ„é€ å‡½æ•°ï¼šæŒ‡å®šä»¤ç‰Œäº§ç”Ÿé€Ÿç‡ rate (ä¸ª/ç§’) å’Œæ¡¶å®¹é‡ capacity (æœ€å¤šå¯å­˜å‚¨å¤šå°‘ä»¤ç‰Œ)LimitMiddleware::LimitMiddleware(int rate, int capacity)    : rate_(rate),      capacity_(capacity),      tokens_(capacity),  // åˆå§‹åŒ–æ—¶æ¡¶æ˜¯æ»¡çš„ï¼Œä»¤ç‰Œæ•°ç­‰äºå®¹é‡      lastRefillTime_(steady_clock::now())  // è®°å½•ä¸Šæ¬¡è¡¥å……ä»¤ç‰Œçš„æ—¶é—´&#123;&#125;// ä»¤ç‰Œè¡¥å……é€»è¾‘// æ ¹æ®è·ç¦»ä¸Šæ¬¡è¡¥å……çš„æ—¶é—´ï¼ŒæŒ‰é€Ÿç‡è¡¥å……æ–°ä»¤ç‰Œvoid LimitMiddleware::refillTokens()&#123;    auto now = steady_clock::now();    auto elapsedMs = duration_cast&lt;milliseconds&gt;(now - lastRefillTime_).count();    if (elapsedMs &gt; 0)    &#123;           // æŒ‰ç…§é€Ÿç‡è®¡ç®—å¯ä»¥è¡¥å……çš„ä»¤ç‰Œæ•°        double newTokens = (elapsedMs / 1000.0) * rate_;        // æ¡¶ä¸­çš„ä»¤ç‰Œæ•°ä¸èƒ½è¶…è¿‡å®¹é‡ä¸Šé™        tokens_ = std::min((double)capacity_, tokens_ + newTokens);        // æ›´æ–°æ—¶é—´æˆ³        lastRefillTime_ = now;    &#125;&#125;// è¯·æ±‚å‰æ‰§è¡Œï¼šåˆ¤æ–­æ˜¯å¦æœ‰è¶³å¤Ÿçš„ä»¤ç‰Œ//å¦‚æœæœ‰è¶³å¤Ÿçš„ä»¤ç‰Œï¼Œè¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œ//å¦‚æœæ²¡æœ‰ï¼Œæ‹’ç»è®¿é—®ï¼Œè¿”å›çŠ¶æ€ç 429void LimitMiddleware::before(HttpRequest&amp; request)&#123;       // åŠ é”ä¿è¯å¤šçº¿ç¨‹å®‰å…¨    std::lock_guard&lt;std::mutex&gt; lock(mutex_);    // å…ˆè¡¥å……ä»¤ç‰Œ    refillTokens();    if (tokens_ &gt;= 1.0)    &#123;        tokens_ -= 1.0;        // æœ‰è¶³å¤Ÿä»¤ç‰Œï¼Œæ¶ˆè´¹ 1 ä¸ªï¼Œå…è®¸è¯·æ±‚é€šè¿‡    &#125;    else    &#123;           // æ²¡æœ‰è¶³å¤Ÿä»¤ç‰Œï¼Œè¯·æ±‚è¢«æ‹’ç»ï¼ŒæŠ›å‡º 429 å“åº”        HttpResponse resp;        resp.setStatusLine(request.getVersion(), http::HttpResponse::k429TooManyRequests, &quot;Too Many Requests&quot;);        resp.setCloseConnection(true);        resp.setContentType(&quot;application/json&quot;);        resp.setContentLength(0);        resp.setBody(&quot;Rate limit exceeded. Please try again later.&quot;);        throw resp;    &#125;&#125;\n\næ ¸å¿ƒé€»è¾‘æ˜¯ï¼š\n\næŒ‰å›ºå®šé€Ÿç‡è¡¥å……ä»¤ç‰Œï¼ˆrefillTokensï¼‰\nè¯·æ±‚åˆ°æ¥æ—¶æ¶ˆè´¹ä»¤ç‰Œï¼ˆbeforeï¼‰\næ²¡æœ‰ä»¤ç‰Œå¯ç”¨æ—¶è¿”å›ï¼ˆé™æµäº†ï¼Œè¿”å›çŠ¶æ€ç 429 Too Many Requestsï¼‰\n\né™æµæµ‹è¯•åœ¨WebApps/LiteHubServer/src/LiteHubServer.cppä¸­çš„initializeMiddlewareå‡½æ•°ä¸­ï¼Œå®šä¹‰äº†é™æµä¸­é—´ä»¶\nlimitMiddleware_ = std::make_shared&lt;http::middleware::LimitMiddleware&gt;(1,100); // æ¯ç§’æœ€å¤š100ä¸ªè¯·æ±‚httpServer_.addMiddleware(limitMiddleware_);\nè¿™é‡Œå®šä¹‰çš„æ˜¯ä¸€ç§’ä¸è¶…è¿‡100ä¸ªè¯·æ±‚ï¼Œå¦‚æœé€šè¿‡æ‰‹åŠ¨ç‚¹å‡»ï¼Œè¿™ä¸ª1ç§’å†…æ€ä¹ˆä¹Ÿåˆ°ä¸äº†100æ¬¡è¯·æ±‚ï¼›æ‰€ä»¥æˆ‘é€šè¿‡pythonè„šæœ¬ä»£ç æ¨¡æ‹Ÿä¸€æ¬¡å¤§é‡çš„è®¿é—®ï¼Œpythonä»£ç å¦‚ä¸‹ï¼Œ\nimport requestsfrom concurrent.futures import ThreadPoolExecutor, as_completedimport timefrom collections import Counter# -------------------------------# å‹æµ‹å‚æ•°é…ç½®# -------------------------------TOTAL_REQUESTS = 150      # æ€»è¯·æ±‚æ•°MAX_WORKERS = 3           # å¹¶å‘çº¿ç¨‹æ•°REQUEST_INTERVAL = 0.02   # ç›¸é‚»è¯·æ±‚çš„é—´éš”ï¼ˆç§’ï¼‰ï¼Œé¿å…ç¬é—´çˆ†å‘TARGET_URL = &quot;http://47.122.77.97/&quot;  # ç›®æ ‡ URL# -------------------------------# å•æ¬¡è¯·æ±‚ä»»åŠ¡# index: è¯·æ±‚ç¼–å·# -------------------------------def send_request(index):    try:        start_time = time.time()        # å‘èµ· GET è¯·æ±‚        r = requests.get(TARGET_URL, timeout=3)        elapsed = time.time() - start_time        # æ‰“å°æ—¥å¿—ï¼šæ—¶é—´æˆ³ + è¯·æ±‚åºå· + å“åº”ç  + è€—æ—¶        print(f&quot;[&#123;time.strftime(&#x27;%H:%M:%S&#x27;)&#125;] è¯·æ±‚ &#123;index + 1:02d&#125; --&gt; çŠ¶æ€ç : &#123;r.status_code&#125; (è€—æ—¶: &#123;elapsed:.2f&#125;s)&quot;)        return r.status_code    except Exception as e:        # å¼‚å¸¸æ—¶æ‰“å°é”™è¯¯ä¿¡æ¯        print(f&quot;[&#123;time.strftime(&#x27;%H:%M:%S&#x27;)&#125;] è¯·æ±‚ &#123;index + 1:02d&#125; --&gt; å¤±è´¥: &#123;str(e)&#125;&quot;)        return str(e)# -------------------------------# ä¸»ç¨‹åºå…¥å£# -------------------------------def main():    print(f&quot;å¼€å§‹å‹æµ‹ï¼Œæ€»è¯·æ±‚æ•°ï¼š&#123;TOTAL_REQUESTS&#125;ï¼Œæœ€å¤§å¹¶å‘æ•°ï¼š&#123;MAX_WORKERS&#125;&quot;)    results = []    # è®°å½•æ•´ä¸ªå‹æµ‹å¼€å§‹æ—¶é—´    total_start_time = time.time()    # åˆ›å»ºçº¿ç¨‹æ±     with ThreadPoolExecutor(max_workers=MAX_WORKERS) as executor:        futures = []        # æäº¤ä»»åŠ¡        for i in range(TOTAL_REQUESTS):            futures.append(executor.submit(send_request, i))            time.sleep(REQUEST_INTERVAL)  # æ§åˆ¶ç›¸é‚»è¯·æ±‚çš„é—´éš”        # ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ        for future in as_completed(futures):            results.append(future.result())    # è®°å½•æ•´ä¸ªå‹æµ‹ç»“æŸæ—¶é—´    total_elapsed = time.time() - total_start_time    # -------------------------------    # ç»Ÿè®¡ä¸è¾“å‡ºç»“æœ    # -------------------------------    print(&quot;\\n-----------------------------&quot;)    print(&quot;è¯·æ±‚çŠ¶æ€ç»Ÿè®¡ç»“æœ:&quot;)    counts = Counter(results)    for key, count in counts.items():        print(f&quot;&#123;key&#125;: &#123;count&#125; æ¬¡&quot;)    print(f&quot;\\nå‹æµ‹æ€»è€—æ—¶: &#123;total_elapsed:.2f&#125; ç§’&quot;)    print(&quot;-----------------------------&quot;)if __name__ == &quot;__main__&quot;:    main()\næ‰§è¡Œpythonä»£ç çš„ç»“æœå¦‚ä¸‹ï¼š\n\nå¯ç”¨çœ‹åˆ°æ€»å…±æœ‰104æ¬¡è¯·æ±‚æˆåŠŸï¼›46æ¬¡æ‹’ç»è®¿é—®ã€‚è¯æ˜äº†è®¾è®¡çš„ä»¤ç‰Œæ¡¶é™æµç­–ç•¥æœ‰æ•ˆã€‚æˆ‘ä»¬å°†REQUEST_INTERVAL è°ƒæ•´çš„å¤§ä¸€äº›ï¼Œé¿å…ç¬é—´çš„å¤§é‡è¯·æ±‚\nREQUEST_INTERVAL = 0.1   \nå†æ‰§è¡Œä¸€æ¬¡ï¼šæ‹’ç»è®¿é—®çš„æ¬¡æ•°ä¹Ÿå°‘äº†ä¸€äº›ï¼Œä»ï¼ˆ46â€”&gt;&gt;&gt;34,å³å‡å°‘äº†12æ¬¡ï¼‰ã€‚\nä¸‹å›¾ä¸ºwiresharkæŠ“åŒ…åˆ°çš„429çŠ¶æ€ç å“åº”ï¼š\n","categories":["LiteHub"],"tags":["ç½‘ç»œ","åç«¯"]},{"title":"LiteHubä¹‹ä¼šè¯ç®¡ç†","url":"/undefined/LiteHub_session/","content":"\n\n\n\nä¼šè¯ç®¡ç†ç†è®ºä¸ºä»€ä¹ˆè¿›è¡Œä¼šè¯ç®¡ç†HTTPåè®®çš„ç‰¹æ€§ä¸å±€é™æ€§Webåº”ç”¨ç¨‹åºçš„åŸºç¡€æ˜¯HTTPï¼ˆHypertext Transfer Protocolï¼‰åè®®ï¼Œè¯¥åè®®åœ¨è®¾è®¡æ—¶å…·æœ‰ä»¥ä¸‹æ ¸å¿ƒç‰¹ç‚¹ï¼š\n\nè¯·æ±‚&#x2F;å“åº”æ¨¡å¼ï¼š\n\næ¯æ¬¡HTTPäº¤äº’éƒ½éµå¾ªâ€å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚â†’æœåŠ¡å™¨è¿”å›å“åº”â€çš„å›ºå®šæ¨¡å¼\nä¾‹å¦‚ï¼šç”¨æˆ·è®¿é—®ç”µå•†ç½‘ç«™æ—¶ï¼Œç‚¹å‡»å•†å“é¡µã€åŠ å…¥è´­ç‰©è½¦ã€ç»“ç®—ç­‰éƒ½æ˜¯ç‹¬ç«‹çš„è¯·æ±‚\nå„è¯·æ±‚ä¹‹é—´æ²¡æœ‰å†…åœ¨å…³è”ï¼ŒæœåŠ¡å™¨æ— æ³•è‡ªåŠ¨è¯†åˆ«è¿™äº›è¯·æ±‚æ˜¯å¦æ¥è‡ªåŒä¸€ç”¨æˆ·\n\n\næ— çŠ¶æ€æ€§ï¼ˆStatelessï¼‰ï¼š\n\nåè®®æœ¬èº«ä¸ä¿å­˜ä»»ä½•å†å²äº¤äº’ä¿¡æ¯\næ¯ä¸ªè¯·æ±‚éƒ½è¢«è§†ä¸ºå…¨æ–°çš„äº¤äº’ï¼ŒæœåŠ¡å™¨ä¸ä¼šâ€è®°ä½â€ä¹‹å‰çš„è¯·æ±‚\nå®é™…æ¡ˆä¾‹ï¼šåˆ·æ–°ç½‘é¡µåï¼Œç™»å½•çŠ¶æ€ã€è¡¨å•å¡«å†™å†…å®¹ç­‰éƒ½å°†ä¸¢å¤±\n\n\næ— è¿æ¥ç‰¹æ€§ï¼š\n\næ¯æ¬¡TCPè¿æ¥åªå¤„ç†ä¸€ä¸ªè¯·æ±‚&#x2F;å“åº”\nè¯·æ±‚å®Œæˆåç«‹å³æ–­å¼€è¿æ¥ä»¥èŠ‚çœèµ„æº\nå¯¼è‡´çš„é—®é¢˜ï¼šæ— æ³•ç»´æŒé•¿æœŸå¯¹è¯ï¼Œå¦‚åœ¨çº¿èŠå¤©ã€å¤šæ­¥éª¤è¡¨å•ç­‰åœºæ™¯éš¾ä»¥å®ç°\n\n\n\nç°å®åº”ç”¨çš„éœ€æ±‚çŸ›ç›¾è™½ç„¶HTTPçš„è¿™äº›ç‰¹æ€§ä½¿å…¶ç®€å•é«˜æ•ˆï¼Œä½†ç°ä»£Webåº”ç”¨éœ€è¦ï¼š\n\nç”¨æˆ·ç™»å½•çŠ¶æ€ä¿æŒï¼ˆå¦‚ä¿æŒ7å¤©å…ç™»å½•ï¼‰\nè´­ç‰©è½¦å•†å“è·¨é¡µé¢ä¿å­˜\nå¤šæ­¥éª¤è¡¨å•æ•°æ®æš‚å­˜\nä¸ªæ€§åŒ–å†…å®¹æ¨èï¼ˆåŸºäºå†å²æµè§ˆï¼‰\n\nå› æ­¤éœ€è¦å¼•å…¥ä¼šè¯ç®¡ç†æœºåˆ¶æ¥ï¼š\n\nè¯†åˆ«åŒä¸€ç”¨æˆ·çš„è¿ç»­è¯·æ±‚\nåœ¨æœåŠ¡å™¨ç«¯å­˜å‚¨ç”¨æˆ·ç‰¹å®šæ•°æ®\nç»´æŒåº”ç”¨çš„çŠ¶æ€è¿ç»­æ€§\n\nå¸¸è§è§£å†³æ–¹æ¡ˆåŒ…æ‹¬ï¼š\n\nCookieæŠ€æœ¯\nSessionä¼šè¯\nTokenä»¤ç‰Œï¼ˆå¦‚JWTï¼‰\nURLé‡å†™æŠ€æœ¯\n\nåœ¨è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„å°±æ˜¯Sessionä¼šè¯å’ŒCookieæŠ€æœ¯ç»“åˆä½¿ç”¨æ¥è®°å½•ç”¨æˆ·ç™»å½•çŠ¶æ€ã€‚\nä»€ä¹ˆæ˜¯Session\næœåŠ¡å™¨ä¸ºæ¯ä¸ªç”¨æˆ·æµè§ˆå™¨åˆ›å»ºä¸€ä¸ªä¼šè¯å¯¹è±¡ï¼ˆsessionå¯¹è±¡ï¼‰ï¼Œä¸€ä¸ªæµè§ˆå™¨åªèƒ½äº§ç”Ÿä¸€ä¸ªsession\nå½“æ–°å»ºä¸€ä¸ªçª—å£è®¿é—®æœåŠ¡å™¨æ—¶ï¼Œè¿˜æ˜¯åŸæ¥çš„é‚£ä¸ªsessionã€‚sessionä¸­é»˜è®¤ä¿å­˜çš„æ˜¯å½“å‰ç”¨æˆ·çš„ä¿¡æ¯ã€‚å› æ­¤ï¼Œåœ¨éœ€è¦ä¿å­˜å…¶ä»–ç”¨æˆ·æ•°æ®æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±ç»™sessionæ·»åŠ å±æ€§ã€‚\nsessionï¼ˆä¼šè¯ï¼‰å¯ä»¥çœ‹ä¸ºæ˜¯ä¸€ç§æ ‡è¯†ï¼Œé€šè¿‡å¸¦sessionçš„è¯·æ±‚ï¼Œå¯ä»¥è®©æœåŠ¡å™¨çŸ¥é“æ˜¯è°åœ¨è¯·æ±‚æ•°æ®ã€‚\n\nSessionä¸cookieçš„åŒºåˆ«ä¸è”ç³»\nsessionæ˜¯ç”±æœåŠ¡å™¨åˆ›å»ºçš„ï¼Œå¹¶ä¿å­˜åœ¨æœåŠ¡å™¨ä¸Šçš„ã€‚åœ¨sessionåˆ›å»ºå¥½ä¹‹åï¼Œä¼šæŠŠsessionIdï¼ˆä¼šè¯çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼‰æ”¾åœ¨cookieä¸­è¿”å›ï¼ˆresponseï¼‰ç»™å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯å°†cookieæ˜¯ä¿å­˜åœ¨å®¢æˆ·ç«¯çš„ã€‚\nä»¥åçš„æ¯æ¬¡è¯·æ±‚éƒ½æºå¸¦cookieï¼Œcookieä¸­çš„å†…å®¹æ˜¯sessionIdå€¼ã€‚\nsessionçš„è¿‡æœŸå’Œè¶…æ—¶ä¸cookieçš„è¿‡æœŸæ— ç›´æ¥è”ç³»ï¼Œéƒ½æ˜¯å¯ä»¥åˆ†åˆ«è¿›è¡Œè®¾ç½®çš„ã€‚å½“sessionæˆ–cookieä¸­ä»»æ„ä¸€æ–¹è¿‡æœŸï¼Œé‚£ä¹ˆç”¨æˆ·å°±éœ€è¦é‡æ–°ç™»å½•äº†\n\næ³¨æ„ï¼šè™½ç„¶ Cookie æ˜¯æœ€ä¸»æµçš„æ–¹å¼ï¼Œä½†å¦‚æœç”¨æˆ·ç¦ç”¨ Cookieï¼ŒæœåŠ¡å™¨è¿˜å¯ä»¥é€šè¿‡å…¶ä»–æ–¹å¼ä¼ é€’ Session IDï¼šURL é‡å†™ï¼š å°† Session ID ä½œä¸ºæŸ¥è¯¢å‚æ•°é™„åŠ åˆ°æ¯ä¸ª URL åé¢ (å¦‚ ?sessionid&#x3D;abc123xyz)ã€‚è¿™ç§æ–¹å¼ä¸å¤ªå®‰å…¨ï¼ˆå®¹æ˜“æ³„éœ²ï¼‰ä¸”ä¸ç¾è§‚ã€‚éšè—è¡¨å•åŸŸï¼š å°† Session ID æ”¾åœ¨ HTML è¡¨å•çš„éšè—å­—æ®µä¸­ã€‚ä»…é€‚ç”¨äºè¡¨å•æäº¤ã€‚\næ‰€ä»¥sessionidå’Œcookieçš„æ›´å‡†ç¡®æè¿°æ˜¯ï¼šSession æœºåˆ¶é€šå¸¸åˆ©ç”¨ Cookie ç”¨äºåœ¨å®¢æˆ·ç«¯å­˜å‚¨å’Œä¼ é€’æ ‡è¯†æœåŠ¡å™¨ç«¯ Session æ•°æ®çš„ Session IDã€‚Cookie æ˜¯ Session ID çš„è½½ä½“ï¼Œè€Œé Session ç”Ÿæˆäº† Cookieã€‚ æœåŠ¡å™¨ç«¯çš„ Session ç®¡ç†ä»£ç è´Ÿè´£ç”Ÿæˆ Session ID å¹¶æŒ‡ç¤ºæµè§ˆå™¨ï¼ˆé€šè¿‡ Set-Cookieï¼‰å­˜å‚¨å®ƒã€‚\nç¬¬å…­ç«  ä¼šè¯ç®¡ç†ï¼ˆSessionï¼‰\nä¼šè¯ç®¡ç†ä»£ç å®ç°ä¼šè¯ç®¡ç†ä¸­å…±å®ç°äº†å››ä¸ªç±»å®ç°ï¼š\n\nSession(ä¼šè¯)ï¼šè¡¨ç¤ºä¸€ä¸ªä¼šè¯ã€‚\nSessionManager(ä¼šè¯ç®¡ç†å™¨)ï¼šç”¨äºç®¡ç†å¤šä¸ªä¼šè¯çš„å£°æ˜å‘¨æœŸã€‚\nSessionStorage(ä¼šè¯å­˜å‚¨)ï¼šä¼šè¯å­˜å‚¨å®ç°çš„æŠ½è±¡ç±»ã€‚\nMemorySessionStorage(å†…å­˜ä¼šè¯å­˜å‚¨)ï¼šç»§æ‰¿SessionStorageï¼Œå…·ä½“çš„ä¼šè¯å­˜å‚¨å®ç°ç±»ã€‚\n\nSessionç±»å®ç°\nSession æ„é€ å‡½æ•°ï¼Œç”¨äºåˆå§‹åŒ–ä¼šè¯å®ä¾‹ï¼Œè®°å½• sessionIdã€è®¾ç½®æœ€é•¿æœ‰æ•ˆæ—¶é—´ï¼ˆé»˜è®¤å€¼ä¸º 1 å°æ—¶ï¼‰å¹¶å…³è”ä¼šè¯ç®¡ç†å™¨ã€‚\nisExpiredï¼ˆï¼‰ï¼Œåˆ¤æ–­å½“å‰ä¼šè¯æ˜¯å¦è¿‡æœŸ\nrefreshï¼ˆï¼‰ï¼Œåˆ·æ–°è¿‡æœŸæ—¶é—´ï¼Œå½“å‰æ—¶é—´åŠ ä¸Šæœ€é•¿æœ‰æ•ˆæ—¶é—´ï¼ˆé»˜è®¤ä¸ºä¸€å°æ—¶ï¼‰\nsetValueï¼ˆï¼‰ï¼Œä»¥é”®å€¼å¯¹å½¢å¼å­˜å‚¨ä¼šè¯æ•°æ®\ngetValueï¼ˆï¼‰ï¼Œæ ¹æ®ä¼ å…¥keyè·å–ç›¸åº”çš„ä¼šè¯æ•°æ®ï¼ˆvalueï¼‰\nremove(),æ ¹æ®ä¼ å…¥keyåˆ é™¤ç›¸åº”çš„ä¼šè¯æ•°æ®ï¼ˆvalueï¼‰\nclear()ï¼Œæ¸…ç©ºæ‰€æœ‰ä¼šè¯æ•°æ®\n\n æ€»ç»“ï¼Œsessionç±»å®ç°äº†è®°å½•ä¼šè¯å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç»´æŒä¼šè¯è¿‡æœŸæ—¶é—´ï¼Œæ›´æ–°ä¼šè¯æ•°æ®åŠŸèƒ½ã€‚\nSessionManagerç±»å®ç°\nSessionManager æ„é€ å‡½æ•°ï¼Œç”¨äºé…ç½®ä¼šè¯å­˜å‚¨å¯¹è±¡ï¼ˆè´Ÿè´£ä¼šè¯å­˜å‚¨ï¼‰å’Œéšæœºæ•°ç”Ÿæˆå™¨ï¼ˆç”¨äºç”Ÿæˆéšæœºçš„ä¼šè¯IDï¼‰\ngetSessionï¼ˆï¼‰å‡½æ•°ä¼šä»è¯·æ±‚ä¸­æå–cookieå­—æ®µä»¥è·å–sessionidï¼Œå¹¶è¿”å›ç›¸åº”çš„ä¼šè¯ï¼›è‹¥cookieä¸å­˜åœ¨æˆ–è€…ä¼šè¯å·²è¿‡æœŸï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°ä¼šè¯ã€‚\ngenerateSessionIdï¼ˆï¼‰ï¼Œç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„ä¼šè¯æ ‡è¯†ç¬¦\ndestroySessionï¼ˆï¼‰ï¼Œä»å­˜å‚¨ä¸­ç§»é™¤ä¼šè¯\ngetSessionIdFromCookieï¼ˆï¼‰ï¼Œä»è¯·æ±‚ä¸­çš„cookieå­—æ®µè·å–sessionId\nsetSessionCookieï¼ˆï¼‰ï¼Œåœ¨å“åº”ä¸­è®¾ç½®cookie\n\nè¿™å‡ ä¸ªå‡½æ•°æ¯”è¾ƒé‡è¦ï¼Œæ”¾è¿™é‡Œæ³¨é‡Šä¸€ä¸‹ï¼Œä¾¿äºç†è§£\n//ä»reqè¯·æ±‚ä¸­è§£æå‡ºsessionIdstd::string SessionManager::getSessionIdFromCookie(const HttpRequest&amp; req)&#123;    std::string sessionId;    std::string cookie = req.getHeader(&quot;Cookie&quot;);//æ‰¾åˆ°Cookieå­—æ®µ    if (!cookie.empty())    &#123;\t    \t//æ ¼å¼ä¸€èˆ¬ä¸º    \t//Cookie: sessionId=1dd3ce798f86bf092595840ac8ecadc8\\r\\n        size_t pos = cookie.find(&quot;sessionId=&quot;);        if (pos != std::string::npos)        &#123;            pos += 10; // è·³è¿‡&quot;sessionId=&quot;            size_t end = cookie.find(&#x27;;&#x27;, pos);            if (end != std::string::npos)            &#123;                sessionId = cookie.substr(pos, end - pos);            &#125;            else            &#123;\t            \t//ä»poså¼€å§‹æˆªå–åˆ°å­—ç¬¦ä¸²ç»“æŸ                sessionId = cookie.substr(pos);            &#125;        &#125;    &#125;        return sessionId;&#125;// ç”Ÿæˆå”¯ä¸€çš„ä¼šè¯æ ‡è¯†ç¬¦ï¼Œç¡®ä¿ä¼šè¯çš„å”¯ä¸€æ€§å’Œå®‰å…¨æ€§std::string SessionManager::generateSessionId()&#123;    std::stringstream ss;    std::uniform_int_distribution&lt;&gt; dist(0, 15);    // ç”Ÿæˆ32ä¸ªå­—ç¬¦çš„ä¼šè¯IDï¼Œæ¯ä¸ªå­—ç¬¦æ˜¯ä¸€ä¸ªåå…­è¿›åˆ¶æ•°å­—    for (int i = 0; i &lt; 32; ++i)    &#123;        ss &lt;&lt; std::hex &lt;&lt; dist(rng_);//ç”Ÿæˆä¸€ä¸ª0~15ä¹‹é—´çš„éšæœºæ•°    &#125;    return ss.str();&#125;//åœ¨å“åº”ä¸­æ·»åŠ cookieå­—æ®µvoid SessionManager::setSessionCookie(const std::string&amp; sessionId, HttpResponse* resp)&#123;    // è®¾ç½®ä¼šè¯IDåˆ°å“åº”å¤´ä¸­ï¼Œä½œä¸ºCookie    std::string cookie = &quot;sessionId=&quot; + sessionId + &quot;; Path=/; HttpOnly&quot;;    resp-&gt;addHeader(&quot;Set-Cookie&quot;, cookie);&#125;std::shared_ptr&lt;Session&gt; SessionManager::getSession(const HttpRequest&amp; req, HttpResponse* resp)&#123;   \t//ä»è¯·æ±‚ä¸­çš„cookieå­—æ®µä¸­å–å‡ºsessionid    std::string sessionId = getSessionIdFromCookie(req);        std::shared_ptr&lt;Session&gt; session;\t    if (!sessionId.empty())//å¦‚æœsessionIdå­˜åœ¨    &#123;        session = storage_-&gt;load(sessionId); //æ ¹æ®sessionIdè·å–å¯¹åº”ä¼šè¯    &#125;    if (!session || session-&gt;isExpired())//å¦‚æœsesseionä¸å­˜åœ¨æˆ–è€…è¯´sessionè¿‡æœŸï¼Œé‡æ–°åˆ›å»ºä¸€ä¸ª    &#123;        sessionId = generateSessionId();//ç”Ÿæˆå”¯ä¸€çš„sessionId        session = std::make_shared&lt;Session&gt;(sessionId, this);//ä¼ å…¥sessionidå’ŒSessionManageræ„å»ºä¸€ä¸ªä¼šè¯        setSessionCookie(sessionId, resp);//åœ¨å“åº”respä¸­setCookieä¸­æ·»åŠ sessionId    &#125;    else     &#123;        session-&gt;setManager(this); // ä¸ºç°æœ‰ä¼šè¯è®¾ç½®ç®¡ç†å™¨    &#125;    session-&gt;refresh();\t//åˆ·æ–°ä¼šè¯çš„è¿‡æœŸæ—¶é—´ï¼Œå› ä¸ºå½“å‰æœ‰æ–°çš„è®¿é—®ï¼Œè¿‡æœŸæ—¶é—´éœ€è¦é‡æ–°è¢«è®¾ç½®    storage_-&gt;save(session);  // ä¿å­˜ä¼šè¯    return session;&#125;\nMemorySessionStorageç±»å®ç°SessionStorageå®šä¹‰äº†æŠ½è±¡ç±»æä¾›äº†save()ã€load()ã€remove()æ¥å£ï¼Œè€ŒMemorySessionStorageå¯¹é‡å†™äº†è¿™äº›å‡½æ•°ã€‚MemorySessionStorageæ˜¯ä»¥&lt;std::string, std::shared_ptr&lt;Session&gt;&gt;æ„é€ çš„æ— åºé”®å€¼å¯¹ä¿å­˜çš„ã€‚\n\nsave()å‡½æ•°ï¼Œä¿å­˜ä¼šè¯\nload()å‡½æ•°ï¼Œæ ¹æ®sessionIdæ‰¾åˆ°å¯¹åº”çš„ä¼šè¯ï¼Œå¦‚æœä¼šè¯è¿‡æœŸåˆ™åˆ é™¤ä¼šè¯ï¼›å¦åˆ™è¿”å›ä¼šè¯\nremove()å‡½æ•°ï¼Œé€šè¿‡sessionIdåˆ é™¤ä¼šè¯\n\nä¼šè¯ç®¡ç†æŠ“åŒ…åˆ†æ1.é¦–æ¬¡è®¿é—®ç½‘é¡µæ­¤æ—¶è¿˜æ²¡ç™»å½•ï¼ˆæ­¤æ—¶è¿˜ä¸éœ€è¦ç»´æŠ¤ç”¨æˆ·çš„ç™»å½•çŠ¶æ€ï¼‰ï¼Œè¿™æ—¶çš„è¯·æ±‚ä¸­è¿˜æ²¡æœ‰cookieå­—æ®µã€‚è¿™æ˜¯å‘èµ·çš„è¯·æ±‚æ˜¯ä¸ºäº†è¯·æ±‚ç½‘é¡µï¼ŒæœåŠ¡å™¨è¿”å›çš„å“åº”ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œæ­¤æ—¶æœåŠ¡å™¨ä¹Ÿæ²¡æœ‰set-cookieå­—æ®µï¼›æ­¤æ—¶æœåŠ¡å™¨è¿”å›å‰ç«¯æ¸²æŸ“éœ€è¦çš„ç½‘é¡µï¼ˆå“åº”ä½“ä¸­ï¼‰\n2.ç‚¹å‡»ç™»å½•æ—¶è¿™æ—¶å¯ä»¥çœ‹åˆ°è¯·æ±‚çš„æŠ¥æ–‡ï¼Œæ˜¯ä»¥POSTæ–¹å¼å°†ç”¨æˆ·ç™»å½•çš„usernameå’Œpasswordä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼ˆè¿™é‡Œæ˜¯æ˜æ–‡ä¼ è¾“ï¼Œè¿™æ˜¯HTTPçš„ç¼ºç‚¹ï¼Œåœ¨ç½‘ç»œä¼ è¾“ä¸­å®¹æ˜“è¢«æŠ“åŒ…å¯¼è‡´å¯†ç å’Œè´¦æˆ·æ³„éœ²ï¼›åé¢è¿™ä¸ªé¡¹ç›®çœ‹èƒ½ä¸èƒ½æ‰©å±•æˆHTTPSåè®®ï¼‰\n3.æœåŠ¡å™¨å¤„ç†æ­¤æ—¶é€šè¿‡ç‚¹å‡»ç™»å½•æŒ‰é’®ï¼Œå°†ç™»å½•è¯·æ±‚å‘é€åˆ°æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨æ ¹æ®ç›¸åº”çš„è·¯ç”±ï¼Œè½¬å‘åˆ°ä¸“é—¨ç”¨äºç™»å½•å¤„ç†çš„å‡½æ•°ä¸­\n// æ ¹æ®è´¦å·å¯†ç ï¼ŒæŸ¥æ‰¾æ•°æ®åº“æ˜¯å¦æœ‰è¯¥è´¦å·å¯†ç int LoginHandler::queryUserId(const std::string &amp;username, const std::string &amp;password)&#123;    // å‰ç«¯ç”¨æˆ·ä¼ æ¥è´¦å·å¯†ç ï¼ŒæŸ¥æ‰¾æ•°æ®åº“æ˜¯å¦æœ‰è¯¥è´¦å·å¯†ç     // ä½¿ç”¨é¢„å¤„ç†è¯­å¥, é˜²æ­¢sqlæ³¨å…¥    std::string sql = &quot;SELECT id FROM users WHERE username = ? AND password = ?&quot;;    sql::ResultSet* res = mysqlUtil_.executeQuery(sql, username, password);    if (res-&gt;next())    &#123;        int id = res-&gt;getInt(&quot;id&quot;);        return id;    &#125;    // å¦‚æœæŸ¥è¯¢ç»“æœä¸ºç©ºï¼Œåˆ™è¿”å›-1    return -1;&#125;void LoginHandler::handle(const http::HttpRequest &amp;req, http::HttpResponse *resp)&#123;    // ...å…¶ä»–ä»£ç         // JSON è§£æä½¿ç”¨ try catch æ•è·å¼‚å¸¸    try    &#123;        json parsed = json::parse(req.getBody());        std::string username = parsed[&quot;username&quot;];        std::string password = parsed[&quot;password&quot;]; //ä»è¯·æ±‚ä½“ä¸­è§£æå¾—åˆ°username å’Œpassword         // éªŒè¯ç”¨æˆ·æ˜¯å¦å­˜åœ¨ï¼Œæ˜¯å¦æ³¨å†Œè¿‡        int userId = queryUserId(username, password);        if (userId != -1)        &#123;            // è·å–ä¼šè¯            auto session = server_-&gt;getSessionManager()-&gt;getSession(req, resp);                                 // åœ¨ä¼šè¯ä¸­å­˜å‚¨ç”¨æˆ·ä¿¡æ¯            session-&gt;setValue(&quot;userId&quot;, std::to_string(userId));            session-&gt;setValue(&quot;username&quot;, username);            session-&gt;setValue(&quot;isLoggedIn&quot;, &quot;true&quot;);\t\t\t\t\t\t//å…¶ä»–ä»£ç         &#125;        else // è´¦å·å¯†ç é”™è¯¯ï¼Œè¯·é‡æ–°ç™»å½•        &#123;            // å°è£…jsonæ•°æ®ï¼Œè¿”å›401æœªè®¤è¯çŠ¶æ€ç             return;        &#125;    &#125;    catch (const std::exception &amp;e)    &#123;       \t//...å…¶ä»–ä»£ç ï¼Œè¿”å›é”™è¯¯ä¿¡æ¯        return;    &#125;&#125;\nä¸Šè¿°ä»£ç ä¸­çš„ server_-&gt;getSessionManager()-&gt;getSession(req, resp)è´Ÿè´£è¿”å›ä¼šè¯ï¼Œæˆ–è€…æ–°å»ºä¼šè¯ï¼Œå…·ä½“ä¸ºï¼š\n\nå¦‚æœå½“å‰ç”¨æˆ·å­˜åœ¨ä¼šè¯å¹¶ä¸”ä¼šè¯æœ‰æ•ˆï¼Œåˆ™ç›´æ¥è¿”å›ä¼šè¯\nå¦åˆ™åˆ›å»ºæ–°çš„ä¼šè¯ï¼ˆè¿™é‡Œæ˜¯é¦–æ¬¡ç™»å½•ï¼Œæ‰€ä»¥é»˜è®¤å°±æ˜¯è¿™ç§æƒ…å†µï¼‰\n\n å¹¶åœ¨ä¼šè¯ä¸­å­˜å‚¨å¦‚&quot;userId&quot;ï¼Œ&quot;username&quot;ï¼Œ&quot;isLoggedIn&quot;å­—æ®µã€‚\n4.æœåŠ¡å™¨è¿”å›å“åº”åœ¨getSession(req, resp)â€”&gt;&gt;&gt;setSessionCookie(sessionId, resp);è®¾ç½®å“åº”æŠ¥æ–‡\nvoid SessionManager::setSessionCookie(const std::string&amp; sessionId, HttpResponse* resp)&#123;    // è®¾ç½®ä¼šè¯IDåˆ°å“åº”å¤´ä¸­ï¼Œä½œä¸ºCookie    std::string cookie = &quot;sessionId=&quot; + sessionId + &quot;; Path=/; HttpOnly&quot;;    resp-&gt;addHeader(&quot;Set-Cookie&quot;, cookie);&#125;\næœåŠ¡å™¨å“åº”è®¾ç½®äº†cookieå­—æ®µï¼Œä»¥åçš„å®¢æˆ·ç«¯çš„æ¯æ¬¡è¯·æ±‚éƒ½å°†æºå¸¦è¿™ä¸ªå­—æ®µã€‚\n5.å®¢æˆ·ç«¯çš„ä¸‹ä¸€æ¬¡è¯·æ±‚ä»ä¸Šå›¾å¯çŸ¥ï¼Œè®¾ç½®cookieä¹‹åçš„æ¯ä¸€æ¬¡è¯·æ±‚ï¼Œéƒ½ä¼šå¸¦ä¸Šcookieè¿™ä¸ªå­—æ®µã€‚\n","categories":["LiteHub"],"tags":["ç½‘ç»œ","åç«¯"]},{"title":"LiteHubä¹‹è¯·æ±‚ä¸å“åº”æŠ¥æ–‡åˆ†æ","url":"/undefined/LiteHub_req_res/","content":"\n\n\nè¿™ä¸€ç¯‡æ–‡ç« æ˜¯åŸºäºé¡¹ç›®LITEHUBåˆ†æçš„å…³äºHTTPçš„è¯·æ±‚å’Œå“åº”ç¯‡ç« ï¼Œåç»­å°†ä»”ç»†åˆ†æè¿™ä¸ªé¡¹ç›®æ‰€æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹ã€‚ä¸Šå›¾æ˜¯ä½¿ç”¨wiresharkæŠ“åŒ…åˆ†æçš„HTTPåˆ·æ–°ç½‘é¡µçš„è¯·æ±‚ä»¥åŠè¿”å›çš„å“åº”æŠ¥æ–‡æ ¼å¼ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°±è¯¦ç»†åˆ†æï¼š\nè¯·æ±‚æŠ¥æ–‡ç†è®ºéƒ¨åˆ†è¯·æ±‚æŠ¥æ–‡ä¸»è¦ç”±è¯·æ±‚è¡Œã€è¯·æ±‚å¤´ã€ç©ºè¡Œã€è¯·æ±‚å¤´æ„æˆã€‚  è¯·æ±‚è¡ŒåŒ…æ‹¬ä¸€ä¸‹å­—æ®µï¼šå¸¸è§çš„æ–¹æ³•åŒ…æ‹¬GETï¼ˆè¯·æ±‚ä¿¡æ¯ï¼‰ã€POSTï¼ˆæäº¤æ•°æ®ï¼Œè¡¨å•ï¼‰æ–¹æ³•ç­‰ï¼Œèµ„æºè·¯å¾„ï¼ˆè¯·æ±‚èµ„æºçš„URIè·¯å¾„ï¼‰ã€HTTPçš„ç‰ˆæœ¬ï¼ˆHTTP1.1&#x2F;HTTP2.0ï¼‰è¯·æ±‚å¤´çš„å­—æ®µè¾ƒå¤šï¼Œå¸¸ä½¿ç”¨çš„åŒ…å«ä»¥ä¸‹å‡ ä¸ªï¼šâ— Hostï¼šè¯·æ±‚çš„æœåŠ¡å™¨çš„åŸŸåã€‚â— Acceptï¼šå®¢æˆ·ç«¯èƒ½å¤Ÿå¤„ç†çš„åª’ä½“ç±»å‹ã€‚â— Accept-Encodingï¼šå®¢æˆ·ç«¯èƒ½å¤Ÿè§£ç çš„å†…å®¹ç¼–ç ã€‚â— Authorizationï¼šç”¨äºè®¤è¯çš„å‡­è¯ä¿¡æ¯ï¼Œæ¯”å¦‚tokenæ•°æ®ã€‚â— Content-Lengthï¼šè¯·æ±‚ä½“çš„é•¿åº¦ã€‚â— Content-Typeï¼šè¯·æ±‚ä½“çš„åª’ä½“ç±»å‹ã€‚â— Cookieï¼šå­˜å‚¨åœ¨å®¢æˆ·ç«¯çš„cookieæ•°æ®ï¼Œåœ¨æˆ‘çš„é¡¹ç›®ä¸­ï¼Œä¹Ÿæ˜¯é€šè¿‡å­˜åœ¨cookieå­—æ®µæ¥åŒºåˆ«ä¸åŒç”¨æˆ·ã€‚\nç©ºè¡Œæ˜¯è¯·æ±‚å¤´éƒ¨å’Œè¯·æ±‚ä¸»ä½“ä¹‹é—´çš„ç©ºè¡Œï¼Œç”¨äºåˆ†éš”è¯·æ±‚å¤´éƒ¨å’Œè¯·æ±‚ä¸»ä½“ã€‚è€Œè¯·æ±‚ä½“é€šå¸¸ç”¨äº POST å’Œ PUT è¯·æ±‚ï¼ŒåŒ…å«å‘é€ç»™æœåŠ¡å™¨çš„æ•°æ®ã€‚\nwiresharkæŠ“åŒ…åˆ†æ\n\nè¯·æ±‚è¡Œï¼šè¿™é‡Œä½¿ç”¨è¯·æ±‚æ–¹æ³•ä¸ºGET,è¯·æ±‚çš„è·¯å¾„ä¸º/resource/listï¼ˆæœåŠ¡å™¨é€šè¿‡è·¯ç”±è½¬å‘ç¡®å®šå…¶å®é™…è¯·æ±‚çš„è·¯å¾„èµ„æºï¼Œåé¢ä¼šåˆ†æï¼‰ï¼Œå¹¶ä¸”ä½¿ç”¨çš„ç‰ˆæœ¬å·æ˜¯HTTP/1.1.\nè¯·æ±‚å¤´ï¼šæ˜¯ä»¥ä¸€ç³»åˆ—çš„é”®å€¼å¯¹ç»„æˆçš„ã€‚å¦‚ä¸Šå›¾åŒ…æ‹¬Host:192.168.83.128(è¡¨ç¤ºè¯·æ±‚çš„æœåŠ¡å™¨çš„åŸŸåï¼Œè¿™ä¸ªå­—æ®µæ˜¯ä¸ºäº†åŒºåˆ†åœ¨ä¸€ä¸ªæœåŠ¡å™¨ä¸Šå­˜åœ¨å¤šä¸ªåœ°å€çš„é—®é¢˜ï¼Œå¦‚ç™¾åº¦å’Œedgeéƒ½åœ¨ä¸€å°æœåŠ¡å™¨çš„ä¸åŒç½‘å¡ä¸ŠæœåŠ¡ï¼Œé€šè¿‡è¿™ä¸ªå­—æ®µå¯ä»¥åŒºåˆ†)ï¼›Cookie: sessionId=ef4130be9ef3c2b7264455b2a201a1b1ï¼ˆä¿æŒè®¿é—®çš„ä¸€ä¸ªçŠ¶æ€ï¼‰ï¼Œå…¶ä½™å­—æ®µæ„Ÿå…´è¶£çš„è¯å¯ä»¥è‡ªå·±å»äº†è§£\nç©ºè¡Œï¼š \\r\\nï¼Œç”¨äºåˆ†å‰²è¯·æ±‚å¤´å’Œè¯·æ±‚ä½“ï¼›\nè¯·æ±‚ä½“ï¼šè¿™é‡Œä¸ºç©ºï¼›\n\nä»£ç è§£æä¸Šé¢æˆ‘ä»¬å·²ç»åˆ†æäº†è¯·æ±‚ä½“çš„æ ¼å¼ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±æ ¹æ®æ ¼å¼ï¼Œé€šè¿‡ä»£ç è§£æè¯·æ±‚æŠ¥æ–‡ã€‚\nåœ¨HttpContext.hä¸­å®šä¹‰è§£æçš„çŠ¶æ€ï¼Œåªæœ‰å½“å‰çŠ¶æ€æˆåŠŸè§£æå®Œæˆåï¼Œæ‰å¯ä»¥è½¬åˆ°ä¸‹ä¸€ä¸ªçŠ¶æ€ï¼›\nenum HttpRequestParseState&#123;    kExpectRequestLine, // è§£æè¯·æ±‚è¡Œ    kExpectHeaders, // è§£æè¯·æ±‚å¤´    kExpectBody, // è§£æè¯·æ±‚ä½“    kGotAll, // è§£æå®Œæˆ&#125;;\nåœ¨HttpContext.cä¸­å®šä¹‰ä¸¤ä¸ªæ ‡å¿—ï¼Œç”¨äºæ ‡å¿—æ¯ä¸ªçŠ¶æ€è§£ææ˜¯å¦å‡ºé”™ä»¥åŠæ˜¯å¦è§£æå®Œæˆï¼ˆå¦‚æœè¯·æ±‚ä½“æœ‰å€¼ï¼Œå°±éœ€è¦è§£æåˆ°è¯·æ±‚ä½“ï¼›å¦‚æœè¯·æ±‚ä½“ä¸ºç©ºï¼Œåˆ™è§£æåˆ°ç©ºè¡Œå°±è¡Œï¼‰ã€‚\nbool ok = true; // è§£ææ¯è¡Œè¯·æ±‚æ ¼å¼æ˜¯å¦æ­£ç¡®bool hasMore = true; //æ˜¯å¦è¿˜éœ€è¦è§£æ\n\n1.è¯·æ±‚è¡Œè§£æå½“å‰çš„è¯·æ±‚è¡Œæ˜¯è¿™æ ·ï¼šGET /resource/list HTTP/1.1\\r\\nè¯·çœ‹ä»£ç \n if (state_ == kExpectRequestLine)        &#123;           \t//æ‰¾åˆ°\\r\\n            const char *crlf = buf-&gt;findCRLF(); // æ³¨æ„è¿™ä¸ªè¿”å›å€¼è¾¹ç•Œå¯èƒ½æœ‰é”™            if (crlf)            &#123;\t            \t//(buf-&gt;peek(), crlf)åŒºé—´;å…¶å®å°±å¯¹åº”GET /resource/list HTTP/1.1                ok = processRequestLine(buf-&gt;peek(), crlf);                if (ok)                &#123;                    request_.setReceiveTime(receiveTime);                    //å‘åç§»åŠ¨ä¸¤ä¸ªå­—ç¬¦ï¼Œè·³è¿‡\\r\\n                    buf-&gt;retrieveUntil(crlf + 2);                    //å¹¶è®¾ç½®çŠ¶æ€ä¸ºkExpectHeadersï¼Œç”¨äºè§£æè¯·æ±‚å¤´                    state_ = kExpectHeaders;                &#125;                else                &#123;\t                \t//å¦‚æœè§£æå‡ºé”™ï¼Œåœæ­¢è§£æ                    hasMore = false;                &#125;            &#125;            else            &#123;\t            \t//å¦‚æœè¯·æ±‚è¡Œæ²¡æœ‰æ‰¾åˆ°\\r\\nï¼Œè¯´æ˜è¯·æ±‚è¡Œæ ¼å¼é”™è¯¯ï¼Œåœæ­¢è§£æ                hasMore = false;            &#125;        &#125;//å®šä¹‰ä¸“é—¨ç”¨æ¥è§£æè¯·æ±‚è¡Œçš„å‡½æ•°bool HttpContext::processRequestLine(const char *begin, const char *end)&#123;    bool succeed = false;    const char *start = begin;    //ä»¥è¿™ä¸ªä¸ºä¾‹ï¼ŒGET /resource/list HTTP/1.1    const char *space = std::find(start, end, &#x27; &#x27;);//æ‰¾åˆ°ç¬¬ä¸€ä¸ªç©ºæ ¼    if (space != end &amp;&amp; request_.setMethod(start, space))//å°†GETæˆªå–å‡ºæ¥å¹¶å­˜å‚¨åˆ°request_çš„è¯·æ±‚æ–¹æ³•å­—æ®µ    &#123;        start = space + 1;        space = std::find(start, end, &#x27; &#x27;);//ç»§ç»­æ‰¾ä¸‹ä¸€ä¸ªç©ºæ ¼        if (space != end)        &#123;            const char *argumentStart = std::find(start, space, &#x27;?&#x27;);            if (argumentStart != space) // è¯·æ±‚å¸¦å‚æ•°            &#123;\t            \t//GET /search?q=example HTTP/1.1,ç±»ä¼¼è¿™ç§ä¼šè¢«è§£æä¸ºè·¯å¾„å’Œå¯¹åº”å‚æ•°                request_.setPath(start, argumentStart); // æ³¨æ„è¿™äº›è¿”å›å€¼è¾¹ç•Œ                request_.setQueryParameters(argumentStart + 1, space);            &#125;            else // è¯·æ±‚ä¸å¸¦å‚æ•°            &#123;\t            \t//å°†/resource/listæ·»åŠ åˆ°è¯·æ±‚è·¯å¾„ä¸­                request_.setPath(start, space);            &#125;            start = space + 1;            //&quot;HTTP/1.1&quot;æˆ–è€…&quot;HTTP/1.0&quot;éƒ½æ˜¯8ä¸ªå­—èŠ‚            succeed = ((end - start == 8) &amp;&amp; std::equal(start, end - 1, &quot;HTTP/1.&quot;));            if (succeed)            &#123;\t//è®¾ç½®HTTPç‰ˆæœ¬åè®®å·                if (*(end - 1) == &#x27;1&#x27;)                &#123;                    request_.setVersion(&quot;HTTP/1.1&quot;);                &#125;                else if (*(end - 1) == &#x27;0&#x27;)                &#123;                    request_.setVersion(&quot;HTTP/1.0&quot;);                &#125;                else                &#123;\t                    succeed = false;                &#125;            &#125;        &#125;    &#125;    return succeed;&#125;// è¿™æ˜¯ä»é—®å·åé¢åˆ†å‰²å‚æ•°void HttpRequest::setQueryParameters(const char *start, const char *end)&#123;    std::string argumentStr(start, end);    std::string::size_type pos = 0;    std::string::size_type prev = 0;    // æŒ‰ &amp; åˆ†å‰²å¤šä¸ªå‚æ•°    while ((pos = argumentStr.find(&#x27;&amp;&#x27;, prev)) != std::string::npos)    &#123;        std::string pair = argumentStr.substr(prev, pos - prev);        std::string::size_type equalPos = pair.find(&#x27;=&#x27;);        if (equalPos != std::string::npos)        &#123;            std::string key = pair.substr(0, equalPos);            std::string value = pair.substr(equalPos + 1);            queryParameters_[key] = value;        &#125;        prev = pos + 1;    &#125;    // å¤„ç†æœ€åä¸€ä¸ªå‚æ•°    std::string lastPair = argumentStr.substr(prev);    std::string::size_type equalPos = lastPair.find(&#x27;=&#x27;);    if (equalPos != std::string::npos)    &#123;        std::string key = lastPair.substr(0, equalPos);        std::string value = lastPair.substr(equalPos + 1);        queryParameters_[key] = value;    &#125;&#125;\næ ¹æ®ä¸Šè¿°å‡½æ•°ï¼Œæˆ‘ä»¬å°±è§£æå‡ºæ¥äº†è¯·æ±‚è¡Œçš„ä¸‰ä¸ªå­—æ®µï¼Œè¯·æ±‚æ–¹æ³•ã€urlè·¯å¾„ã€ä»¥åŠHttpçš„ç‰ˆæœ¬å·ã€‚æ¥ä¸‹æ¥å°±å¼€å§‹è§£æè¯·æ±‚å¤´äº†ã€‚\n2.è¯·æ±‚å¤´è§£ææ ¹æ®ä¸Šè¿°åˆ†æï¼Œè¯·æ±‚å¤´æ˜¯ä»¥é”®å€¼å¯¹å½¢å¼å­˜å‚¨çš„ï¼ˆæ¯ä¸€è¡Œå­˜å‚¨ä¸€ä¸ªé”®å€¼å¯¹ï¼‰ï¼Œå¹¶ä¸”é”®å’Œå€¼çš„åˆ†å‰²æ˜¯ä»¥â€œï¼šâ€åˆ†å‰²ï¼ŒåŸºäºè¿™ä¸ªåˆ†æï¼Œè¯·æ±‚å¤´å°±æ¯”è¾ƒå¥½è§£æäº†ã€‚\n else if (state_ == kExpectHeaders)        &#123;            const char *crlf = buf-&gt;findCRLF();            if (crlf)            &#123;\t            \t//æ‰¾åˆ°&#x27;:&#x27;                const char *colon = std::find(buf-&gt;peek(), crlf, &#x27;:&#x27;);                if (colon &lt; crlf)                &#123;\t                    request_.addHeader(buf-&gt;peek(), colon, crlf);                &#125;                else if (buf-&gt;peek() == crlf)                &#123;                     // å¦‚æœæ‰¾åˆ°ç©ºè¡Œï¼Œåˆ™ç»“æŸHeader                    // æ ¹æ®è¯·æ±‚æ–¹æ³•å’ŒContent-Lengthåˆ¤æ–­æ˜¯å¦éœ€è¦ç»§ç»­è¯»å–body                    if (request_.method() == HttpRequest::kPost ||                         request_.method() == HttpRequest::kPut)                    &#123;\t                        std::string contentLength = request_.getHeader(&quot;Content-Length&quot;);                        if (!contentLength.empty())                        &#123;                            request_.setContentLength(std::stoi(contentLength));                            if (request_.contentLength() &gt; 0)                            &#123;                                state_ = kExpectBody;                            &#125;                            else                            &#123;\t                            \t//å¦‚æœä¸ç”¨è§£æè¯·æ±‚ä½“ï¼Œåˆ™ç›´æ¥ç»“æŸ                                state_ = kGotAll;                                hasMore = false;                            &#125;                        &#125;                        else                        &#123;                            // POST/PUT è¯·æ±‚æ²¡æœ‰ Content-Lengthï¼Œæ˜¯HTTPè¯­æ³•é”™è¯¯                            ok = false;                            hasMore = false;                        &#125;                    &#125;                    else                    &#123;                        // GET/HEAD/DELETE ç­‰æ–¹æ³•ç›´æ¥å®Œæˆï¼ˆæ²¡æœ‰è¯·æ±‚ä½“ï¼‰                        state_ = kGotAll;                         hasMore = false;                    &#125;                &#125;                else                &#123;                    ok = false; // Headerè¡Œæ ¼å¼é”™è¯¯                    hasMore = false;                &#125;                //è·³è¿‡\\r\\n                buf-&gt;retrieveUntil(crlf + 2); // å¼€å§‹è¯»æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€è¡Œæ•°æ®            &#125;            else            &#123;                hasMore = false;            &#125;        &#125;void HttpRequest::addHeader(const char *start, const char *colon, const char *end)&#123;\t\t//&#x27;:&#x27;å‰çš„å€¼ä½œä¸ºkey    std::string key(start, colon);    ++colon;    while (colon &lt; end &amp;&amp; isspace(*colon))    &#123;        ++colon;    &#125;    //&#x27;:&#x27;åçš„å€¼ä½œä¸ºvalue    std::string value(colon, end);    while (!value.empty() &amp;&amp; isspace(value[value.size() - 1])) // æ¶ˆé™¤å°¾éƒ¨ç©ºæ ¼    &#123;        value.resize(value.size() - 1);    &#125;    //å­˜å‚¨key-valuaé”®å€¼å¯¹    headers_[key] = value;&#125;\nåœ¨æ‰¾åˆ°ç©ºè¡Œåï¼Œéœ€è¦æ ¹æ®è¯·æ±‚æ–¹æ³•(åˆ¤æ–­æ˜¯å¦æ˜¯POSTæˆ–è€…PUTæ–¹æ³•)å’ŒContent-Lengthåˆ¤æ–­æ˜¯å¦éœ€è¦ç»§ç»­è¯»å–bodyï¼›å¦‚æœä¸éœ€è¦ï¼Œåˆ™ç›´æ¥é€€å‡ºè§£æï¼›å¦‚æœè¯·æ±‚ä½“æœ‰æ•°æ®ï¼Œå¼€å§‹è§£æè¯·æ±‚ä½“ã€‚\n3.è¯·æ±‚ä½“çš„è§£æ        else if (state_ == kExpectBody)        &#123;                         // æ£€æŸ¥ç¼“å†²åŒºä¸­æ˜¯å¦æœ‰è¶³å¤Ÿçš„æ•°æ®            if (buf-&gt;readableBytes() &lt; request_.contentLength())            &#123;                hasMore = false; // æ•°æ®ä¸å®Œæ•´ï¼Œç­‰å¾…æ›´å¤šæ•°æ®                return true;            &#125;            const std::string &amp;contentType = request_.getHeader(&quot;Content-Type&quot;);            if (contentType.find(&quot;multipart/form-data&quot;) != std::string::npos) //multipart/form-dataè¡¨ç¤ºæ”¯æŒå¤šç§å¤åˆ¶æ ¼å¼çš„æ•°æ®ä¸Šä¼ ï¼Œå¦‚txtæ–‡ä»¶ï¼Œmp4,rarç­‰ï¼›è¿™ä¹Ÿæ˜¯å®ç°å„ç§æ•°æ®æ ¼å¼ä¸Šä¼ æ–‡ä»¶çš„è§£æ            &#123;                               ok=parseMultipartData(buf);                request_.set_parseMultipartData_state(ok);                LOG_INFO&lt;&lt;&quot;multipart/form-dataè§£æ&quot;&lt;&lt;((ok)?&quot;æˆåŠŸ&quot;:&quot;å¤±è´¥&quot;);                state_ = kGotAll;                hasMore = false;            &#125;            else            &#123;            \t//å¦‚æœåªæ˜¯æ™®é€šçš„æ•°æ®ï¼Œç›´æ¥æ ¹æ®contentLengthè¯»å…¥åˆ°bodyä¸­å³å¯ã€‚                // åªè¯»å– Content-Length æŒ‡å®šçš„é•¿åº¦                std::string body(buf-&gt;peek(), buf-&gt;peek() + request_.contentLength());                request_.setBody(body);                // å‡†ç¡®ç§»åŠ¨è¯»æŒ‡é’ˆ                buf-&gt;retrieve(request_.contentLength());                state_ = kGotAll;                hasMore = false;            &#125;        &#125;\t\tbool HttpContext::parseMultipartData(Buffer *buf)&#123;    // 1. æ‰¾åˆ°å¹¶è·³è¿‡ç¬¬ä¸€ä¸ª boundaryï¼ˆå¦‚ ------WebKitFormBoundaryxxxxï¼‰    const char* crlf = buf-&gt;findCRLF();    if (!crlf) return false; // ä¸å®Œæ•´    std::string boundary(buf-&gt;peek(),crlf);    LOG_INFO&lt;&lt;&quot;boundary:&quot;&lt;&lt;boundary;    buf-&gt;retrieveUntil(crlf + 2);     // // 2. è§£æ Content-Disposition è¡Œ    crlf = buf-&gt;findCRLF();    if (!crlf) return false; // ä¸å®Œæ•´    std::string dispositionLine(buf-&gt;peek(), crlf);    buf-&gt;retrieveUntil(crlf + 2);    std::string Content_Disposition;    std::string name;    std::string filename;         size_t Content_Pos = dispositionLine.find(&quot;Content-Disposition:&quot;);    if (Content_Pos != std::string::npos)    &#123;        Content_Pos += 20;        size_t ContentEnd = dispositionLine.find(&#x27;&quot;&#x27;, Content_Pos);        if (ContentEnd != std::string::npos)            Content_Disposition.assign(dispositionLine.data() + Content_Pos, ContentEnd - Content_Pos);    &#125;    LOG_INFO&lt;&lt;&quot;Content_Disposition:&quot;&lt;&lt;Content_Disposition;    size_t namePos = dispositionLine.find(&quot;name=\\&quot;&quot;);    if (namePos != std::string::npos)    &#123;        namePos += 6;        size_t nameEnd = dispositionLine.find(&#x27;&quot;&#x27;, namePos);        if (nameEnd != std::string::npos)            name.assign(dispositionLine.data() + namePos, nameEnd - namePos);    &#125;    LOG_INFO&lt;&lt;&quot;name:&quot;&lt;&lt;name;    size_t filePos = dispositionLine.find(&quot;filename=\\&quot;&quot;);    if (filePos != std::string::npos)    &#123;        filePos += 10;        size_t fileEnd = dispositionLine.find(&#x27;&quot;&#x27;, filePos);        if (fileEnd != std::string::npos)            filename.assign(dispositionLine.data() + filePos, fileEnd - filePos);    &#125;    LOG_INFO&lt;&lt;&quot;filename:&quot;&lt;&lt;filename;     // 3. è·³è¿‡ Content-Type è¡Œ    crlf = buf-&gt;findCRLF();    if (!crlf) return false;     buf-&gt;retrieveUntil(crlf + 2);    // 4. è·³è¿‡ç©ºè¡Œï¼ˆè¯´æ˜ä¸‹ä¸€ä¸ªå°±æ˜¯æ­£æ–‡ï¼‰    crlf = buf-&gt;findCRLF();    if (!crlf) return false;    buf-&gt;retrieveUntil(crlf + 2);  // 5. å†™å…¥æ–‡ä»¶ï¼Œç›´åˆ°é‡åˆ°ä¸‹ä¸€æ¬¡ boundary    const char* fileStart = buf-&gt;peek(); // æ–‡ä»¶å†…å®¹èµ·ç‚¹    const char* fileEnd = std::search(        fileStart, buf-&gt;peek()+ buf-&gt;readableBytes(),        boundary.c_str(), boundary.c_str() + boundary.size()    );    if (fileEnd == buf-&gt;beginWrite()) &#123;    // æœªæ‰¾åˆ°ç»“æŸ boundaryï¼Œæš‚æ—¶æ•°æ®ä¸è¶³    return false;    &#125;    LOG_INFO&lt;&lt;&quot;å¼€å§‹åˆ›å»ºæ–‡ä»¶å’¯&quot;;     request_.set_filename(filename);    if (filename.find(&quot;.avi&quot;)!= std::string::npos ||filename.find(&quot;.mp4&quot;)!= std::string::npos||filename.find(&quot;.mkv&quot;)!= std::string::npos)    &#123;        FileUtil writer(&quot;/root/uploads/videos/&quot; + filename);        writer.writeBinary(fileStart, fileEnd - fileStart);        LOG_INFO&lt;&lt;&quot;è¿™æ˜¯ä¸€ä¸ªè§†é¢‘&quot;&lt;&lt;filename;    &#125;    else    &#123;        FileUtil writer(&quot;/root/uploads/&quot; + filename);        writer.writeBinary(fileStart, fileEnd - fileStart);    &#125;           LOG_INFO&lt;&lt;&quot;åˆ›å»ºå®Œæˆ&quot;;    // 6. ç§»åŠ¨ buffer æŒ‡é’ˆï¼Œè·³è¿‡æ–‡ä»¶æ•°æ®å’Œ boundaryå’Œ\\r\\n    buf-&gt;retrieveUntil(fileEnd+2); // è·³è¿‡æ–‡ä»¶æ•°æ®    //è¿™é‡Œç§»åŠ¨äº†ï¼Œä½†æ˜¯è²Œä¼¼è¿˜å‰©ä¸‹ä¸€ç‚¹ä¸œè¥¿ï¼Œæˆ‘æµ‹è¯•äº†å¹¶æ²¡æœ‰å‘ç°é—®é¢˜ï¼Œå°±ä¸ç®¡å•¦ï¼ï¼ï¼    return true;&#125;\nä¸Šé¢çš„æŠ“åŒ…è¿‡ç¨‹ä¸­æ²¡æœ‰æ–‡ä»¶ä¸Šä¼ çš„è§£æï¼Œè¿™é‡Œæˆ‘ä¸Šä¼ äº†ä¸€ä¸ªtxtæ–‡ä»¶ï¼Œå¹¶æŠ“åŒ…åˆ†æã€‚\nä¸Šå›¾çš„çº¢æ¡†éƒ¨åˆ†å°±æ˜¯æˆ‘æ­¤æ¬¡ä¸Šä¼ çš„txtæ–‡ä»¶çš„è¯·æ±‚ä½“éƒ¨åˆ†çš„æŠ“åŒ…ã€‚ä»¥ä¸‹æ˜¯åˆ†æï¼š\n\nè¾¹ç•Œå€¼ï¼šâ€”â€”WebKitFormBoundaryLkDgzlyaqa0LgduNï¼ˆç»†å¿ƒçš„åŒå­¦çœ‹åˆ°äº†ï¼Œåœ¨è¯·æ±‚ä½“ä¸­çš„æœ€å¼€å§‹éƒ¨åˆ†å’Œç»“å°¾éƒ¨åˆ†éƒ½æ˜¯ä»¥è¿™ä¸ªå€¼ä½œä¸ºåˆ†ç•Œçº¿çš„ï¼Œè€Œåœ¨è¿™ç›´æ¥çš„å°±æ˜¯å…·ä½“çš„å†…å®¹ï¼‰\nContent-Disposition: form-data; name&#x3D;â€fileâ€; filename&#x3D;â€test.txtâ€ï¼›form-dataè¡¨ç¤ºæ˜¯ä¸€ä¸ªè¡¨å•æ•°æ®ï¼›nameå­—æ®µå¯¹åº”è¡¨å•ä¸­çš„å­—æ®µåï¼›filenameæ˜¯å®¢æˆ·ç«¯ä¸Šä¼ çš„ä¸€ä¸ªåŸå§‹æ–‡ä»¶åã€‚è¿™ä¸ªå­—æ®µæ˜¯ç”¨äºå‘ŠçŸ¥æœåŠ¡å™¨å¦‚ä½•å¤„ç†è¿™éƒ¨åˆ†æ•°æ®ã€‚\nContent-Type: text&#x2F;plain\\r\\n\\r\\nã€‚è¿™ä¸ªæ˜¯å£°æ˜è¿™éƒ¨åˆ†æ•°æ®çš„åª’ä½“ç±»å‹ã€‚ï¼ˆtext&#x2F;plainè¡¨ç¤ºå†…å®¹æ˜¯æ— æ ¼å¼çš„çº¯æ–‡æœ¬ï¼‰è¿™éƒ¨åˆ†å°±æ˜¯å®é™…çš„ä¼ è¾“å†…å®¹ã€‚ä¼ è¾“å¦‚è§†é¢‘æˆ–è€…å‹ç¼©æ–‡ä»¶ä¸º01äºŒè¿›åˆ¶æµã€‚æ‰€ä»¥å¯¹äºä¸Šä¼ ä¸åŒåª’ä½“æ•°æ®çš„æ€æƒ³æ˜¯ï¼Œé€šè¿‡Content-Dispositionä¸­çš„filenameå­—æ®µï¼Œè·å–åŸæ•°æ®çš„æ–‡ä»¶åï¼Œä¿å­˜ä¸ºç›¸åº”çš„æ–‡ä»¶ç±»å‹ï¼Œå¹¶å°†å®é™…çš„å†…å®¹æ”¾åˆ°å¯¹åº”çš„æ–‡ä»¶ä¸­ã€‚\n\nè§†é¢‘ä¸Šä¼ çš„æŠ“åŒ…æˆªå›¾ï¼š\nå“åº”æŠ¥æ–‡ç†è®ºéƒ¨åˆ†HTTPå“åº”æŠ¥æ–‡æ˜¯æœåŠ¡å™¨å‘å®¢æˆ·ç«¯è¿”å›çš„æ•°æ®æ ¼å¼ï¼Œç”¨äºä¼ è¾¾æœåŠ¡å™¨å¯¹å®¢æˆ·ç«¯è¯·æ±‚çš„å¤„ç†ç»“æœä»¥åŠç›¸å…³çš„æ•°æ®ã€‚ä¸€ä¸ªæ ‡å‡†çš„HTTPå“åº”æŠ¥æ–‡é€šå¸¸åŒ…å«çŠ¶æ€è¡Œã€å“åº”å¤´ã€ç©ºè¡Œã€å“åº”ä½“ã€‚çŠ¶æ€è¡ŒåŒ…å«HTTPç‰ˆæœ¬ã€çŠ¶æ€ç å’ŒçŠ¶æ€æ¶ˆæ¯ã€‚ä¾‹å¦‚ï¼šHTTP&#x2F;1.1 200 OKï¼Œ404è¡¨ç¤ºæ²¡æœ‰æ‰¾åˆ°ï¼Œ429è¡¨ç¤ºè¯·æ±‚è¿æ¥è¿‡å¤šï¼Œæˆ‘çš„ç¾¡æ…•ä¸­ä½¿ç”¨ä»¤ç‰Œæ¡¶è¿›è¡Œé™æµçš„æ—¶å€™ï¼Œå¦‚æœæŸä¸€æ—¶å€™è¯·æ±‚è¿æ¥è¿‡å¤šï¼Œå°±è¿”å›429çŠ¶æ€ç å“åº”å¤´éƒ¨ä¹Ÿæ˜¯ä»¥é”®å€¼å¯¹çš„å½¢å¼æä¾›çš„é¢å¤–ä¿¡æ¯ï¼Œç±»ä¼¼äºè¯·æ±‚å¤´éƒ¨ï¼Œç”¨äºå‘ŠçŸ¥å®¢æˆ·ç«¯æœ‰å…³å“åº”çš„è¯¦ç»†ä¿¡æ¯ã€‚ä¸€äº›å¸¸è§çš„å“åº”å¤´éƒ¨å­—æ®µåŒ…æ‹¬ï¼šâ— Content-Typeï¼šæŒ‡å®šå“åº”ä¸»ä½“çš„åª’ä½“ç±»å‹ã€‚â— Access-Control-Allow-Origin: è·¨æºèµ„æºå…±äº«ï¼ˆCORSï¼‰ç­–ç•¥ï¼ŒæŒ‡ç¤ºå“ªäº›åŸŸå¯ä»¥è®¿é—®èµ„æºã€‚â— Content-Lengthï¼šæŒ‡å®šå“åº”ä¸»ä½“çš„é•¿åº¦ï¼ˆå­—èŠ‚æ•°ï¼‰ã€‚â— Expires: å“åº”çš„è¿‡æœŸæ—¶é—´ã€‚â— ETag: å“åº”ä½“çš„å®ä½“æ ‡ç­¾ï¼Œç”¨äºç¼“å­˜å’Œæ¡ä»¶è¯·æ±‚ã€‚â— Last-Modifiedï¼š èµ„æºæœ€åè¢«ä¿®æ”¹çš„æ—¥æœŸå’Œæ—¶é—´ã€‚â— Locationï¼šåœ¨é‡å®šå‘æ—¶æŒ‡å®šæ–°çš„èµ„æºä½ç½®ã€‚â— Set-Cookieï¼šåœ¨å“åº”ä¸­è®¾ç½®Cookieã€‚\nç©ºè¡Œï¼ˆEmpty Lineï¼‰åœ¨å“åº”å¤´å’Œå“åº”ä½“ä¹‹é—´ï¼Œè¡¨ç¤ºå“åº”å¤´çš„ç»“æŸã€‚è€Œå“åº”ä½“æ˜¯æœåŠ¡ç«¯å®é™…ä¼ è¾“çš„æ•°æ®ï¼Œå¯ä»¥æ˜¯æ–‡æœ¬ã€HTMLé¡µé¢ã€å›¾ç‰‡ã€è§†é¢‘ç­‰ï¼Œä¹Ÿå¯èƒ½ä¸ºç©ºã€‚\nwiresharkæŠ“åŒ…åˆ†æ\n\nçŠ¶æ€è¡Œè¿”å› HTTP&#x2F;1.1(åè®®ç‰ˆæœ¬)ï¼Œ200ï¼ˆçŠ¶æ€ç ï¼‰ï¼Œok(çŠ¶æ€ç å¯¹äºçš„çŸ­è¯­)\nå“åº”å¤´éƒ¨ï¼Œä¹Ÿæ˜¯ä»¥é”®å€¼å¯¹å½¢å¼ä¿å­˜å€¼çš„ã€‚Connection: Keep-Aliveï¼ˆè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªé•¿è¿æ¥ï¼Œå³å¯ä»¥åœ¨è¿™ä¸ªè¿æ¥ä¸Šå¤šæ¬¡è¯·æ±‚ä¸å“åº”ï¼‰ï¼›Access-Control-Allow-Origin: *ï¼ˆæ”¯æŒè·¨åŸŸè®¿é—®æºï¼Œè¿™é‡Œçš„â€˜*â€™è¡¨ç¤ºæ‰€æœ‰æºéƒ½å¯è®¿é—®ï¼‰ï¼›Content-Encoding: gzipï¼ˆè¡¨ç¤ºä½¿ç”¨äº†gzipç¼–ç ï¼‰ï¼›Content-Length: 325ï¼ˆè¿™ä¸ªå­—æ®µè¡¨ç¤ºå“åº”ä½“çš„æ•°æ®å¤§å°ä¸º325å­—èŠ‚ï¼‰ï¼›Content-Type: application&#x2F;jsonï¼ˆè¡¨ç¤ºå“åº”ä½“çš„æ ¼å¼ä¸ºjsonï¼‰\nå“åº”ä½“å¯ä»¥æ˜¯å¤šç§æ ¼å¼ï¼Œåœ¨è¿™é‡Œæ˜¯jsonæ ¼å¼ï¼Œè§ä¸‹å›¾è¿™é‡Œçš„ä¸€ä¸ªjsonæ–‡ä»¶ä¸­æœ‰3ä¸ªå€¼ï¼Œfilename,uploadtime,usernameï¼›å¤šä¸ªjsonæ–‡ä»¶æ„æˆäº†ä¸€ä¸ªArrayã€‚\n\nä»£ç å®ç°å“åº”å­—æ®µæ˜¯ç”±æµè§ˆå™¨è§£æçš„ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸éœ€è¦å®ç°è§£æçš„éƒ¨åˆ†ã€‚å“åº”æ˜¯ç”±æœåŠ¡å™¨ç”Ÿæˆå¹¶è¿”å›çš„ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œéœ€è¦å®ç°HTTPå“åº”æŠ¥æ–‡çš„ç”Ÿæˆã€‚è¯·çœ‹ä»£ç ï¼š\n1.è®¾ç½®çŠ¶æ€è¡Œvoid HttpResponse::setStatusLine(const std::string&amp; version,                                 HttpStatusCode statusCode,                                 const std::string&amp; statusMessage)&#123;    httpVersion_ = version; //è®¾ç½®HTTPçš„ç‰ˆæœ¬å·    statusCode_ = statusCode;//è®¾ç½®å“åº”çŠ¶æ€ç     statusMessage_ = statusMessage;//è®¾ç½®å“åº”æ¶ˆæ¯&#125;\n\n2.ç”Ÿæˆå“åº”ä½“void HttpResponse::appendToBuffer(muduo::net::Buffer* outputBuf) const&#123;    // HttpResponseå°è£…çš„ä¿¡æ¯æ ¼å¼åŒ–è¾“å‡º    char buf[32];     // ä¸ºä»€ä¹ˆä¸æŠŠçŠ¶æ€ä¿¡æ¯æ”¾å…¥æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸­ï¼Œå› ä¸ºçŠ¶æ€ä¿¡æ¯æœ‰é•¿æœ‰çŸ­ï¼Œä¸æ–¹ä¾¿å®šä¹‰ä¸€ä¸ªå›ºå®šå¤§å°çš„å†…å­˜å­˜å‚¨    snprintf(buf, sizeof buf, &quot;%s %d &quot;, httpVersion_.c_str(), statusCode_);        outputBuf-&gt;append(buf);    outputBuf-&gt;append(statusMessage_);    outputBuf-&gt;append(&quot;\\r\\n&quot;);\t\t//æ˜¯å¦è®¾ç½®é•¿è¿æ¥    if (closeConnection_)     &#123;        outputBuf-&gt;append(&quot;Connection: close\\r\\n&quot;);    &#125;    else    &#123;        outputBuf-&gt;append(&quot;Connection: Keep-Alive\\r\\n&quot;);    &#125;    for (const auto&amp; header : headers_)    &#123; // ä¸ºä»€ä¹ˆè¿™é‡Œä¸ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Ÿå› ä¸ºkeyå’Œvalueçš„é•¿åº¦ä¸å®š        outputBuf-&gt;append(header.first);        outputBuf-&gt;append(&quot;: &quot;);         outputBuf-&gt;append(header.second);        outputBuf-&gt;append(&quot;\\r\\n&quot;);    &#125;    outputBuf-&gt;append(&quot;\\r\\n&quot;); //æ·»åŠ ç©ºè¡Œ        outputBuf-&gt;append(body_); //æ·»åŠ å“åº”ä½“&#125;\næ ¼å¼åŒ–å“åº”ä¹‹åï¼Œé€šè¿‡ç½‘ç»œå‘é€å“åº”æ¶ˆæ¯ï¼Œæµè§ˆå™¨è§£æå“åº”å¹¶æ¸²æŸ“ï¼Œä¸€æ¬¡HTTPè¯·æ±‚å°±å®Œæˆäº†ã€‚\n","categories":["LiteHub"],"tags":["ç½‘ç»œ","åç«¯"]},{"title":"Hello World","url":"/undefined/hello-world/","content":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub.\nQuick StartCreate a new post$ hexo new &quot;My New Post&quot;\n\nMore info: Writing\nRun server$ hexo server\n\nMore info: Server\nGenerate static files$ hexo generate\n\nMore info: Generating\nDeploy to remote sites$ hexo deploy\n\nMore info: Deployment\n3\n","categories":["å°è®°"],"tags":["éšè®°"]}]